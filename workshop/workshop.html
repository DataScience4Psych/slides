<!DOCTYPE html>
<html lang="" xml:lang="">
  <head>
    <title>Welcome to Data Science   for Psychologists   üê±</title>
    <meta charset="utf-8" />
    <meta name="author" content="S. Mason Garrison   Assistant Professor   Wake Forest University" />
    <script src="libs/header-attrs/header-attrs.js"></script>
    <link href="libs/font-awesome/css/all.min.css" rel="stylesheet" />
    <link href="libs/font-awesome/css/v4-shims.min.css" rel="stylesheet" />
    <script src="libs/htmlwidgets/htmlwidgets.js"></script>
    <link href="libs/datatables-css/datatables-crosstalk.css" rel="stylesheet" />
    <script src="libs/datatables-binding/datatables.js"></script>
    <script src="libs/jquery/jquery-3.6.0.min.js"></script>
    <link href="libs/dt-core/css/jquery.dataTables.min.css" rel="stylesheet" />
    <link href="libs/dt-core/css/jquery.dataTables.extra.css" rel="stylesheet" />
    <script src="libs/dt-core/js/jquery.dataTables.min.js"></script>
    <link href="libs/crosstalk/css/crosstalk.min.css" rel="stylesheet" />
    <script src="libs/crosstalk/js/crosstalk.min.js"></script>
    <link rel="stylesheet" href="slides.css" type="text/css" />
  </head>
  <body>
    <textarea id="source">
class: center, middle, inverse, title-slide

.title[
# Welcome to Data Science <br> for Psychologists <br> üê±
]
.author[
### S. Mason Garrison <br> Assistant Professor <br> Wake Forest University
]

---


---




layout: true
  
&lt;div class="my-footer"&gt;
&lt;span&gt;
&lt;a href="https://DataScience4Psych.github.io/DataScience4Psych/" target="_blank"&gt;Data Science for Psychologists&lt;/a&gt;
&lt;/span&gt;
&lt;/div&gt; 

---



class: center, middle 

# Data Science for Psychologists Workshop
## APS Annual Convention
### Mason Garrison
#### Assistant Professor of Quantitative Psychology
#### Wake Forest University



---

class: middle

# A Little About Me

---

# Who Am I?

.pull-left-wide[
- My name is S. Mason Garrison
- I'm an Assistant Professor of Quantitative Psychology 
  - at Wake Forest University
- I'm a Quantitative Psychologist and 
  - Behavior Geneticist by training.
]

.center[
&lt;img src="img/greenmason.jpg" width="30%" style="display: block; margin: auto;" /&gt;
]
---


## My Work

&lt;!-- rewrite
- In addition to my work as an assistant professor, I'm also deeply involved in research, focused primarily on how we can leverage data science to improve our understanding of psychological phenomena
- My substantive research interests span several areas, including individual differences, health inequity, and cognitive psychology

 --&gt;

---

## Why I'm Here Today

&lt;!-- rewrite --&gt;
- I'm passionate about sharing my love for data science with others, especially those within the field of psychology
- I believe that the tools and methodologies of data science can significantly enhance our ability to conduct impactful research in psychology
- I'm excited to be here and share this journey with you!

---
&lt;!-- rewrite --&gt;
## Fun Facts About Me

- I'm a cat lover! (as you might have guessed from my use of üê±)
- I enjoy hiking and being in nature during my downtime
- I'm a coffee enthusiast √¢‚Ç¨‚Äú I love exploring new blends and brewing methods. Happy to chat about coffee during breaks!

---

class: middle

# Workshop Overview!

---

# Workshop Overview

- .large[&lt;i class="fa fa-database fa"&gt;&lt;/i&gt; = Introduction to R and the tidyverse]
--

- .large[&lt;i class="fa fa-flask fa"&gt;&lt;/i&gt; = Data Wrangling]
--

- .large[&lt;i class="fa fa-code fa"&gt;&lt;/i&gt; = Data Visualization]
--


&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

.small[
.center[
[DataScience4Psych.github.io/DataScience4Psych/](https://DataScience4Psych.github.io/DataScience4Psych/)
]
]

---

# Introduction to R and the tidyverse
.pull-left[
- .large[Getting started with R and RStudio]
- .large[Understanding the structure and philosophy of the tidyverse]
- .large[Learning basic R syntax and operations]
]
---

# Data Wrangling
.pull-left[
- .large[Importing and exporting data in various formats]
- .large[Cleaning, transforming, and reshaping data]
]
---

# Data Visualization

.pull-left[
- .large[Creating static and interactive visualizations using ggplot2]
- .large[Customizing visual elements to enhance your plots]
- .large[Interpreting and describing visualizations]
]
.center.pull-right[

&lt;img src="img/plot007w.png" width="95%" style="display: block; margin: auto auto auto 0;" /&gt;
]

---
class: middle

# Hello world!

---

## What is data science?

- &lt;i class="fa fa-database fa"&gt;&lt;/i&gt; + &lt;i class="fa fa-flask fa"&gt;&lt;/i&gt; = data science?
--

- &lt;i class="fa fa-database fa"&gt;&lt;/i&gt; + &lt;i class="fa fa-code fa"&gt;&lt;/i&gt; = data science?
--

- &lt;i class="fa fa-database fa"&gt;&lt;/i&gt; + &lt;i class="fa fa-user fa"&gt;&lt;/i&gt; + &lt;i class="fa fa-code fa"&gt;&lt;/i&gt; = data science?
--

- &lt;i class="fa fa-database fa"&gt;&lt;/i&gt; + &lt;i class="fa fa-users fa"&gt;&lt;/i&gt; + &lt;i class="fa fa-code fa"&gt;&lt;/i&gt; = data science?
--

&lt;br&gt;
&lt;br&gt;
.large[
Data science is an exciting discipline that allows you to turn raw data into understanding, insight, and knowledge. We're going to learn to do this in a `tidy` way -- more on that later!
]
---

# What is this course?

This course is an adaptation of my introduction to data science that is designed for psychologists. It emphasizes statistical thinking and best practices.
&lt;br&gt;&lt;br&gt;
--

**Q - What data science background does this course assume?**  
A - None.
&lt;br&gt;
--

**Q - Is this an intro CS course?**  
A - Although statistics and computer science `\(\ne\)` data science, they are very closely related and have tremendous of overlap. Hence, this course is a great way to get comfortable with those topics. However this course is **not** your typical course.
&lt;br&gt;
--

**Q - Will we be doing computing?**   
A - Yes.
&lt;br&gt;
--


**Q - What computing language will we learn?**  
A - R.
&lt;br&gt;
--

**Q: Why not language X?**  
A: We can discuss that *remotely* over ‚òï.


---

## Where is this course?

&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;

.large[
.center[
[DataScience4Psych.github.io/DataScience4Psych/](https://DataScience4Psych.github.io/DataScience4Psych/)
]
]

---
class: middle

# Introduction to R and the tidyverse

- Getting started with R and RStudio
- Understanding the structure and philosophy of the tidyverse
- Learning basic R syntax and operations


---

class: middle

# R and RStudio

---

## What is R/RStudio?

- R is a statistical programming language
- RStudio is a convenient interface for R (an integrated development environment, IDE)
- At its simplest:
    - R is like a car√¢‚Ç¨‚Ñ¢s engine
    - RStudio is like a car√¢‚Ç¨‚Ñ¢s dashboard

&lt;img src="img/engine-dashboard.png" width="66%" style="display: block; margin: auto;" /&gt;


---

## Let's take a tour - R / RStudio

.center[
![](img/demo.png)
]

- Console
- Using R as a calculator
- Environment
- Loading and viewing a data frame
- Accessing a variable in a data frame
- R functions


---

## Working with R at the command line 

- Launch RStudio/R.
- Notice the default panes:
    - Console (entire left)
    - Environment/History (tabbed in upper right)
    - Files/Plots/Packages/Help (tabbed in lower right)


--

- FYI: You can change the default location of the panes, among many other things
  - [Customizing RStudio](https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio)

---

## Working with R at the command line (pt 2)

- Go into the Console, where we interact with the live R process.
- Make an assignment and then inspect the object you just created:


```r
x &lt;- 3 * 4
x
```

```
## [1] 12
```

- All R statements where you create objects -- "assignments" -- have this form:


```r
objectName &lt;- value
```

- Read this as 'x gets 12'

&lt;!---
and in my head I hear, e.g., "x gets 12".

You will make lots of assignments and the operator `&lt;-` is a pain to type. Don't be lazy and use `=`, although it would work, because it will just sow confusion later. Instead, utilize RStudio's keyboard shortcut: Alt + - (the minus sign).
--&gt;


---

## R essentials

A short list (for now):

- Functions are (most often) verbs, followed by what they will be applied to in parentheses:


```r
do_this(to_this)
do_that(to_this, to_that, with_those)
```

--

- Columns (variables) in data frames are accessed with `$`:


```r
dataframe$var_name
```

--

- Packages are installed with the `install.packages` function and loaded with the `library` function, once per session:


```r
install.packages("package_name")
library(package_name)
```

---

## tidyverse

.pull-left[
.center[
&lt;img src="img/hexs.png" width="50%" style="display: block; margin: auto;" /&gt;
]
]
.pull-right[
.center[
[tidyverse.org](https://www.tidyverse.org/)
]

- The tidyverse is an opinionated collection of R packages designed for data science. 
- All packages share an underlying philosophy and a common grammar. 
]

---

class: middle

# R Markdown

---


## R Markdown

- Fully reproducible reports -- each time you knit the analysis is ran from the beginning
- Simple markdown syntax for text
- Code goes in chunks, defined by three backticks, narrative goes outside of chunks

---

## Let's take a tour - R Markdown


.center[
![](img/demo.png)
]

Concepts introduced:

- Copying a project of mine
- Knitting documents
- R Markdown and (some) R syntax

---

.your-turn[

- The Bechdel test asks whether a work of fiction features at least two women who talk to each other about something other than a man, and there must be two women named characters.
- Go to github page and fork the assignment `Bechdel + R Markdown`. 
- Open and knit the R Markdown document `bechdel.Rmd` and follow along with the instructions.
]

---

class: middle

# Wrapping Up...


---

class: center, middle 

# Meet the toolkit &lt;br&gt; ‚öí

---



class: middle

# Reproducible data analysis

---

## Reproducibility checklist

.question[
What does it mean for a data analysis to be "reproducible"?
]

--

Near-term goals:

- Are the tables and figures reproducible from the code and data?
- Does the code actually do what you think it does?
- In addition to what was done, is it clear **why** it was done? 
(e.g., how were parameter settings chosen?)

Long-term goals:

- Can the code be used for other data?
- Can you extend the code to do other things?

---

## Toolkit

![toolkit](img/toolkit.png)

- Scriptability `\(\rightarrow\)` R
- Literate programming (code, narrative, output in one place) `\(\rightarrow\)` R Markdown
- Version control `\(\rightarrow\)` Git / GitHub



---

class: middle

# Toolkit overview

---

&lt;img src="img/whole-game-01.png" width="100%" style="display: block; margin: auto;" /&gt;

---

&lt;img src="img/whole-game-02.png" width="100%" style="display: block; margin: auto;" /&gt;

---

&lt;img src="img/whole-game-03.png" width="100%" style="display: block; margin: auto;" /&gt;

---

&lt;img src="img/whole-game-04.png" width="100%" style="display: block; margin: auto;" /&gt;

---

class: middle

# R and RStudio

---

## What is R/RStudio?

- R is a statistical programming language
- RStudio is a convenient interface for R (an integrated development environment, IDE)
- At its simplest:
    - R is like a car√¢‚Ç¨‚Ñ¢s engine
    - RStudio is like a car√¢‚Ç¨‚Ñ¢s dashboard

&lt;img src="img/engine-dashboard.png" width="66%" style="display: block; margin: auto;" /&gt;


---

## Let's take a tour - R / RStudio

.center[
![](img/demo.png)
]

- Console
- Using R as a calculator
- Environment
- Loading and viewing a data frame
- Accessing a variable in a data frame
- R functions


---

## Working with R at the command line 

- Launch RStudio/R.
- Notice the default panes:
    - Console (entire left)
    - Environment/History (tabbed in upper right)
    - Files/Plots/Packages/Help (tabbed in lower right)


--

- FYI: You can change the default location of the panes, among many other things
  - [Customizing RStudio](https://support.rstudio.com/hc/en-us/articles/200549016-Customizing-RStudio)

---

## Working with R at the command line (pt 2)

- Go into the Console, where we interact with the live R process.
- Make an assignment and then inspect the object you just created:


```r
x &lt;- 3 * 4
x
```

```
## [1] 12
```

- All R statements where you create objects -- "assignments" -- have this form:


```r
objectName &lt;- value
```

- Read this as 'x gets 12'

&lt;!---
and in my head I hear, e.g., "x gets 12".

You will make lots of assignments and the operator `&lt;-` is a pain to type. Don't be lazy and use `=`, although it would work, because it will just sow confusion later. Instead, utilize RStudio's keyboard shortcut: Alt + - (the minus sign).
--&gt;


---

## R essentials

A short list (for now):

- Functions are (most often) verbs, followed by what they will be applied to in parentheses:


```r
do_this(to_this)
do_that(to_this, to_that, with_those)
```

--

- Columns (variables) in data frames are accessed with `$`:


```r
dataframe$var_name
```

--

- Packages are installed with the `install.packages` function and loaded with the `library` function, once per session:


```r
install.packages("package_name")
library(package_name)
```

---

## tidyverse

.pull-left[
![](img/tidyverse.png)
]

.pull-right[
.center[
[tidyverse.org](https://www.tidyverse.org/)
]

- The tidyverse is an opinionated collection of R packages designed for data science. 
- All packages share an underlying philosophy and a common grammar. 
]

---

class: middle

# R Markdown

---


## R Markdown

- Fully reproducible reports -- each time you knit the analysis is ran from the beginning
- Simple markdown syntax for text
- Code goes in chunks, defined by three backticks, narrative goes outside of chunks

---

## Let's take a tour - R Markdown


.center[
![](img/demo.png)
]

Concepts introduced:

- Copying a project of mine
- Knitting documents
- R Markdown and (some) R syntax

---

.your-turn[

- The Bechdel test asks whether a work of fiction features at least two women who talk to each other about something other than a man, and there must be two women named characters.
- Go to github page and fork the assignment `Bechdel + R Markdown`. 
- Open and knit the R Markdown document `bechdel.Rmd` and follow along with the instructions.
]

---

class: middle

# Wrapping Up...

---
## R Markdown help

.pull-left[
.center[
[R Markdown cheat sheet](https://github.com/rstudio/cheatsheets/raw/master/rmarkdown-2.0.pdf)
]
![](img/rmd-cheatsheet.png)
]
.pull-right[
.center[
Markdown Quick Reference  
`Help -&gt; Markdown Quick Reference`
]
![](img/md-cheatsheet.png)
]

---

## Workspaces

Remember this, and expect it to bite you a few times as you're learning to work 
with R Markdown: The workspace of your R Markdown document is separate from the Console!

- Run the following in the console

```r
x &lt;- 2
x * 3
```
.question[
All looks good, eh?
]

- Then, add the following chunk in your R Markdown document

```r
x * 3
```
.question[
What happens? Why the error?
]

---

## How will we use R Markdown?

- Every assignment / report / project / etc. is an R Markdown document
- You'll have a template R Markdown document to start with
- The amount of scaffolding in the template will decrease over the semester

---
class: middle

# Wrapping Up... R and R Markdown


---
class: middle

# Getting help in R

---

## Reading help files

&lt;img src="img/r-help.png" width="50%" style="display: block; margin: auto;" /&gt;



---

## Asking good questions

.pull-left[
- **Good:** Describe your intention and include your code and the error
- **Better:** Describe your intention and create a minimum working example
- **Best:** Write a **rep**roducible **ex**ample (reprex) -- we'll introduce this concept more formally and teach you the tools for it a little later in the semester
]
--
.pull-right[
![](https://media.giphy.com/media/uRb2p09vY8lEs/giphy.gif)
- Use code formatting
- For issues with R code: copy / paste your code and resulting error, don't use screenshots!
]

---

# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))
- Kieran Healy's [Data Visualization: A practical introduction](http://socviz.co/appendix.html#a-little-more-about-r)
- [Jenny Bryan's Stat545](https://stat545.com)
- [Modern Dive](https://moderndive.com/)

---
class: middle

# Wrapping Up... Getting help in R


---
class: center, middle 

# "Data and visualization &lt;br&gt; üíπ"

---




class: middle

# Exploratory data analysis

---


.pull-left[ 
&gt; "We will be exploring numbers. We need to handle them easily and look at them effectively. Techniques for handling and looking √¢‚Ç¨‚Äù whether graphical, arithmetic, or intermediate √¢‚Ç¨‚Äù will be important."
]

.pull-right[
&lt;img src="img/orangebook.png" width="90%" style="display: block; margin: auto;" /&gt;
] 


---


## What is EDA?

- Exploratory data analysis (EDA) is an approach to analyzing data sets to summarize its main characteristics.
- Today, we'll be focusing on the visual aspects
- But we might also calculate summary statistics and perform data wrangling/ manipulation/transformation at (or before) this stage of the analysis. 
  - That's what we'll focus on next.

---

class: middle

# Data visualization

---

## Data visualization


&gt; "The simple graph has brought more information to the data analyst's mind than any other device."

&gt; John Tukey

- Data visualization is the creation and study of the visual representation of data.
- Many tools for visualizing data (R is one of them) exist, as do many approaches/systems within R for making data visualizations (**ggplot2** is one of them, and that's what we're going to use).

---

## ggplot2 `\(\in\)` tidyverse

.pull-left[
&lt;img src="img/ggplot2-part-of-tidyverse.png" width="80%" style="display: block; margin: auto;" /&gt;
] 
.pull-right[ 
- **ggplot2** is tidyverse's data visualization package 
- `gg` in "ggplot2" stands for Grammar of Graphics 
- Inspired by the book **Grammar of Graphics** by Leland Wilkinson
]

---

## Grammar of Graphics

.pull-left-narrow[
A grammar of graphics is a tool to concisely describe the components of a graphic
]
.pull-right-wide[
&lt;img src="img/grammar-of-graphics.png" width="90%" style="display: block; margin: auto;" /&gt;
]

.footnote[ Source: [BloggoType](http://bloggotype.blogspot.com/2016/08/holiday-notes2-grammar-of-graphics.html)]

---

class: middle

# A First (and Reproducible) Example

---

## Reading in the Data

+ Heights of the highest points by state


```r
## 
## load required packages and data
library(tidyverse)
options(tibble.print_min = 10)
heights = read_csv("data/highest-points-by-state.csv")
## switch from feet to meters
heights$elevation = heights$elevation * .3048
```
---
## Taking a look

```r
heights
```

```
## # A tibble: 50 √ó 2
##    elevation state      
##        &lt;dbl&gt; &lt;chr&gt;      
##  1      733. Alabama    
##  2     6168. Alaska     
##  3     3851. Arizona    
##  4      839. Arkansas   
##  5     4418. California 
##  6     4399. Colorado   
##  7      725. Connecticut
##  8      137. Delaware   
##  9      105. Florida    
## 10     1458. Georgia    
## # ‚Ñπ 40 more rows
```

---
## Taking another look

```r
arrange(heights, elevation)
```

```
## # A tibble: 50 √ó 2
##    elevation state       
##        &lt;dbl&gt; &lt;chr&gt;       
##  1      105. Florida     
##  2      137. Delaware    
##  3      163. Louisiana   
##  4      246. Mississippi 
##  5      247. Rhode Island
##  6      376. Illinois    
##  7      383. Indiana     
##  8      472. Ohio        
##  9      509. Iowa        
## 10      540. Missouri    
## # ‚Ñπ 40 more rows
```

---
## Taking another another look

```r
arrange(heights, desc(elevation))
```

```
## # A tibble: 50 √ó 2
##    elevation state     
##        &lt;dbl&gt; &lt;chr&gt;     
##  1     6168. Alaska    
##  2     4418. California
##  3     4399. Colorado  
##  4     4392. Washington
##  5     4207. Wyoming   
##  6     4205. Hawaii    
##  7     4123. Utah      
##  8     4011. New Mexico
##  9     4005. Nevada    
## 10     3901. Montana   
## # ‚Ñπ 40 more rows
```

---
## Taking another√Ç¬≥ look... thoughtfully

Goals:
+ Write down the set of numbers, keeping as much detail as
possible
+ Pack the numbers efficiently, so you can see all of them at once


---

## Taking another√Ç¬≥ look: Stem and Leaf
.pull-left[

```r
stem(heights$elevation)
```

```
## 
##   The decimal point is 3 digit(s) to the right of the |
## 
##   0 | 11222445555667778
##   1 | 0011123355566779
##   2 | 0027
##   3 | 4999
##   4 | 00122444
##   5 | 
##   6 | 2
```
]
--

.pull-right[ 
&lt;br&gt;&lt;br&gt;&lt;br&gt;&lt;br&gt;
+ Notice that parts of the numbers (the beginnings) are
repeated.
+ The first digit of each number is printed at the beginning
of the line, the remainder at the ends.
+ The first digit is the "stem", the remainder are the "leaves".
]
---

# What have we learned?

The stem-and-leaf plot shows that there are three groups of
states:
+ Alaska
+ The western and Rocky Mountain states (California, Colorado, Washington, Wyoming, Hawaii, Utah, New Mexico, Nevada, Montana, Idaho, Arizona, Oregon)
+ All the other states

--

```
## 
##   The decimal point is 3 digit(s) to the right of the |
## 
##   0 | 11222445555667778
##   1 | 0011123355566779
##   2 | 0027
##   3 | 4999
##   4 | 00122444
##   5 | 
##   6 | 2
```
---

## Taking another√¢¬Å¬¥ look: Density

Compare the stem-and-leaf plot with a density estimate


```r
ggplot(heights, aes(x = elevation)) + geom_density()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-31-1.png" width="60%" style="display: block; margin: auto;" /&gt;
--

Alaska?

---
## Taking another√¢¬Å¬¥ look: Density+

Compare the stem-and-leaf plot with a density estimate


```r
ggplot(heights, aes(x = elevation)) + geom_density() + geom_rug()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-32-1.png" width="60%" style="display: block; margin: auto;" /&gt;


Alaska!

---
class: middle

# Wrapping Up... 

---

class: middle

# What is in a dataset?

---

## Dataset terminology

- Each row is an **observation**
- Each column is a **variable**

.small[


```r
starwars
```

```
## # A tibble: 87 √ó 15
##    name   height  mass hair_color skin_color eye_color birth_year
##    &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 Luke ‚Ä¶    172    77 blond      fair       blue            19  
##  2 C-3PO     167    75 &lt;NA&gt;       gold       yellow         112  
##  3 R2-D2      96    32 &lt;NA&gt;       white, bl‚Ä¶ red             33  
##  4 Darth‚Ä¶    202   136 none       white      yellow          41.9
##  5 Leia ‚Ä¶    150    49 brown      light      brown           19  
##  6 Owen ‚Ä¶    178   120 brown, gr‚Ä¶ light      blue            52  
##  7 Beru ‚Ä¶    165    75 brown      light      blue            47  
##  8 R5-D4      97    32 &lt;NA&gt;       white, red red             NA  
##  9 Biggs‚Ä¶    183    84 black      light      brown           24  
## 10 Obi-W‚Ä¶    182    77 auburn, w‚Ä¶ fair       blue-gray       57  
## # ‚Ñπ 77 more rows
## # ‚Ñπ 8 more variables: sex &lt;chr&gt;, gender &lt;chr&gt;, homeworld &lt;chr&gt;,
## #   species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
## #   starships &lt;list&gt;, hair_color2 &lt;fct&gt;
```

]

---

## Luke Skywalker

![luke-skywalker](img/luke-skywalker.png)

---

## What's in the Star Wars data?

Take a `glimpse` at the data:


```r
glimpse(starwars)
```

```
## Rows: 87
## Columns: 15
## $ name        &lt;chr&gt; "Luke Skywalker", "C-3PO", "R2-D2", "Darth ‚Ä¶
## $ height      &lt;int&gt; 172, 167, 96, 202, 150, 178, 165, 97, 183, ‚Ä¶
## $ mass        &lt;dbl&gt; 77.0, 75.0, 32.0, 136.0, 49.0, 120.0, 75.0,‚Ä¶
## $ hair_color  &lt;chr&gt; "blond", NA, NA, "none", "brown", "brown, g‚Ä¶
## $ skin_color  &lt;chr&gt; "fair", "gold", "white, blue", "white", "li‚Ä¶
## $ eye_color   &lt;chr&gt; "blue", "yellow", "red", "yellow", "brown",‚Ä¶
## $ birth_year  &lt;dbl&gt; 19.0, 112.0, 33.0, 41.9, 19.0, 52.0, 47.0, ‚Ä¶
## $ sex         &lt;chr&gt; "male", "none", "none", "male", "female", "‚Ä¶
## $ gender      &lt;chr&gt; "masculine", "masculine", "masculine", "mas‚Ä¶
## $ homeworld   &lt;chr&gt; "Tatooine", "Tatooine", "Naboo", "Tatooine"‚Ä¶
## $ species     &lt;chr&gt; "Human", "Droid", "Droid", "Human", "Human"‚Ä¶
## $ films       &lt;list&gt; &lt;"The Empire Strikes Back", "Revenge of th‚Ä¶
## $ vehicles    &lt;list&gt; &lt;"Snowspeeder", "Imperial Speeder Bike"&gt;, ‚Ä¶
## $ starships   &lt;list&gt; &lt;"X-wing", "Imperial shuttle"&gt;, &lt;&gt;, &lt;&gt;, "T‚Ä¶
## $ hair_color2 &lt;fct&gt; blond, NA, NA, Other, brown, Other, brown, ‚Ä¶
```

---

.question[
How many rows and columns does this dataset have?
What does each row represent?
What does each column represent?
]


```r
?starwars
```

&lt;img src="img/starwars-help.png" width="60%" style="display: block; margin: auto;" /&gt;

---

.question[
How many rows and columns does this dataset have?
]

.pull-left[

```r
nrow(starwars) # number of rows
```

```
## [1] 87
```

```r
ncol(starwars) # number of columns
```

```
## [1] 15
```

```r
dim(starwars)  # dimensions (row column)
```

```
## [1] 87 15
```
]

---

## Mass vs. height

.question[ 
How would you describe the relationship between mass and height of Starwars characters?
What other variables would help us understand data points that don't follow the overall trend?
Who is the not so tall but really chubby character?
]

&lt;img src="workshop_files/figure-html/unnamed-chunk-38-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---

## Jabba!

&lt;img src="img/jabbaplot.png" width="80%" style="display: block; margin: auto;" /&gt;

---


## Mass vs. height


```r
ggplot(data = starwars, mapping = aes(x = height, y = mass)) +
  geom_point() +
  labs(title = "Mass vs. height of Starwars characters",
       x = "Height (cm)", y = "Weight (kg)")
```

```
## Warning: Removed 28 rows containing missing values
## (`geom_point()`).
```

&lt;img src="workshop_files/figure-html/mass-height-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---

.question[ 
- What are the functions doing the plotting?
- What is the dataset being plotted?
- Which variables map to which features (aesthetics) of the plot?
- What does the warning mean?&lt;sup&gt;+&lt;/sup&gt;
]


```r
ggplot(data = starwars, mapping = aes(x = height, y = mass)) +
  geom_point() +
  labs(title = "Mass vs. height of Starwars characters",
       x = "Height (cm)", y = "Weight (kg)")
```

```
## Warning: Removed 28 rows containing missing values
## (`geom_point()`).
```

.footnote[
&lt;sup&gt;+&lt;/sup&gt;Suppressing warning to subsequent slides to save space
]

---

## Hello ggplot2!

.pull-left-wide[
- `ggplot()` is the main function in ggplot2
- Plots are constructed in layers
- Structure of the code for plots can be summarized as


```r
ggplot(data = [dataset], 
       mapping = aes(x = [x-variable], y = [y-variable])) +
   geom_xxx() +
   other options
```

- The ggplot2 package comes with the tidyverse


```r
library(tidyverse)
```

- For help with ggplot2, see [ggplot2.tidyverse.org](http://ggplot2.tidyverse.org/)
]

---
class: middle

# Wrapping Up... 




---

class: middle

# Why do we visualize?

---

## Anscombe's quartet



.pull-left[

```
##    set  x     y
## 1    I 10  8.04
## 2    I  8  6.95
## 3    I 13  7.58
## 4    I  9  8.81
## 5    I 11  8.33
## 6    I 14  9.96
## 7    I  6  7.24
## 8    I  4  4.26
## 9    I 12 10.84
## 10   I  7  4.82
## 11   I  5  5.68
## 12  II 10  9.14
## 13  II  8  8.14
## 14  II 13  8.74
## 15  II  9  8.77
## 16  II 11  9.26
## 17  II 14  8.10
## 18  II  6  6.13
## 19  II  4  3.10
## 20  II 12  9.13
## 21  II  7  7.26
## 22  II  5  4.74
```
] 
.pull-right[

```
##    set  x     y
## 23 III 10  7.46
## 24 III  8  6.77
## 25 III 13 12.74
## 26 III  9  7.11
## 27 III 11  7.81
## 28 III 14  8.84
## 29 III  6  6.08
## 30 III  4  5.39
## 31 III 12  8.15
## 32 III  7  6.42
## 33 III  5  5.73
## 34  IV  8  6.58
## 35  IV  8  5.76
## 36  IV  8  7.71
## 37  IV  8  8.84
## 38  IV  8  8.47
## 39  IV  8  7.04
## 40  IV  8  5.25
## 41  IV 19 12.50
## 42  IV  8  5.56
## 43  IV  8  7.91
## 44  IV  8  6.89
```
]

---

## Summarizing Anscombe's quartet


```r
quartet %&gt;%
  group_by(set) %&gt;%
  summarize(
    mean_x = mean(x), 
    mean_y = mean(y),
    sd_x = sd(x),
    sd_y = sd(y),
    r = cor(x, y)
  )
```

```
## # A tibble: 4 √ó 6
##   set   mean_x mean_y  sd_x  sd_y     r
##   &lt;fct&gt;  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
## 1 I          9   7.50  3.32  2.03 0.816
## 2 II         9   7.50  3.32  2.03 0.816
## 3 III        9   7.5   3.32  2.03 0.816
## 4 IV         9   7.50  3.32  2.03 0.817
```

---

## Visualizing Anscombe's quartet

&lt;img src="workshop_files/figure-html/quartet-plot-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---
class: middle

# Wrapping Up...


---
class: center, middle 

# Visualizing data with ggplot2&lt;br&gt; üë©‚Äçüé®

---



class: middle

# ggplot2 ‚ù§Ô∏è üêß

---

## ggplot2 `\(\in\)` tidyverse

.pull-left-narrow[
&lt;img src="img/ggplot2-part-of-tidyverse.png" width="60%" style="display: block; margin: auto;" /&gt;
] 
.pull-right-wide[ 
- **ggplot2** is tidyverse's data visualization package 
- Structure of the code for plots can be summarized as


```r
ggplot(data = [dataset], 
     mapping = aes(x = [x-variable], 
                   y = [y-variable])) +
   geom_xxx() +
   other options
```
]

---

## Data: Palmer Penguins

Measurements for penguin species, island in Palmer Archipelago, size (flipper length, body mass, bill dimensions), and sex.


.pull-left[
&lt;img src="img/penguins.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Data: Palmer Penguins

Measurements for penguin species, island in Palmer Archipelago, size (flipper length, body mass, bill dimensions), and sex.



```r
library(palmerpenguins)
glimpse(penguins)
```

```
## Rows: 344
## Columns: 8
## $ species           &lt;fct&gt; Adelie, Adelie, Adelie, Adelie, Adeli‚Ä¶
## $ island            &lt;fct&gt; Torgersen, Torgersen, Torgersen, Torg‚Ä¶
## $ bill_length_mm    &lt;dbl&gt; 39.1, 39.5, 40.3, NA, 36.7, 39.3, 38.‚Ä¶
## $ bill_depth_mm     &lt;dbl&gt; 18.7, 17.4, 18.0, NA, 19.3, 20.6, 17.‚Ä¶
## $ flipper_length_mm &lt;int&gt; 181, 186, 195, NA, 193, 190, 181, 195‚Ä¶
## $ body_mass_g       &lt;int&gt; 3750, 3800, 3250, NA, 3450, 3650, 362‚Ä¶
## $ sex               &lt;fct&gt; male, female, female, NA, female, mal‚Ä¶
## $ year              &lt;int&gt; 2007, 2007, 2007, 2007, 2007, 2007, 2‚Ä¶
```


---

# Plot

&lt;img src="workshop_files/figure-html/unnamed-chunk-47-1.png" width="70%" style="display: block; margin: auto;" /&gt;


---

# Code


```r
ggplot(data = penguins, 
       mapping = aes(x = bill_depth_mm, y = bill_length_mm,
                     color = species)) +
  geom_point() +
  labs(title = "Bill depth and length",
       subtitle = "Dimensions for Adelie, Chinstrap, and Gentoo Penguins",
       x = "Bill depth (mm)", y = "Bill length (mm)",
       color = "Species")
```

```
## Warning: Removed 2 rows containing missing values
## (`geom_point()`).
```

---
class: middle

# Wrapping Up...

---
class: middle

# Coding out loud

---

.midi[
&gt; **Start with the `penguins` data frame**
]

.pull-left[

```r
*ggplot(data = penguins)
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-48-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.midi[
&gt; Start with the `penguins` data frame,
&gt; **map bill depth to the x-axis**
]

.pull-left[

```r
ggplot(data = penguins,
*      mapping = aes(x = bill_depth_mm))
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-49-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.midi[
&gt; Start with the `penguins` data frame,
&gt; map bill depth to the x-axis
&gt; **and map bill length to the y-axis.**
]

.pull-left[

```r
ggplot(data = penguins,
       mapping = aes(x = bill_depth_mm,
*                    y = bill_length_mm))
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-50-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.midi[
&gt; Start with the `penguins` data frame,
&gt; map bill depth to the x-axis
&gt; and map bill length to the y-axis. 
&gt; **Represent each observation with a point**
]

.pull-left[

```r
ggplot(data = penguins,
       mapping = aes(x = bill_depth_mm,
                     y = bill_length_mm)) + 
* geom_point()
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-51-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.midi[
&gt; Start with the `penguins` data frame,
&gt; map bill depth to the x-axis
&gt; and map bill length to the y-axis. 
&gt; Represent each observation with a point
&gt; **and map species to the color of each point.**
]

.pull-left[

```r
ggplot(data = penguins,
       mapping = aes(x = bill_depth_mm,
                     y = bill_length_mm,
*                    color = species)) +
  geom_point()
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-52-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.midi[
&gt; Start with the `penguins` data frame,
&gt; map bill depth to the x-axis
&gt; and map bill length to the y-axis. 
&gt; Represent each observation with a point
&gt; and map species to the color of each point.
&gt; **Title the plot "Bill depth and length"**
]

.pull-left[

```r
ggplot(data = penguins,
       mapping = aes(x = bill_depth_mm,
                     y = bill_length_mm,
                     color = species)) +
  geom_point() +
* labs(title = "Bill depth and length")
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-53-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.midi[
&gt; Start with the `penguins` data frame,
&gt; map bill depth to the x-axis
&gt; and map bill length to the y-axis. 
&gt; Represent each observation with a point
&gt; and map species to the color of each point.
&gt; Title the plot "Bill depth and length", 
&gt; **add the subtitle "Dimensions for Adelie, Chinstrap, and Gentoo Penguins"**
]

.pull-left[

```r
ggplot(data = penguins,
       mapping = aes(x = bill_depth_mm,
                     y = bill_length_mm,
                     color = species)) +
  geom_point() +
  labs(title = "Bill depth and length",
*      subtitle = "Dimensions for Adelie, Chinstrap, and Gentoo Penguins")
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-54-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.midi[
&gt; Start with the `penguins` data frame,
&gt; map bill depth to the x-axis
&gt; and map bill length to the y-axis. 
&gt; Represent each observation with a point
&gt; and map species to the color of each point.
&gt; Title the plot "Bill depth and length", 
&gt; add the subtitle "Dimensions for Adelie, Chinstrap, and Gentoo Penguins", 
&gt; **label the x and y axes as "Bill depth (mm)" and "Bill length (mm)", respectively**
]

.pull-left[

```r
ggplot(data = penguins,
       mapping = aes(x = bill_depth_mm,
                     y = bill_length_mm,
                     color = species)) +
  geom_point() +
  labs(title = "Bill depth and length",
       subtitle = "Dimensions for Adelie, Chinstrap, and Gentoo Penguins",
*      x = "Bill depth (mm)", y = "Bill length (mm)")
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-55-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.midi[
&gt; Start with the `penguins` data frame,
&gt; map bill depth to the x-axis
&gt; and map bill length to the y-axis. 
&gt; Represent each observation with a point
&gt; and map species to the color of each point.
&gt; Title the plot "Bill depth and length", 
&gt; add the subtitle "Dimensions for Adelie, Chinstrap, and Gentoo Penguins", 
&gt; label the x and y axes as "Bill depth (mm)" and "Bill length (mm)", respectively,
&gt; **label the legend "Species"**
]

.pull-left[

```r
ggplot(data = penguins,
       mapping = aes(x = bill_depth_mm,
                     y = bill_length_mm,
                     color = species)) +
  geom_point() +
  labs(title = "Bill depth and length",
       subtitle = "Dimensions for Adelie, Chinstrap, and Gentoo Penguins",
       x = "Bill depth (mm)", y = "Bill length (mm)",
*      color = "Species")
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-56-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.midi[
&gt; Start with the `penguins` data frame,
&gt; map bill depth to the x-axis
&gt; and map bill length to the y-axis. 
&gt; Represent each observation with a point
&gt; and map species to the color of each point.
&gt; Title the plot "Bill depth and length", 
&gt; add the subtitle "Dimensions for Adelie, Chinstrap, and Gentoo Penguins", 
&gt; label the x and y axes as "Bill depth (mm)" and "Bill length (mm)", respectively,
&gt; label the legend "Species", 
&gt; **and add a caption for the data source.**
]

.pull-left[

```r
ggplot(data = penguins,
       mapping = aes(x = bill_depth_mm,
                     y = bill_length_mm,
                     color = species)) +
  geom_point() +
  labs(title = "Bill depth and length",
       subtitle = "Dimensions for Adelie, Chinstrap, and Gentoo Penguins",
       x = "Bill depth (mm)", y = "Bill length (mm)",
       color = "Species",
*      caption = "Source: Palmer Station LTER / palmerpenguins package")
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-57-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.midi[
&gt; Start with the `penguins` data frame,
&gt; map bill depth to the x-axis
&gt; and map bill length to the y-axis. 
&gt; Represent each observation with a point
&gt; and map species to the color of each point.
&gt; Title the plot "Bill depth and length", 
&gt; add the subtitle "Dimensions for Adelie, Chinstrap, and Gentoo Penguins", 
&gt; label the x and y axes as "Bill depth (mm)" and "Bill length (mm)", respectively,
&gt; label the legend "Species", 
&gt; and add a caption for the data source.
&gt; **Finally, use a discrete color scale that is designed to be perceived by viewers with common forms of color blindness.**
]

.pull-left[

```r
ggplot(data = penguins,
       mapping = aes(x = bill_depth_mm,
                     y = bill_length_mm,
                     color = species)) +
  geom_point() +
  labs(title = "Bill depth and length",
       subtitle = "Dimensions for Adelie, Chinstrap, and Gentoo Penguins",
       x = "Bill depth (mm)", y = "Bill length (mm)",
       color = "Species",
       caption = "Source: Palmer Station LTER / palmerpenguins package") +
* scale_color_viridis_d()
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-58-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

# Plot

&lt;img src="workshop_files/figure-html/unnamed-chunk-59-1.png" width="70%" style="display: block; margin: auto;" /&gt;

---

# Code


```r
ggplot(data = penguins,
       mapping = aes(x = bill_depth_mm,
                     y = bill_length_mm,
                     color = species)) +
  geom_point() +
  labs(title = "Bill depth and length",
       subtitle = "Dimensions for Adelie, Chinstrap, and Gentoo Penguins",
       x = "Bill depth (mm)", y = "Bill length (mm)",
       color = "Species",
       caption = "Source: Palmer Station LTER / palmerpenguins package") +
  scale_color_viridis_d()
```

```
## Warning: Removed 2 rows containing missing values
## (`geom_point()`).
```

---

# Narrative

.midi[
+ Start with the `penguins` data frame,
map bill depth to the x-axis
and map bill length to the y-axis. 
+ Represent each observation with a point
and map species to the color of each point.
+ Title the plot "Bill depth and length", 
add the subtitle "Dimensions for Adelie, Chinstrap, and Gentoo Penguins", 
label the x and y axes as "Bill depth (mm)" and "Bill length (mm)", respectively,
label the legend "Species", 
and add a caption for the data source.
+ Finally, use a discrete color scale that is designed to be perceived by viewers with common forms of color blindness.
]

---

## Argument names

.tip[
You can omit the names of first two arguments when building plots with `ggplot()`.
]

.pull-left[

```r
ggplot(data = penguins,
       mapping = aes(x = bill_depth_mm,
                     y = bill_length_mm,
                     color = species)) +
  geom_point() +
  scale_color_viridis_d()
```
]
.pull-right[

```r
ggplot(penguins,
       aes(x = bill_depth_mm,
           y = bill_length_mm,
           color = species)) +
  geom_point() +
  scale_color_viridis_d()
```
]

---

class: middle

# Wrapping Up...

---

class: middle

# Aesthetics

---

## Aesthetics options

Commonly used characteristics of plotting characters that can be **mapped to a specific variable** in the data are

- `color`
- `shape`
- `size`
- `alpha` (transparency)

---

## Color

.pull-left[

```r
ggplot(penguins,
       aes(x = bill_depth_mm, 
           y = bill_length_mm,
*          color = species)) +
  geom_point() +
  scale_color_viridis_d()
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-60-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Shape

Mapped to a different variable than `color`

.pull-left[

```r
ggplot(penguins,
       aes(x = bill_depth_mm, 
           y = bill_length_mm,
           color = species,
*          shape = island)) +
  geom_point() +
  scale_color_viridis_d()
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-61-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Shape

Mapped to same variable as `color`

.pull-left[

```r
ggplot(penguins,
       aes(x = bill_depth_mm, 
           y = bill_length_mm,
           color = species,
*          shape = species)) +
  geom_point() +
  scale_color_viridis_d()
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-62-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Size

.pull-left[

```r
ggplot(penguins,
       aes(x = bill_depth_mm, 
           y = bill_length_mm,
           color = species,
           shape = species,
*          size = body_mass_g)) +
  geom_point() +
  scale_color_viridis_d()
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-63-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Alpha

.pull-left[

```r
ggplot(penguins,
       aes(x = bill_depth_mm, 
           y = bill_length_mm,
           color = species,
           shape = species,
           size = body_mass_g,
*          alpha = flipper_length_mm)) +
  geom_point() +
  scale_color_viridis_d()
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-64-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

.pull-left[
**Mapping**


```r
ggplot(penguins,
       aes(x = bill_depth_mm,
           y = bill_length_mm,
*          size = body_mass_g,
*          alpha = flipper_length_mm)) +
  geom_point()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-65-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
**Setting**


```r
ggplot(penguins,
       aes(x = bill_depth_mm,
           y = bill_length_mm)) + 
* geom_point(size = 2, alpha = 0.5)
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-66-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Mapping vs. setting

- **Mapping:** Determine the size, alpha, etc. of points based on the values of a variable in the data
  - goes into `aes()`
- **Setting:** Determine the size, alpha, etc. of points **not** based on the values of a variable in the data
  - goes into `geom_*()` 
     - (in the previous example, we used `geom_point()` , 
         - but we'll learn about other geoms soon!)
  
---

class: middle

# Faceting

---

## Faceting

- Smaller plots that display different subsets of the data
- Useful for exploring conditional relationships and large data

---

### Plot
&lt;img src="workshop_files/figure-html/unnamed-chunk-67-1.png" width="70%" style="display: block; margin: auto;" /&gt;

---

### Code


```r
ggplot(penguins, aes(x = bill_depth_mm, y = bill_length_mm)) + 
  geom_point() +
* facet_grid(species ~ island)
```

```
## Warning: Removed 2 rows containing missing values
## (`geom_point()`).
```

---

## Various ways to facet


In the next few slides describe what each plot displays. Think about how the code relates to the output.

.question[
**Note:** The plots in the next few slides do not have proper titles, axis labels, etc. because we want you to figure out what's happening in the plots.
But you should always label your plots!
]

---


```r
ggplot(penguins, aes(x = bill_depth_mm, y = bill_length_mm)) + 
  geom_point() +
* facet_grid(species ~ sex)
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-68-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---


```r
ggplot(penguins, aes(x = bill_depth_mm, y = bill_length_mm)) + 
  geom_point() +
* facet_grid(sex ~ species)
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-69-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---


```r
ggplot(penguins, aes(x = bill_depth_mm, y = bill_length_mm)) + 
  geom_point() +
* facet_wrap(~ species)
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-70-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---


```r
ggplot(penguins, aes(x = bill_depth_mm, y = bill_length_mm)) + 
  geom_point() +
* facet_grid(. ~ species)
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-71-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---


```r
ggplot(penguins, aes(x = bill_depth_mm, y = bill_length_mm)) + 
  geom_point() +
* facet_wrap(~ species, ncol = 2)
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-72-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Faceting summary

- `facet_grid()`:
    - 2d grid
    - `rows ~ cols`
    - use `.` for no split
- `facet_wrap()`: 1d ribbon wrapped according to number of rows and columns specified or available plotting area

---

## Facet and color

.pull-left-narrow[

```r
ggplot(
  penguins, 
  aes(x = bill_depth_mm, 
      y = bill_length_mm, 
*     color = species)) +
  geom_point() +
  facet_grid(species ~ sex) +
* scale_color_viridis_d()
```
]
.pull-right-wide[
&lt;img src="workshop_files/figure-html/unnamed-chunk-73-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Facet and color, no legend

.pull-left-narrow[

```r
ggplot(
  penguins, 
  aes(x = bill_depth_mm, 
      y = bill_length_mm, 
      color = species)) +
  geom_point() +
  facet_grid(species ~ sex) +
  scale_color_viridis_d() +
* guides(color = FALSE)
```
]
.pull-right-wide[
&lt;img src="workshop_files/figure-html/unnamed-chunk-74-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

class: middle

# Wrapping Up...
---

class: center, middle 

# Visualizing numerical data&lt;br&gt; üî¢

---




class: middle

# Terminology

---

## Number of variables involved

- Univariate data analysis - distribution of single variable
- Bivariate data analysis - relationship between two variables
- Multivariate data analysis - relationship between many variables at once, 
  - usually focusing on the relationship between two while conditioning for others

---

## Types of variables

- **Numerical variables** can be classified as **continuous** or **discrete** based on whether or not the variable can take on an infinite number of values or only non-negative whole numbers, respectively.
- If the variable is **categorical**, we can determine if it is **ordinal** based on whether or not the levels have a natural ordering.

---

class: middle

# Data

---

## Data: Lending Club

.pull-left-wide[

- Thousands of loans made through the Lending Club,
  - a platform that allows individuals to lend to each other
- Not all loans are created equal 
  - ease of getting a loan depends on (apparent) ability to repay the loan
- Data includes loans *made* 
  - (these data are not loan applications)
]
.pull-right-narrow[
&lt;img src="img/lending-club.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Take a peek at data


```r
library(openintro)
glimpse(loans_full_schema)
```

```
## Rows: 10,000
## Columns: 55
## $ emp_title                        &lt;chr&gt; "global config enginee‚Ä¶
## $ emp_length                       &lt;dbl&gt; 3, 10, 3, 1, 10, NA, 1‚Ä¶
## $ state                            &lt;fct&gt; NJ, HI, WI, PA, CA, KY‚Ä¶
## $ homeownership                    &lt;fct&gt; MORTGAGE, RENT, RENT, ‚Ä¶
## $ annual_income                    &lt;dbl&gt; 90000, 40000, 40000, 3‚Ä¶
## $ verified_income                  &lt;fct&gt; Verified, Not Verified‚Ä¶
## $ debt_to_income                   &lt;dbl&gt; 18.01, 5.04, 21.15, 10‚Ä¶
## $ annual_income_joint              &lt;dbl&gt; NA, NA, NA, NA, 57000,‚Ä¶
## $ verification_income_joint        &lt;fct&gt; , , , , Verified, , No‚Ä¶
## $ debt_to_income_joint             &lt;dbl&gt; NA, NA, NA, NA, 37.66,‚Ä¶
## $ delinq_2y                        &lt;int&gt; 0, 0, 0, 0, 0, 1, 0, 1‚Ä¶
## $ months_since_last_delinq         &lt;int&gt; 38, NA, 28, NA, NA, 3,‚Ä¶
## $ earliest_credit_line             &lt;dbl&gt; 2001, 1996, 2006, 2007‚Ä¶
...
```

---

## Selected variables


```r
loans &lt;- loans_full_schema %&gt;%
  select(loan_amount, interest_rate, term, grade, 
         state, annual_income, homeownership, debt_to_income)
glimpse(loans)
```

```
## Rows: 10,000
## Columns: 8
## $ loan_amount    &lt;int&gt; 28000, 5000, 2000, 21600, 23000, 5000, 2‚Ä¶
## $ interest_rate  &lt;dbl&gt; 14.07, 12.61, 17.09, 6.72, 14.07, 6.72, ‚Ä¶
## $ term           &lt;dbl&gt; 60, 36, 36, 36, 36, 36, 60, 60, 36, 36, ‚Ä¶
## $ grade          &lt;ord&gt; C, C, D, A, C, A, C, B, C, A, C, B, C, B‚Ä¶
## $ state          &lt;fct&gt; NJ, HI, WI, PA, CA, KY, MI, AZ, NV, IL, ‚Ä¶
## $ annual_income  &lt;dbl&gt; 90000, 40000, 40000, 30000, 35000, 34000‚Ä¶
## $ homeownership  &lt;fct&gt; MORTGAGE, RENT, RENT, RENT, RENT, OWN, M‚Ä¶
## $ debt_to_income &lt;dbl&gt; 18.01, 5.04, 21.15, 10.16, 57.96, 6.46, ‚Ä¶
```

---

## Selected variables

&lt;br&gt;

.midi[
variable        | description
----------------|-------------
`loan_amount`   |	Amount of the loan received, in US dollars
`interest_rate` |	Interest rate on the loan, in an annual percentage
`term`	        | The length of the loan, which is always set as a whole number of months
`grade`	        | Loan grade, which takes a values A through G and represents the quality of the loan and its likelihood of being repaid
`state`         |	US state where the borrower resides
`annual_income` |	Borrower√¢‚Ç¨‚Ñ¢s annual income, including any second income, in US dollars
`homeownership`	| Indicates whether the person owns, owns but has a mortgage, or rents
`debt_to_income` | Debt-to-income ratio
]

---

## Variable types

&lt;br&gt;

variable        | type
----------------|-------------
`loan_amount`   |	numerical, continuous
`interest_rate` |	numerical, continuous
`term`	        | numerical, discrete
`grade`	        | categorical, ordinal
`state`         |	categorical, not ordinal
`annual_income` |	numerical, continuous
`homeownership`	| categorical, not ordinal
`debt_to_income` | numerical, continuous

---

class: middle

# Wrapping Up...

---

class: middle

# Visualizing numerical data

---

## Describing shapes of numerical distributions

- shape:
    - skewness: right-skewed, left-skewed, symmetric (skew is to the side of the longer tail)
    - modality: unimodal, bimodal, multimodal, uniform
- center: mean (`mean`), median (`median`), mode (not always useful)
- spread: range (`range`), standard deviation (`sd`), inter-quartile range (`IQR`)
- unusual observations

---

class: middle

# Histogram

---

## Histogram


```r
ggplot(loans, aes(x = loan_amount)) +
  geom_histogram()
```

```
## `stat_bin()` using `bins = 30`. Pick better value with
## `binwidth`.
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-78-1.png" width="30%" style="display: block; margin: auto;" /&gt;

---

## Histograms and binwidth 

+ binwidth = 1000


```r
ggplot(loans, aes(x = loan_amount)) +
  geom_histogram(binwidth = 1000)
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-79-1.png" width="30%" style="display: block; margin: auto;" /&gt;

---

## binwidth = 5000

```r
ggplot(loans, aes(x = loan_amount)) +
  geom_histogram(binwidth = 5000)
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-80-1.png" width="30%" style="display: block; margin: auto;" /&gt;

---

## binwidth = 20000


```r
ggplot(loans, aes(x = loan_amount)) +
  geom_histogram(binwidth = 20000)
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-81-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---

## Customizing histograms

.pull-left[
&lt;img src="workshop_files/figure-html/unnamed-chunk-82-1.png" width="100%" style="display: block; margin: auto;" /&gt;

]
.pull-right[.small[

```r
ggplot(loans, aes(x = loan_amount)) +
  geom_histogram(binwidth = 5000) +
* labs(
*   x = "Loan amount ($)",
*   y = "Frequency",
*   title = "Amounts of Lending Club loans"
* )
```
]
]


---

## Fill with a categorical variable

.pull-left[
&lt;img src="workshop_files/figure-html/unnamed-chunk-83-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[.small[

```r
ggplot(loans, aes(x = loan_amount, 
*                 fill = homeownership)) +
  geom_histogram(binwidth = 5000,
*                alpha = 0.5) +
  labs(
    x = "Loan amount ($)",
    y = "Frequency",
    title = "Amounts of Lending Club loans"
  )
```
]
]

---

## Facet with a categorical variable

.pull-left[
&lt;img src="workshop_files/figure-html/unnamed-chunk-84-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[.small[

```r
ggplot(loans, aes(x = loan_amount, fill = homeownership)) + 
  geom_histogram(binwidth = 5000) +
  labs(
    x = "Loan amount ($)",
    y = "Frequency",
    title = "Amounts of Lending Club loans"
  ) +
* facet_wrap(~ homeownership, nrow = 3)
```
]
]

---

class: middle

# Density plot

---

## Density plot


```r
ggplot(loans, aes(x = loan_amount)) +
  geom_density()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-85-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---

## Density plots and adjusting bandwidth

.pull-left[
+ adjust = 0.5

```r
ggplot(loans, aes(x = loan_amount)) +
  geom_density(adjust = 0.5)
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-86-1.png" width="50%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
+ adjust = 1

```r
ggplot(loans, aes(x = loan_amount)) +
  geom_density(adjust = 1) # default bandwidth
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-87-1.png" width="50%" style="display: block; margin: auto;" /&gt;
]
---

# adjust = 2

```r
ggplot(loans, aes(x = loan_amount)) +
  geom_density(adjust = 2)
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-88-1.png" width="50%" style="display: block; margin: auto;" /&gt;

---

## Customizing density plots

.pull-left[
&lt;img src="workshop_files/figure-html/unnamed-chunk-89-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[.small[

```r
ggplot(loans, aes(x = loan_amount)) +
  geom_density(adjust = 2) +
* labs(
*   x = "Loan amount ($)",
*   y = "Density",
*   title = "Amounts of Lending Club loans"
* )
```
]
]

---

## Adding a categorical variable

.pull-left[
&lt;img src="workshop_files/figure-html/unnamed-chunk-90-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[.small[

```r
ggplot(loans, aes(x = loan_amount, 
*                 fill = homeownership)) +
  geom_density(adjust = 2, 
*              alpha = 0.5) +
  labs(
    x = "Loan amount ($)",
    y = "Density",
    title = "Amounts of Lending Club loans", 
*   fill = "Homeownership"
  )
```
]
]

---

class: middle

# Box plot

---

## Box plot


```r
ggplot(loans, aes(x = interest_rate)) +
  geom_boxplot()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-91-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Box plot and outliers


```r
ggplot(loans, aes(x = annual_income)) +
  geom_boxplot()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-92-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Customizing box plots

.pull-left[
&lt;img src="workshop_files/figure-html/unnamed-chunk-93-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[.small[

```r
ggplot(loans, aes(x = interest_rate)) +
  geom_boxplot() +
  labs(
    x = "Interest rate (%)",
    y = NULL,
    title = "Interest rates of Lending Club loans"
  ) +
* theme(
*   axis.ticks.y = element_blank(),
*   axis.text.y = element_blank()
* )
```
]
]

---

## Adding a categorical variable

.pull-left[
&lt;img src="workshop_files/figure-html/unnamed-chunk-94-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]
.pull-right[.small[

```r
ggplot(loans, aes(x = interest_rate,
*                 y = grade)) +
  geom_boxplot() +
  labs(
    x = "Interest rate (%)",
    y = "Grade",
    title = "Interest rates of Lending Club loans",
*   subtitle = "by grade of loan"
  )
```
]
]

---

class: middle

# Relationships numerical variables

---

## Scatterplot


```r
ggplot(loans, aes(x = debt_to_income, y = interest_rate)) +
  geom_point()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-95-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Hex plot


```r
ggplot(loans, aes(x = debt_to_income, y = interest_rate)) +
  geom_hex()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-96-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Hex plot


```r
ggplot(loans %&gt;% filter(debt_to_income &lt; 100), 
       aes(x = debt_to_income, y = interest_rate)) +
  geom_hex()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-97-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---


# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))

---
class: center, middle 

#  Visualizing categorical data&lt;br&gt; üê±

---




class: middle

# Recap

---

## Variables

- **Numerical** variables can be classified as **continuous** or **discrete** based on whether or not the variable can take on an infinite number of values or only non-negative whole numbers, respectively.
- If the variable is **categorical**, we can determine if it is **ordinal** based on whether or not the levels have a natural ordering.

---

### Remember this Data?


```r
library(tidyverse)
starwars
```

```
## # A tibble: 87 √ó 15
##    name   height  mass hair_color skin_color eye_color birth_year
##    &lt;chr&gt;   &lt;int&gt; &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;chr&gt;          &lt;dbl&gt;
##  1 Luke ‚Ä¶    172    77 blond      fair       blue            19  
##  2 C-3PO     167    75 &lt;NA&gt;       gold       yellow         112  
##  3 R2-D2      96    32 &lt;NA&gt;       white, bl‚Ä¶ red             33  
##  4 Darth‚Ä¶    202   136 none       white      yellow          41.9
##  5 Leia ‚Ä¶    150    49 brown      light      brown           19  
##  6 Owen ‚Ä¶    178   120 brown, gr‚Ä¶ light      blue            52  
##  7 Beru ‚Ä¶    165    75 brown      light      blue            47  
##  8 R5-D4      97    32 &lt;NA&gt;       white, red red             NA  
##  9 Biggs‚Ä¶    183    84 black      light      brown           24  
## 10 Obi-W‚Ä¶    182    77 auburn, w‚Ä¶ fair       blue-gray       57  
## # ‚Ñπ 77 more rows
## # ‚Ñπ 8 more variables: sex &lt;chr&gt;, gender &lt;chr&gt;, homeworld &lt;chr&gt;,
## #   species &lt;chr&gt;, films &lt;list&gt;, vehicles &lt;list&gt;,
## #   starships &lt;list&gt;, hair_color2 &lt;fct&gt;
```


---
### Perhaps now?

```r
glimpse(starwars)
```

```
## Rows: 87
## Columns: 15
## $ name        &lt;chr&gt; "Luke Skywalker", "C-3PO", "R2-D2", "Darth ‚Ä¶
## $ height      &lt;int&gt; 172, 167, 96, 202, 150, 178, 165, 97, 183, ‚Ä¶
## $ mass        &lt;dbl&gt; 77.0, 75.0, 32.0, 136.0, 49.0, 120.0, 75.0,‚Ä¶
## $ hair_color  &lt;chr&gt; "blond", NA, NA, "none", "brown", "brown, g‚Ä¶
## $ skin_color  &lt;chr&gt; "fair", "gold", "white, blue", "white", "li‚Ä¶
## $ eye_color   &lt;chr&gt; "blue", "yellow", "red", "yellow", "brown",‚Ä¶
## $ birth_year  &lt;dbl&gt; 19.0, 112.0, 33.0, 41.9, 19.0, 52.0, 47.0, ‚Ä¶
## $ sex         &lt;chr&gt; "male", "none", "none", "male", "female", "‚Ä¶
## $ gender      &lt;chr&gt; "masculine", "masculine", "masculine", "mas‚Ä¶
## $ homeworld   &lt;chr&gt; "Tatooine", "Tatooine", "Naboo", "Tatooine"‚Ä¶
## $ species     &lt;chr&gt; "Human", "Droid", "Droid", "Human", "Human"‚Ä¶
## $ films       &lt;list&gt; &lt;"The Empire Strikes Back", "Revenge of th‚Ä¶
## $ vehicles    &lt;list&gt; &lt;"Snowspeeder", "Imperial Speeder Bike"&gt;, ‚Ä¶
## $ starships   &lt;list&gt; &lt;"X-wing", "Imperial shuttle"&gt;, &lt;&gt;, &lt;&gt;, "T‚Ä¶
## $ hair_color2 &lt;fct&gt; blond, NA, NA, Other, brown, Other, brown, ‚Ä¶
```

---

#### Recode hair color


```r
starwars &lt;- starwars %&gt;%
  mutate(hair_color2 =
           fct_other(hair_color,
                     keep = c("black", "brown", "brown", "blond")
           )
  )
```
---


class: middle

# Bar plot

---

## Bar plot


```r
ggplot(data = starwars, mapping = aes(x = gender)) +
  geom_bar()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-101-1.png" width="55%" style="display: block; margin: auto;" /&gt;

---

## Segmented bar plot: counts


```r
ggplot(data = starwars, mapping = aes(x = gender, 
*                 fill = hair_color))+
  geom_bar()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-102-1.png" width="55%" style="display: block; margin: auto;" /&gt;

---



## Segmented bar plots


```r
ggplot(data = starwars, mapping = aes(x = gender, 
*   fill = hair_color2))+
  geom_bar()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-103-1.png" width="55%" style="display: block; margin: auto;" /&gt;

---

## Segmented bar plots


```r
ggplot(data = starwars, mapping = aes(x = gender, 
*   fill = hair_color2))+
* geom_bar()+
  coord_flip()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-104-1.png" width="55%" style="display: block; margin: auto;" /&gt;

---

## Segmented bar plots: proportions


```r
ggplot(data = starwars,
       mapping = aes(x = gender, fill = hair_color2)) +
  geom_bar(position = "fill") +
  coord_flip()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-105-1.png" width="45%" style="display: block; margin: auto;" /&gt;

```r
labs(y = "proportion")
```

```
## $y
## [1] "proportion"
## 
## attr(,"class")
## [1] "labels"
```


---

.question[
    Which bar plot is a more useful representation for visualizing the relationship between gender and hair color?
  ]

.pull-left[
&lt;img src="workshop_files/figure-html/unnamed-chunk-106-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-107-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Customizing bar plots

.pull-left[
&lt;img src="workshop_files/figure-html/unnamed-chunk-108-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]
.pull-right[.small[

```r
*ggplot(starwars, aes(y = gender,
                  fill = hair_color2)) +
  geom_bar(position = "fill") +
* labs(
*   x = "Proportion",
*   y = "Gender",
*   fill = "Hair Color",
*   title = "Hair Colors of Starwars",
*   subtitle = "by gender"
* )
```
]



---

.your-turn[

    Time to actually play around with the Star Wars dataset!

      - Go to class git repo ([github.com/DataScience4Psych](https://github.com/DataScience4Psych)) and start `AE 03 - StarWars + Data visualization`.
    - Open the R Markdown document and complete the exercise (and if time allows, the stretch goal exercise).]

---


class: middle

# Relationships between numerical and categorical variables

---

## Already talked about...

- Coloring and faceting histograms and density plots
- Side-by-side box plots

---

## Violin plots


```r
ggplot(loans, aes(x = homeownership, y = loan_amount)) +
  geom_violin()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-109-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Ridge plots


```r
library(ggridges)
ggplot(loans, aes(x = loan_amount, y = grade, fill = grade, color = grade)) + 
  geom_density_ridges(alpha = 0.5)
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-110-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---


# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))

---

class: middle

# Wrapping Up...

---

class: center, middle 

#  Tidy data &lt;br&gt; üîß

---



## Tidy data

&gt;Happy families are all alike; every unhappy family is unhappy in its own way. 
&gt;
&gt;Leo Tolstoy

--

.pull-left[

**Characteristics of tidy data:**

- Each variable forms a column.
- Each observation forms a row.
- Each type of observational unit forms a table.
]

--
.pull-right[
**Characteristics of untidy data:**

!@#$%^&amp;*()
]

---

## 

.question[
What makes this data not tidy?
]

&lt;img src="img/hyperwar-airplanes-on-hand.png" width="70%" style="display: block; margin: auto;" /&gt;

.footnote[
Source: [Army Air Forces Statistical Digest, WW II](https://www.ibiblio.org/hyperwar/AAF/StatDigest/aafsd-3.html)
]

---

.question[
What makes this data not tidy?
]

&lt;br&gt;

&lt;img src="img/hiv-est-prevalence-15-49.png" width="70%" style="display: block; margin: auto;" /&gt;

.footnote[
Source: [Gapminder, Estimated HIV prevalence among 15-49 year olds](https://www.gapminder.org/data)
]

---

.question[
What makes this data not tidy?
]

&lt;br&gt;

&lt;img src="img/us-general-economic-characteristic-acs-2017.png" width="85%" style="display: block; margin: auto;" /&gt;

.footnote[
Source: [US Census Fact Finder, General Economic Characteristics, ACS 2017](https://factfinder.census.gov/faces/tableservices/jsf/pages/productview.xhtml?pid=ACS_17_5YR_DP03)
]

---

## Displaying vs. summarizing data


.pull-left[

```
## # A tibble: 87 √ó 3
##    name               height  mass
##    &lt;chr&gt;               &lt;int&gt; &lt;dbl&gt;
##  1 Luke Skywalker        172    77
##  2 C-3PO                 167    75
##  3 R2-D2                  96    32
##  4 Darth Vader           202   136
##  5 Leia Organa           150    49
##  6 Owen Lars             178   120
##  7 Beru Whitesun lars    165    75
##  8 R5-D4                  97    32
##  9 Biggs Darklighter     183    84
## 10 Obi-Wan Kenobi        182    77
## # ‚Ñπ 77 more rows
```
]
.pull-right[

```
## # A tibble: 3 √ó 2
##   gender    avg_ht
##   &lt;chr&gt;      &lt;dbl&gt;
## 1 feminine    165.
## 2 masculine   177.
## 3 &lt;NA&gt;        181.
```
]

---


.pull-left[

```r
starwars %&gt;%
  select(name, height, mass)
```
]
.pull-right[

```r
starwars %&gt;%
  group_by(gender) %&gt;%
  summarize(
    avg_ht = mean(height, na.rm = TRUE)
    )
```
]
---

class: middle

# Wrapping Up...
---

class: middle

# Data structures in R

---
## Data structures in R
Three main ways to store data:

- Matrix: 
  - Requires all the elements to be of the same type (e.g. numeric or character)
- Data frame: 
  - Allows for mixed types of variables
- Tibble: 
  - Like a data frame, but works more consistently

---
## Tibbles

Tibbles are a better version of data frames.

- The [documentation](https://tibble.tidyverse.org/) describes them as 

--
&gt;"data.frames for the lazy and surly: 
&gt;
&gt;they do less 
&gt;
&gt;(i.e. they don√¢‚Ç¨‚Ñ¢t change variable names or types,
&gt;
&gt;and don√¢‚Ç¨‚Ñ¢t do partial matching)
&gt;
&gt;and complain more
&gt;s
&gt;(e.g. when a variable does not exist)."

---

## Two other advantages:

1. They subset more consistently: 
  - when you use square brackets to subset a tibble, 
      - you always get another tibble. 
  - With data frames, you sometimes get a vector and sometimes get a data frame.
2. They print more elegantly.

--

#### Compared to base R
+ Base R functions, (including those for data frames), 
  + try to guess what you want to do.
+ Sometimes, this "helpful" guessing  leads to unexpected outcomes, 
  + so tibbles have done away with most of that.

---

## Tibbles don't change names

. . .
.midi[

```r
library(tidyverse)
(df = data.frame("a" = 1:5, "b 2" = 5:1))
```

```
##   a b.2
## 1 1   5
## 2 2   4
## 3 3   3
## 4 4   2
## 5 5   1
```

```r
(ti = tibble("a" = 1:5, "b 2" = 5:1))
```

```
## # A tibble: 5 √ó 2
##       a `b 2`
##   &lt;int&gt; &lt;int&gt;
## 1     1     5
## 2     2     4
## 3     3     3
## 4     4     2
## 5     5     1
```
]
---

## Tibbles complain about bad column names

. . .


```r
df$c
```

```
## NULL
```

```r
ti$c
```

```
## Warning: Unknown or uninitialised column: `c`.
```

```
## NULL
```

---

## Tibbles subset consistently

. . .


```r
df[,1]
```

```
## [1] 1 2 3 4 5
```

```r
ti[,1]
```

```
## # A tibble: 5 √ó 1
##       a
##   &lt;int&gt;
## 1     1
## 2     2
## 3     3
## 4     4
## 5     5
```

---

## Tibbles don't *do* partial matching

. . .


```r
df$b
```

```
## [1] 5 4 3 2 1
```

```r
ti$b
```

```
## Warning: Unknown or uninitialised column: `b`.
```

```
## NULL
```

---

## Tibbles don't coerce strings to factors

Previously...

```r
df = data.frame(l1 = letters[1:5])
```

The most annoying thing about data frames:

```r
df$l2 = letters[1:5]
class(df$l1)
```

```
## [1] "factor"
```

```r
class(df$l2)
```

```
## [1] "character"
```

---

# Tibbles don't have this problem

```r
## but with tibbles it's all the same
ti = tibble(l1 = letters[1:5])
ti$l2 = letters[1:5]
class(ti$l1)
```

```
## [1] "character"
```

```r
class(ti$l2)
```

```
## [1] "character"
```

---

# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))
- Julia Fukuyama's EDA ([link](https://jfukuyama.github.io/))


---

class: middle

# Wrapping Up...

---

## Ok...So... technically... 

Base R has fixed this issue...


```r
df = data.frame(l1 = letters[1:5])
df$l2 = letters[1:5]
class(df$l1)
```

```
## [1] "character"
```

```r
class(df$l2)
```

```
## [1] "character"
```


---
class: center, middle 

#  Grammar of data wrangling &lt;br&gt; üîÆ


---



## A grammar of data wrangling...

... based on the concepts of functions as verbs that manipulate data frames

.pull-left[
&lt;img src="img/dplyr-part-of-tidyverse.png" width="70%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
.midi[
- `select`: pick columns by name
- `arrange`: reorder rows
- `slice`: pick rows using index(es)
- `filter`: pick rows matching criteria
- `distinct`: filter for unique rows
- `mutate`: add new variables
- `summarize`: reduce variables to values
- `group_by`: for grouped operations
- ... (many more)
]
]

---

## Rules of **dplyr** functions

- First argument is *always* a data frame
- Subsequent arguments say what to do with that data frame
- Always return a data frame
- Don't modify in place

---

## Data: Hotel bookings

- Data from two hotels: one resort and one city hotel
- Observations: Each row represents a hotel booking
- Goal for original data collection: Development of prediction models to classify a hotel booking's likelihood to be canceled ([Antonia et al., 2019](https://www.sciencedirect.com/science/article/pii/S2352340918315191#bib5))


```r
hotels &lt;- read_csv("data/hotels.csv")
```

.footnote[
Source: [TidyTuesday](https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-02-11/readme.md)
]

---

## First look: Variables


```r
names(hotels)
```

```
##  [1] "hotel"                         
##  [2] "is_canceled"                   
##  [3] "lead_time"                     
##  [4] "arrival_date_year"             
##  [5] "arrival_date_month"            
##  [6] "arrival_date_week_number"      
##  [7] "arrival_date_day_of_month"     
##  [8] "stays_in_weekend_nights"       
##  [9] "stays_in_week_nights"          
## [10] "adults"                        
## [11] "children"                      
## [12] "babies"                        
## [13] "meal"                          
## [14] "country"                       
## [15] "market_segment"                
...
```

---

## Second look: Overview


```r
glimpse(hotels)
```

```
## Rows: 119,390
## Columns: 32
## $ hotel                          &lt;chr&gt; "Resort Hotel", "Resort ‚Ä¶
## $ is_canceled                    &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, ‚Ä¶
## $ lead_time                      &lt;dbl&gt; 342, 737, 7, 13, 14, 14,‚Ä¶
## $ arrival_date_year              &lt;dbl&gt; 2015, 2015, 2015, 2015, ‚Ä¶
## $ arrival_date_month             &lt;chr&gt; "July", "July", "July", ‚Ä¶
## $ arrival_date_week_number       &lt;dbl&gt; 27, 27, 27, 27, 27, 27, ‚Ä¶
## $ arrival_date_day_of_month      &lt;dbl&gt; 1, 1, 1, 1, 1, 1, 1, 1, ‚Ä¶
## $ stays_in_weekend_nights        &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, ‚Ä¶
## $ stays_in_week_nights           &lt;dbl&gt; 0, 0, 1, 1, 2, 2, 2, 2, ‚Ä¶
## $ adults                         &lt;dbl&gt; 2, 2, 1, 1, 2, 2, 2, 2, ‚Ä¶
## $ children                       &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, ‚Ä¶
## $ babies                         &lt;dbl&gt; 0, 0, 0, 0, 0, 0, 0, 0, ‚Ä¶
## $ meal                           &lt;chr&gt; "BB", "BB", "BB", "BB", ‚Ä¶
...
```

---

## Select a single column

View only `lead_time` (number of days between booking and arrival date):


```r
select(hotels, lead_time)
```

```
## # A tibble: 119,390 √ó 1
##    lead_time
##        &lt;dbl&gt;
##  1       342
##  2       737
##  3         7
##  4        13
##  5        14
##  6        14
##  7         0
##  8         9
##  9        85
## 10        75
## # ‚Ñπ 119,380 more rows
```

---

## Select a single column

.pull-left[

```r
*select(
  hotels, 
  lead_time
  )
```
]
.pull-right[
- Start with the function (a verb): `select()`
]

---

## Select a single column

.pull-left[

```r
select( 
* hotels,
  lead_time
  )
```
]
.pull-right[
- Start with the function (a verb): `select()`
- First argument: data frame we're working with , `hotels`
]

---

## Select a single column

.pull-left[

```r
select( 
  hotels, 
* lead_time
  )
```
]
.pull-right[
- Start with the function (a verb): `select()`
- First argument: data frame we're working with , `hotels`
- Second argument: variable we want to select, `lead_time`
]

---

## Select a single column

.pull-left[

```r
select( 
  hotels, 
  lead_time
  )
```

```
## # A tibble: 119,390 √ó 1
##    lead_time
##        &lt;dbl&gt;
##  1       342
##  2       737
##  3         7
##  4        13
##  5        14
##  6        14
##  7         0
##  8         9
##  9        85
## 10        75
## # ‚Ñπ 119,380 more rows
```
]
.pull-right[
- Start with the function (a verb): `select()`
- First argument: data frame we're working with , `hotels`
- Second argument: variable we want to select, `lead_time`
- Result: data frame with 119390 rows and 1 column
]

---

.tip[
dplyr functions always expect a data frame and always yield a data frame.
]


```r
select(hotels, lead_time)
```

```
## # A tibble: 119,390 √ó 1
##    lead_time
##        &lt;dbl&gt;
##  1       342
##  2       737
##  3         7
##  4        13
##  5        14
##  6        14
##  7         0
##  8         9
##  9        85
## 10        75
## # ‚Ñπ 119,380 more rows
```

---

## Select multiple columns


View only the `hotel` type and `lead_time`:

--

.pull-left[

```r
select(hotels, hotel, lead_time)
```

```
## # A tibble: 119,390 √ó 2
##    hotel        lead_time
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 Resort Hotel       342
##  2 Resort Hotel       737
##  3 Resort Hotel         7
##  4 Resort Hotel        13
##  5 Resort Hotel        14
##  6 Resort Hotel        14
##  7 Resort Hotel         0
##  8 Resort Hotel         9
##  9 Resort Hotel        85
## 10 Resort Hotel        75
## # ‚Ñπ 119,380 more rows
```
]
--
.pull-right[
.question[
What if we wanted to select these columns, and then arrange the data in descending order of lead time?
]
]

---

## Data wrangling, step-by-step

.pull-left[
Select:

```r
hotels %&gt;%
  select(hotel, lead_time)
```

```
## # A tibble: 119,390 √ó 2
##    hotel        lead_time
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 Resort Hotel       342
##  2 Resort Hotel       737
##  3 Resort Hotel         7
##  4 Resort Hotel        13
##  5 Resort Hotel        14
##  6 Resort Hotel        14
##  7 Resort Hotel         0
##  8 Resort Hotel         9
##  9 Resort Hotel        85
## 10 Resort Hotel        75
## # ‚Ñπ 119,380 more rows
```
]

--
.pull-right[
Select, then arrange:

```r
hotels %&gt;%
  select(hotel, lead_time) %&gt;%
  arrange(desc(lead_time))
```

```
## # A tibble: 119,390 √ó 2
##    hotel        lead_time
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 Resort Hotel       737
##  2 Resort Hotel       709
##  3 City Hotel         629
##  4 City Hotel         629
##  5 City Hotel         629
##  6 City Hotel         629
##  7 City Hotel         629
##  8 City Hotel         629
##  9 City Hotel         629
## 10 City Hotel         629
## # ‚Ñπ 119,380 more rows
```
]
---

class: middle

# Wrapping Up...

---

class: middle

# Pipes

---

## What is a pipe?

In programming, a pipe is a technique for passing information from one process to another.

--

.pull-left[
- Start with the data frame `hotels`, and pass it to the `select()` function,
]
.pull-right[
.small[

```r
*hotels %&gt;%
  select(hotel, lead_time) %&gt;%
  arrange(desc(lead_time))
```

```
## # A tibble: 119,390 √ó 2
##    hotel        lead_time
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 Resort Hotel       737
##  2 Resort Hotel       709
##  3 City Hotel         629
##  4 City Hotel         629
##  5 City Hotel         629
##  6 City Hotel         629
##  7 City Hotel         629
##  8 City Hotel         629
##  9 City Hotel         629
## 10 City Hotel         629
## # ‚Ñπ 119,380 more rows
```
]
]

---

## What is a pipe?

In programming, a pipe is a technique for passing information from one process to another.

.pull-left[
- Start with the data frame `hotels`, and pass it to the `select()` function,
- then we select the variables `hotel` and `lead_time`,
]
.pull-right[
.small[

```r
hotels %&gt;%
* select(hotel, lead_time) %&gt;%
  arrange(desc(lead_time))
```

```
## # A tibble: 119,390 √ó 2
##    hotel        lead_time
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 Resort Hotel       737
##  2 Resort Hotel       709
##  3 City Hotel         629
##  4 City Hotel         629
##  5 City Hotel         629
##  6 City Hotel         629
##  7 City Hotel         629
##  8 City Hotel         629
##  9 City Hotel         629
## 10 City Hotel         629
## # ‚Ñπ 119,380 more rows
```
]
]

---

## What is a pipe?

In programming, a pipe is a technique for passing information from one process to another.

.pull-left[
- Start with the data frame `hotels`, and pass it to the `select()` function,
- then we select the variables `hotel` and `lead_time`,
- and then we arrange the data frame by `lead_time` in descending order.
]
.pull-right[
.small[

```r
hotels %&gt;%
  select(hotel, lead_time) %&gt;% 
* arrange(desc(lead_time))
```

```
## # A tibble: 119,390 √ó 2
##    hotel        lead_time
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 Resort Hotel       737
##  2 Resort Hotel       709
##  3 City Hotel         629
##  4 City Hotel         629
##  5 City Hotel         629
##  6 City Hotel         629
##  7 City Hotel         629
##  8 City Hotel         629
##  9 City Hotel         629
## 10 City Hotel         629
## # ‚Ñπ 119,380 more rows
```
]
]

---

## Aside

The pipe operator is implemented in the package **magrittr**, though we don't need to load this package explicitly since **tidyverse** does this for us.

--

.question[
Any guesses as to why the package is called magrittr?
]

--

.pull-left[
&lt;img src="img/magritte.jpg" width="90%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
&lt;img src="img/magrittr.jpg" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## How does a pipe work?

- You can think about the following sequence of actions - find keys, 
unlock car, start car, drive to work, park.

--
- Expressed as a set of nested functions in R pseudocode this would look like:

```r
park(drive(start_car(find("keys")), to = "work"))
```

--
- Writing it out using pipes give it a more natural (and easier to read) 
structure:

```r
find("keys") %&gt;%
  start_car() %&gt;%
  drive(to = "work") %&gt;%
  park()
```

---
## What about other arguments?

Use the dot to

- send results to a function argument other than first one or 
- use the previous result for multiple arguments


```r
hotels %&gt;%
  filter(hotel == "Resort Hotel") %&gt;%
* lm(adr ~ lead_time, data = .)
```

```
## 
## Call:
## lm(formula = adr ~ lead_time, data = .)
## 
## Coefficients:
## (Intercept)    lead_time  
##    93.16876      0.01925
```

---
## A note on piping and layering

- `%&gt;%` used mainly in **dplyr** pipelines, *we pipe the output of the previous line of code as the first input of the next line of code*

--
- `+` used in **ggplot2** plots is used for "layering", *we create the plot in layers, separated by `+`*

---

## dplyr

.midi[
‚ùå


```r
hotels +
  select(hotel, lead_time)
```

```
## Error in select(hotel, lead_time): object 'hotel' not found
```

‚úÖ


```r
hotels %&gt;%
  select(hotel, lead_time)
```


```
## # A tibble: 119,390 √ó 2
##    hotel        lead_time
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 Resort Hotel       342
##  2 Resort Hotel       737
##  3 Resort Hotel         7
...
```
]

---

## ggplot2

.midi[
‚ùå


```r
ggplot(hotels, aes(x = hotel, fill = deposit_type)) %&gt;%
  geom_bar()
```

```
## Error in `geom_bar()`:
## ! `mapping` must be created by `aes()`
## ‚Ñπ Did you use `%&gt;%` or `|&gt;` instead of `+`?
```

‚úÖ


```r
ggplot(hotels, aes(x = hotel, fill = deposit_type)) +
  geom_bar()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-146-1.png" width="25%" style="display: block; margin: auto;" /&gt;
]

---

## Code styling

Many of the styling principles are consistent across `%&gt;%` and `+`:

- always a space before
- always a line break after (for pipelines with more than 2 lines)

‚ùå


```r
ggplot(hotels,aes(x=hotel,y=deposit_type))+geom_bar()
```

‚úÖ


```r
ggplot(hotels, aes(x = hotel, y = deposit_type)) + 
  geom_bar()
```

---

# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))


---
class: middle

# Wrapping Up...

---
class: center, middle 

# Hands on Data Wrangling &lt;br&gt; üîß


---


class: middle

# Working with a single data frame

---

class: middle

.hand[You...]

.huge-blue[have] .hand[a single data frame]

.huge-pink[want] .hand[to slice it, and dice it, and juice it, and process it]

---

## `select` to keep variables

.medi[

```r
hotels %&gt;%
* select(hotel, lead_time)
```

```
## # A tibble: 119,390 √ó 2
##    hotel        lead_time
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 Resort Hotel       342
##  2 Resort Hotel       737
##  3 Resort Hotel         7
##  4 Resort Hotel        13
##  5 Resort Hotel        14
##  6 Resort Hotel        14
##  7 Resort Hotel         0
##  8 Resort Hotel         9
##  9 Resort Hotel        85
## 10 Resort Hotel        75
## # ‚Ñπ 119,380 more rows
```
]
---

## `select` to exclude variables

.small[

```r
hotels %&gt;%
* select(-agent)
```

```
## # A tibble: 119,390 √ó 31
##    hotel        is_canceled lead_time arrival_date_year
##    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;             &lt;dbl&gt;
##  1 Resort Hotel           0       342              2015
##  2 Resort Hotel           0       737              2015
##  3 Resort Hotel           0         7              2015
##  4 Resort Hotel           0        13              2015
##  5 Resort Hotel           0        14              2015
##  6 Resort Hotel           0        14              2015
##  7 Resort Hotel           0         0              2015
##  8 Resort Hotel           0         9              2015
##  9 Resort Hotel           1        85              2015
## 10 Resort Hotel           1        75              2015
## # ‚Ñπ 119,380 more rows
## # ‚Ñπ 27 more variables: arrival_date_month &lt;chr&gt;,
## #   arrival_date_week_number &lt;dbl&gt;,
## #   arrival_date_day_of_month &lt;dbl&gt;,
## #   stays_in_weekend_nights &lt;dbl&gt;, stays_in_week_nights &lt;dbl&gt;,
## #   adults &lt;dbl&gt;, children &lt;dbl&gt;, babies &lt;dbl&gt;, meal &lt;chr&gt;,
## #   country &lt;chr&gt;, market_segment &lt;chr&gt;, ‚Ä¶
```
]

---

## `select` a range of variables
.medi[

```r
hotels %&gt;%
* select(hotel:arrival_date_month)
```

```
## # A tibble: 119,390 √ó 5
##    hotel        is_canceled lead_time arrival_date_year
##    &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;             &lt;dbl&gt;
##  1 Resort Hotel           0       342              2015
##  2 Resort Hotel           0       737              2015
##  3 Resort Hotel           0         7              2015
##  4 Resort Hotel           0        13              2015
##  5 Resort Hotel           0        14              2015
##  6 Resort Hotel           0        14              2015
##  7 Resort Hotel           0         0              2015
##  8 Resort Hotel           0         9              2015
##  9 Resort Hotel           1        85              2015
## 10 Resort Hotel           1        75              2015
## # ‚Ñπ 119,380 more rows
## # ‚Ñπ 1 more variable: arrival_date_month &lt;chr&gt;
```
]
---

## `select` variables with certain characteristics
.medi[

```r
hotels %&gt;%
* select(starts_with("arrival"))
```

```
## # A tibble: 119,390 √ó 4
##    arrival_date_year arrival_date_month arrival_date_week_number
##                &lt;dbl&gt; &lt;chr&gt;                                 &lt;dbl&gt;
##  1              2015 July                                     27
##  2              2015 July                                     27
##  3              2015 July                                     27
##  4              2015 July                                     27
##  5              2015 July                                     27
##  6              2015 July                                     27
##  7              2015 July                                     27
##  8              2015 July                                     27
##  9              2015 July                                     27
## 10              2015 July                                     27
## # ‚Ñπ 119,380 more rows
## # ‚Ñπ 1 more variable: arrival_date_day_of_month &lt;dbl&gt;
```
]
---

## `select` variables with certain characteristics
.medi[

```r
hotels %&gt;%
* select(ends_with("type"))
```

```
## # A tibble: 119,390 √ó 4
##    reserved_room_type assigned_room_type deposit_type
##    &lt;chr&gt;              &lt;chr&gt;              &lt;chr&gt;       
##  1 C                  C                  No Deposit  
##  2 C                  C                  No Deposit  
##  3 A                  C                  No Deposit  
##  4 A                  A                  No Deposit  
##  5 A                  A                  No Deposit  
##  6 A                  A                  No Deposit  
##  7 C                  C                  No Deposit  
##  8 C                  C                  No Deposit  
##  9 A                  A                  No Deposit  
## 10 D                  D                  No Deposit  
## # ‚Ñπ 119,380 more rows
## # ‚Ñπ 1 more variable: customer_type &lt;chr&gt;
```
]
---

## Select helpers

- `starts_with()`: Starts with a prefix
- `ends_with()`: Ends with a suffix
- `contains()`: Contains a literal string
- `num_range()`: Matches a numerical range like x01, x02, x03
- `one_of()`: Matches variable names in a character vector
- `everything()`: Matches all variables
- `last_col()`: Select last variable, possibly with an offset
- `matches()`: Matches a regular expression (a sequence of symbols/characters expressing a string/pattern to be searched for within text)

.footnote[
See help for any of these functions for more info, e.g. `?everything`.
]

---

## `arrange` in ascending / descending order

.pull-left[

```r
hotels %&gt;%
  select(adults, children, babies) %&gt;%
* arrange(babies)
```

```
## # A tibble: 119,390 √ó 3
##    adults children babies
##     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1      2        0      0
##  2      2        0      0
##  3      1        0      0
##  4      1        0      0
##  5      2        0      0
##  6      2        0      0
##  7      2        0      0
##  8      2        0      0
##  9      2        0      0
## 10      2        0      0
## # ‚Ñπ 119,380 more rows
```
]
.pull-right[

```r
hotels %&gt;%
  select(adults, children, babies) %&gt;%
* arrange(desc(babies))
```

```
## # A tibble: 119,390 √ó 3
##    adults children babies
##     &lt;dbl&gt;    &lt;dbl&gt;  &lt;dbl&gt;
##  1      2        0     10
##  2      1        0      9
##  3      2        0      2
##  4      2        0      2
##  5      2        0      2
##  6      2        0      2
##  7      2        0      2
##  8      2        0      2
##  9      2        0      2
## 10      2        0      2
## # ‚Ñπ 119,380 more rows
```
]

---

## `slice` for certain row numbers

.midi[

```r
# first five
hotels %&gt;%
* slice(1:5)
```

```
## # A tibble: 5 √ó 32
##   hotel        is_canceled lead_time arrival_date_year
##   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;             &lt;dbl&gt;
## 1 Resort Hotel           0       342              2015
## 2 Resort Hotel           0       737              2015
## 3 Resort Hotel           0         7              2015
## 4 Resort Hotel           0        13              2015
## 5 Resort Hotel           0        14              2015
## # ‚Ñπ 28 more variables: arrival_date_month &lt;chr&gt;,
## #   arrival_date_week_number &lt;dbl&gt;,
## #   arrival_date_day_of_month &lt;dbl&gt;,
## #   stays_in_weekend_nights &lt;dbl&gt;, stays_in_week_nights &lt;dbl&gt;,
## #   adults &lt;dbl&gt;, children &lt;dbl&gt;, babies &lt;dbl&gt;, meal &lt;chr&gt;,
## #   country &lt;chr&gt;, market_segment &lt;chr&gt;,
## #   distribution_channel &lt;chr&gt;, is_repeated_guest &lt;dbl&gt;, ‚Ä¶
```
]

---

.tip[
+ In R, you can use the `#` (hashtag or pound sign, depending on your age 
üòú) for adding comments to your code. 
Any text following `#` will be printed as is, and won't be run as R code.
+ This symbol is useful for leaving comments in your code and for temporarily disabling 
certain lines of code while debugging.
]
--
.xsmall[

```r
hotels %&gt;%
  # slice the first five rows  # this line is a comment
  #select(hotel) %&gt;%           # this one doesn't run
  slice(1:5)                   # this line runs
```

```
## # A tibble: 5 √ó 32
##   hotel        is_canceled lead_time arrival_date_year
##   &lt;chr&gt;              &lt;dbl&gt;     &lt;dbl&gt;             &lt;dbl&gt;
## 1 Resort Hotel           0       342              2015
## 2 Resort Hotel           0       737              2015
## 3 Resort Hotel           0         7              2015
## 4 Resort Hotel           0        13              2015
## 5 Resort Hotel           0        14              2015
## # ‚Ñπ 28 more variables: arrival_date_month &lt;chr&gt;,
## #   arrival_date_week_number &lt;dbl&gt;,
## #   arrival_date_day_of_month &lt;dbl&gt;,
## #   stays_in_weekend_nights &lt;dbl&gt;, stays_in_week_nights &lt;dbl&gt;,
## #   adults &lt;dbl&gt;, children &lt;dbl&gt;, babies &lt;dbl&gt;, meal &lt;chr&gt;,
## #   country &lt;chr&gt;, market_segment &lt;chr&gt;,
## #   distribution_channel &lt;chr&gt;, is_repeated_guest &lt;dbl&gt;, ‚Ä¶
```
]

---

## `slice` for certain row numbers

.small[

```r
# last five
last_row &lt;- nrow(hotels)         # nrow() gives the number of rows in a data frame
hotels %&gt;%
* slice((last_row - 4):last_row)
```

```
## # A tibble: 5 √ó 32
##   hotel      is_canceled lead_time arrival_date_year
##   &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;             &lt;dbl&gt;
## 1 City Hotel           0        23              2017
## 2 City Hotel           0       102              2017
## 3 City Hotel           0        34              2017
## 4 City Hotel           0       109              2017
## 5 City Hotel           0       205              2017
## # ‚Ñπ 28 more variables: arrival_date_month &lt;chr&gt;,
## #   arrival_date_week_number &lt;dbl&gt;,
## #   arrival_date_day_of_month &lt;dbl&gt;,
## #   stays_in_weekend_nights &lt;dbl&gt;, stays_in_week_nights &lt;dbl&gt;,
## #   adults &lt;dbl&gt;, children &lt;dbl&gt;, babies &lt;dbl&gt;, meal &lt;chr&gt;,
## #   country &lt;chr&gt;, market_segment &lt;chr&gt;,
## #   distribution_channel &lt;chr&gt;, is_repeated_guest &lt;dbl&gt;, ‚Ä¶
```
]

---

## `filter` to select a subset of rows

.small[

```r
# bookings in City Hotels
hotels %&gt;%
* filter(hotel == "City Hotel")
```

```
## # A tibble: 79,330 √ó 32
##    hotel      is_canceled lead_time arrival_date_year
##    &lt;chr&gt;            &lt;dbl&gt;     &lt;dbl&gt;             &lt;dbl&gt;
##  1 City Hotel           0         6              2015
##  2 City Hotel           1        88              2015
##  3 City Hotel           1        65              2015
##  4 City Hotel           1        92              2015
##  5 City Hotel           1       100              2015
##  6 City Hotel           1        79              2015
##  7 City Hotel           0         3              2015
##  8 City Hotel           1        63              2015
##  9 City Hotel           1        62              2015
## 10 City Hotel           1        62              2015
## # ‚Ñπ 79,320 more rows
## # ‚Ñπ 28 more variables: arrival_date_month &lt;chr&gt;,
## #   arrival_date_week_number &lt;dbl&gt;,
## #   arrival_date_day_of_month &lt;dbl&gt;,
## #   stays_in_weekend_nights &lt;dbl&gt;, stays_in_week_nights &lt;dbl&gt;,
## #   adults &lt;dbl&gt;, children &lt;dbl&gt;, babies &lt;dbl&gt;, meal &lt;chr&gt;,
## #   country &lt;chr&gt;, market_segment &lt;chr&gt;, ‚Ä¶
```
]

---

## `filter` for many conditions at once
.medi[

```r
hotels %&gt;%
  filter( 
*   adults == 0,
*   children &gt;= 1
    ) %&gt;% 
  select(adults, babies, children)
```

```
## # A tibble: 223 √ó 3
##    adults babies children
##     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1      0      0        3
##  2      0      0        2
##  3      0      0        2
##  4      0      0        2
##  5      0      0        2
##  6      0      0        3
##  7      0      1        2
##  8      0      0        2
##  9      0      0        2
## 10      0      0        2
## # ‚Ñπ 213 more rows
```
]
---

## `filter` for more complex conditions
.midi[

```r
# bookings with no adults and some children or babies in the room
hotels %&gt;%
  filter( 
    adults == 0,     
*   children &gt;= 1 | babies &gt;= 1     # | means or
    ) %&gt;%
  select(adults, babies, children)
```

```
## # A tibble: 223 √ó 3
##    adults babies children
##     &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
##  1      0      0        3
##  2      0      0        2
##  3      0      0        2
##  4      0      0        2
##  5      0      0        2
##  6      0      0        3
##  7      0      1        2
##  8      0      0        2
##  9      0      0        2
## 10      0      0        2
## # ‚Ñπ 213 more rows
```
]
---

## Logical operators in R

&lt;br&gt;

operator    | definition                   || operator     | definition
------------|------------------------------||--------------|----------------
`&lt;`         | less than                    ||`x`&amp;nbsp;&amp;#124;&amp;nbsp;`y`     | `x` OR `y` 
`&lt;=`        |	less than or equal to        ||`is.na(x)`    | test if `x` is `NA`
`&gt;`         | greater than                 ||`!is.na(x)`   | test if `x` is not `NA`
`&gt;=`        |	greater than or equal to     ||`x %in% y`    | test if `x` is in `y`
`==`        |	exactly equal to             ||`!(x %in% y)` | test if `x` is not in `y`
`!=`        |	not equal to                 ||`!x`          | not `x`
`x &amp; y`     | `x` AND `y`                  ||              |

---

.your-turn[

Time to actually play around with the Hotels dataset!

- Go to class git repo ([github.com/DataScience4Psych](https://github.com/DataScience4Psych)) and start `AE 04 - Hotels + Data wrangling`.
- Open the R Markdown document and complete Exercises 1 - 4.

]

---

class: middle

# Pause ...

---




class: middle

# Moving Along...

---

## `distinct` to filter for unique rows

... and `arrange` to order alphabetically

.small[
.pull-left[

```r
hotels %&gt;% 
* distinct(market_segment) %&gt;%
  arrange(market_segment)
```

```
## # A tibble: 8 √ó 1
##   market_segment
##   &lt;chr&gt;         
## 1 Aviation      
## 2 Complementary 
## 3 Corporate     
## 4 Direct        
## 5 Groups        
## 6 Offline TA/TO 
## 7 Online TA     
## 8 Undefined
```
]
.pull-right[

```r
hotels %&gt;% 
* distinct(hotel, market_segment) %&gt;%
  arrange(hotel, market_segment)
```

```
## # A tibble: 14 √ó 2
##    hotel        market_segment
##    &lt;chr&gt;        &lt;chr&gt;         
##  1 City Hotel   Aviation      
##  2 City Hotel   Complementary 
##  3 City Hotel   Corporate     
##  4 City Hotel   Direct        
##  5 City Hotel   Groups        
##  6 City Hotel   Offline TA/TO 
##  7 City Hotel   Online TA     
##  8 City Hotel   Undefined     
##  9 Resort Hotel Complementary 
## 10 Resort Hotel Corporate     
## 11 Resort Hotel Direct        
## 12 Resort Hotel Groups        
## 13 Resort Hotel Offline TA/TO 
## 14 Resort Hotel Online TA
```
]
]

---

## `count` to create frequency tables

.pull-left[

```r
# alphabetical order by default
hotels %&gt;%
* count(market_segment)
```

```
## # A tibble: 8 √ó 2
##   market_segment     n
##   &lt;chr&gt;          &lt;int&gt;
## 1 Aviation         237
## 2 Complementary    743
## 3 Corporate       5295
## 4 Direct         12606
## 5 Groups         19811
## 6 Offline TA/TO  24219
## 7 Online TA      56477
## 8 Undefined          2
```
]
--
.pull-right[

```r
# descending frequency order
hotels %&gt;%
* count(market_segment, sort = TRUE)
```

```
## # A tibble: 8 √ó 2
##   market_segment     n
##   &lt;chr&gt;          &lt;int&gt;
## 1 Online TA      56477
## 2 Offline TA/TO  24219
## 3 Groups         19811
## 4 Direct         12606
## 5 Corporate       5295
## 6 Complementary    743
## 7 Aviation         237
## 8 Undefined          2
```
]

---

## `count` and `arrange`

.pull-left[

```r
# ascending frequency order
hotels %&gt;%
  count(market_segment) %&gt;%
* arrange(n)
```

```
## # A tibble: 8 √ó 2
##   market_segment     n
##   &lt;chr&gt;          &lt;int&gt;
## 1 Undefined          2
## 2 Aviation         237
## 3 Complementary    743
## 4 Corporate       5295
## 5 Direct         12606
## 6 Groups         19811
## 7 Offline TA/TO  24219
## 8 Online TA      56477
```
]
.pull-right[

```r
# descending frequency order
# just like adding sort = TRUE
hotels %&gt;%
  count(market_segment) %&gt;%
* arrange(desc(n))
```

```
## # A tibble: 8 √ó 2
##   market_segment     n
##   &lt;chr&gt;          &lt;int&gt;
## 1 Online TA      56477
## 2 Offline TA/TO  24219
## 3 Groups         19811
## 4 Direct         12606
## 5 Corporate       5295
## 6 Complementary    743
## 7 Aviation         237
## 8 Undefined          2
```
]

---

## `count` for multiple variables
.medi[

```r
hotels %&gt;%
* count(hotel, market_segment)
```

```
## # A tibble: 14 √ó 3
##    hotel        market_segment     n
##    &lt;chr&gt;        &lt;chr&gt;          &lt;int&gt;
##  1 City Hotel   Aviation         237
##  2 City Hotel   Complementary    542
##  3 City Hotel   Corporate       2986
##  4 City Hotel   Direct          6093
##  5 City Hotel   Groups         13975
##  6 City Hotel   Offline TA/TO  16747
##  7 City Hotel   Online TA      38748
##  8 City Hotel   Undefined          2
##  9 Resort Hotel Complementary    201
## 10 Resort Hotel Corporate       2309
## 11 Resort Hotel Direct          6513
## 12 Resort Hotel Groups          5836
## 13 Resort Hotel Offline TA/TO   7472
## 14 Resort Hotel Online TA      17729
```
]
---

## order matters when you `count`

.midi[
.pull-left[

```r
# hotel type first
hotels %&gt;%
* count(hotel, market_segment)
```

```
## # A tibble: 14 √ó 3
##    hotel        market_segment     n
##    &lt;chr&gt;        &lt;chr&gt;          &lt;int&gt;
##  1 City Hotel   Aviation         237
##  2 City Hotel   Complementary    542
##  3 City Hotel   Corporate       2986
##  4 City Hotel   Direct          6093
##  5 City Hotel   Groups         13975
##  6 City Hotel   Offline TA/TO  16747
##  7 City Hotel   Online TA      38748
##  8 City Hotel   Undefined          2
##  9 Resort Hotel Complementary    201
## 10 Resort Hotel Corporate       2309
## 11 Resort Hotel Direct          6513
## 12 Resort Hotel Groups          5836
## 13 Resort Hotel Offline TA/TO   7472
## 14 Resort Hotel Online TA      17729
```
]
.pull-right[

```r
# market segment first
hotels %&gt;%
* count(market_segment, hotel)
```

```
## # A tibble: 14 √ó 3
##    market_segment hotel            n
##    &lt;chr&gt;          &lt;chr&gt;        &lt;int&gt;
##  1 Aviation       City Hotel     237
##  2 Complementary  City Hotel     542
##  3 Complementary  Resort Hotel   201
##  4 Corporate      City Hotel    2986
##  5 Corporate      Resort Hotel  2309
##  6 Direct         City Hotel    6093
##  7 Direct         Resort Hotel  6513
##  8 Groups         City Hotel   13975
##  9 Groups         Resort Hotel  5836
## 10 Offline TA/TO  City Hotel   16747
## 11 Offline TA/TO  Resort Hotel  7472
## 12 Online TA      City Hotel   38748
## 13 Online TA      Resort Hotel 17729
## 14 Undefined      City Hotel       2
```
]
]

---

.your-turn[

Time to actually play around with the Hotels dataset!

- Go to class git repo ([github.com/DataScience4Psych](https://github.com/DataScience4Psych)) and start `AE 04 - Hotels + Data wrangling`.
- Open the R Markdown document and complete Exercises 5 and 6.
]

---

class: middle

# Pause until you're ready ...



---

## `mutate` to add a new variable
.medi[

```r
hotels %&gt;%
* mutate(little_ones = children + babies) %&gt;%
  select(children, babies, little_ones) %&gt;%
  arrange(desc(little_ones))
```

```
## # A tibble: 119,390 √ó 3
##    children babies little_ones
##       &lt;dbl&gt;  &lt;dbl&gt;       &lt;dbl&gt;
##  1       10      0          10
##  2        0     10          10
##  3        0      9           9
##  4        2      1           3
##  5        2      1           3
##  6        2      1           3
##  7        3      0           3
##  8        2      1           3
##  9        2      1           3
## 10        3      0           3
## # ‚Ñπ 119,380 more rows
```
]
---



## Little ones in resort and city hotels

.midi[
.pull-left[

```r
# Resort Hotel
hotels %&gt;%
  mutate(little_ones = children + babies) %&gt;%
  filter(
    little_ones &gt;= 1,
    hotel == "Resort Hotel"
    ) %&gt;%
  select(hotel, little_ones)
```

```
## # A tibble: 3,929 √ó 2
##    hotel        little_ones
##    &lt;chr&gt;              &lt;dbl&gt;
##  1 Resort Hotel           1
##  2 Resort Hotel           2
##  3 Resort Hotel           2
##  4 Resort Hotel           2
##  5 Resort Hotel           1
##  6 Resort Hotel           1
##  7 Resort Hotel           2
##  8 Resort Hotel           2
##  9 Resort Hotel           1
## 10 Resort Hotel           1
## # ‚Ñπ 3,919 more rows
```
]
.pull-right[

```r
# City Hotel
hotels %&gt;%
  mutate(little_ones = children + babies) %&gt;%
  filter(
    little_ones &gt; 1,
    hotel == "City Hotel"
    )  %&gt;%
  select(hotel, little_ones)
```

```
## # A tibble: 2,140 √ó 2
##    hotel      little_ones
##    &lt;chr&gt;            &lt;dbl&gt;
##  1 City Hotel           2
##  2 City Hotel           2
##  3 City Hotel           2
##  4 City Hotel           2
##  5 City Hotel           2
##  6 City Hotel           2
##  7 City Hotel           2
##  8 City Hotel           2
##  9 City Hotel           2
## 10 City Hotel           3
## # ‚Ñπ 2,130 more rows
```
]
]

---

.question[
What is happening in the following chunk?
]

.midi[

```r
hotels %&gt;%
  mutate(little_ones = children + babies) %&gt;%
  count(hotel, little_ones) %&gt;%
  mutate(prop = n / sum(n))
```

```
## # A tibble: 12 √ó 4
##    hotel        little_ones     n       prop
##    &lt;chr&gt;              &lt;dbl&gt; &lt;int&gt;      &lt;dbl&gt;
##  1 City Hotel             0 73923 0.619     
##  2 City Hotel             1  3263 0.0273    
##  3 City Hotel             2  2056 0.0172    
##  4 City Hotel             3    82 0.000687  
##  5 City Hotel             9     1 0.00000838
##  6 City Hotel            10     1 0.00000838
##  7 City Hotel            NA     4 0.0000335 
##  8 Resort Hotel           0 36131 0.303     
##  9 Resort Hotel           1  2183 0.0183    
## 10 Resort Hotel           2  1716 0.0144    
## 11 Resort Hotel           3    29 0.000243  
## 12 Resort Hotel          10     1 0.00000838
```
]

---

# `summarize` for summary stats


```r
# mean average daily rate for all bookings
hotels %&gt;%
* summarize(mean_adr = mean(adr))
```

```
## # A tibble: 1 √ó 1
##   mean_adr
##      &lt;dbl&gt;
## 1     102.
```

--

&lt;br&gt;

.tip[
`summarize()` changes the data frame entirely, it collapses rows down to a single 
summary statistic, and removes all columns that are irrelevant to the calculation.
]

---

.tip[
`summarize()` also lets you get away with being sloppy and not naming your new 
column, but that's not recommended!
]

.midi[
‚ùå


```r
hotels %&gt;%
  summarize(mean(adr))
```

```
## # A tibble: 1 √ó 1
##   `mean(adr)`
##         &lt;dbl&gt;
## 1        102.
```

‚úÖ


```r
hotels %&gt;%
  summarize(mean_adr = mean(adr))
```

```
## # A tibble: 1 √ó 1
##   mean_adr
##      &lt;dbl&gt;
## 1     102.
```
]

---

# `group_by` for grouped operations


```r
# mean average daily rate for all booking at city and resort hotels
hotels %&gt;%
* group_by(hotel) %&gt;%
  summarize(mean_adr = mean(adr))
```

```
## # A tibble: 2 √ó 2
##   hotel        mean_adr
##   &lt;chr&gt;           &lt;dbl&gt;
## 1 City Hotel      105. 
## 2 Resort Hotel     95.0
```

---

## Calculating frequencies

The following two give the same result, so `count` is simply short for `group_by` then determine frequencies 

.pull-left[

```r
hotels %&gt;%
  group_by(hotel) %&gt;%
  summarize(n = n())
```

```
## # A tibble: 2 √ó 2
##   hotel            n
##   &lt;chr&gt;        &lt;int&gt;
## 1 City Hotel   79330
## 2 Resort Hotel 40060
```
]
.pull-right[

```r
hotels %&gt;%
  count(hotel)
```

```
## # A tibble: 2 √ó 2
##   hotel            n
##   &lt;chr&gt;        &lt;int&gt;
## 1 City Hotel   79330
## 2 Resort Hotel 40060
```
]

---

# Multiple summary statistics

`summarize` can be used for multiple summary statistics as well


```r
hotels %&gt;%
  summarize(
    min_adr = min(adr),
    mean_adr = mean(adr),
    median_adr = median(adr),
    max_adr = max(adr)
    )
```

```
## # A tibble: 1 √ó 4
##   min_adr mean_adr median_adr max_adr
##     &lt;dbl&gt;    &lt;dbl&gt;      &lt;dbl&gt;   &lt;dbl&gt;
## 1   -6.38     102.       94.6    5400
```

---

.your-turn[

Time to actually play around with the Hotels dataset!

- Go to class git repo ([github.com/DataScience4Psych](https://github.com/DataScience4Psych)) and start `AE 04 - Hotels + Data wrangling`.
- Open the R Markdown document and complete Exercises 7 and 8.
]


---
# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))

---

class: middle

# Wrapping Up...
---
class: center, middle 

# Working with multiple data frames&lt;br&gt; ü§ù

---




class: middle

# .hand[We...]

.huge[.green[have]] .hand[multiple data frames]

.huge[.pink[want]] .hand[to bring them together]

---



## Data: Women in science 

Information on 10 women in science who changed the world

.small[
&lt;table&gt;
 &lt;thead&gt;
  &lt;tr&gt;
   &lt;th style="text-align:left;"&gt; name &lt;/th&gt;
  &lt;/tr&gt;
 &lt;/thead&gt;
&lt;tbody&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Ada Lovelace &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Marie Curie &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Janaki Ammal &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Chien-Shiung Wu &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Katherine Johnson &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Rosalind Franklin &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Vera Rubin &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Gladys West &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Flossie Wong-Staal &lt;/td&gt;
  &lt;/tr&gt;
  &lt;tr&gt;
   &lt;td style="text-align:left;"&gt; Jennifer Doudna &lt;/td&gt;
  &lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
]


.footnote[
Source: [Discover Magazine](https://www.discovermagazine.com/the-sciences/meet-10-women-in-science-who-changed-the-world)
]

---

## Inputs

+ Professions

```r
professions
```

```
## # A tibble: 10 √ó 2
##    name               profession                        
##    &lt;chr&gt;              &lt;chr&gt;                             
##  1 Ada Lovelace       Mathematician                     
##  2 Marie Curie        Physicist and Chemist             
##  3 Janaki Ammal       Botanist                          
##  4 Chien-Shiung Wu    Physicist                         
##  5 Katherine Johnson  Mathematician                     
##  6 Rosalind Franklin  Chemist                           
##  7 Vera Rubin         Astronomer                        
##  8 Gladys West        Mathematician                     
##  9 Flossie Wong-Staal Virologist and Molecular Biologist
## 10 Jennifer Doudna    Biochemist
```

---
## Inputs

+ Dates

```r
dates
```

```
## # A tibble: 8 √ó 3
##   name               birth_year death_year
##   &lt;chr&gt;                   &lt;dbl&gt;      &lt;dbl&gt;
## 1 Janaki Ammal             1897       1984
## 2 Chien-Shiung Wu          1912       1997
## 3 Katherine Johnson        1918       2020
## 4 Rosalind Franklin        1920       1958
## 5 Vera Rubin               1928       2016
## 6 Gladys West              1930         NA
## 7 Flossie Wong-Staal       1947         NA
## 8 Jennifer Doudna          1964         NA
```

---

## Inputs

+ Works


```r
works
```

```
## # A tibble: 9 √ó 2
##   name               known_for                                   
##   &lt;chr&gt;              &lt;chr&gt;                                       
## 1 Ada Lovelace       first computer algorithm                    
## 2 Marie Curie        theory of radioactivity,  discovery of elem‚Ä¶
## 3 Janaki Ammal       hybrid species, biodiversity protection     
## 4 Chien-Shiung Wu    confim and refine theory of radioactive bet‚Ä¶
## 5 Katherine Johnson  calculations of orbital mechanics critical ‚Ä¶
## 6 Vera Rubin         existence of dark matter                    
## 7 Gladys West        mathematical modeling of the shape of the E‚Ä¶
## 8 Flossie Wong-Staal first scientist to clone HIV and create a m‚Ä¶
## 9 Jennifer Doudna    one of the primary developers of CRISPR, a ‚Ä¶
```

---

## Desired output


```
## # A tibble: 10 √ó 5
##    name               profession  birth_year death_year known_for
##    &lt;chr&gt;              &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    
##  1 Ada Lovelace       Mathematic‚Ä¶         NA         NA first co‚Ä¶
##  2 Marie Curie        Physicist ‚Ä¶         NA         NA theory o‚Ä¶
##  3 Janaki Ammal       Botanist          1897       1984 hybrid s‚Ä¶
##  4 Chien-Shiung Wu    Physicist         1912       1997 confim a‚Ä¶
##  5 Katherine Johnson  Mathematic‚Ä¶       1918       2020 calculat‚Ä¶
##  6 Rosalind Franklin  Chemist           1920       1958 &lt;NA&gt;     
##  7 Vera Rubin         Astronomer        1928       2016 existenc‚Ä¶
##  8 Gladys West        Mathematic‚Ä¶       1930         NA mathemat‚Ä¶
##  9 Flossie Wong-Staal Virologist‚Ä¶       1947         NA first sc‚Ä¶
## 10 Jennifer Doudna    Biochemist        1964         NA one of t‚Ä¶
```

---

## Inputs, reminder

.pull-left[.midi[

```r
names(professions)
```

```
## [1] "name"       "profession"
```

```r
names(dates)
```

```
## [1] "name"       "birth_year" "death_year"
```

```r
names(works)
```

```
## [1] "name"      "known_for"
```
]
]
.pull-right[

```r
nrow(professions)
```

```
## [1] 10
```

```r
nrow(dates)
```

```
## [1] 8
```

```r
nrow(works)
```

```
## [1] 9
```
]

---

class: middle

# Joining data frames

---

## Joining data frames


```r
something_join(x, y)
```

- `left_join()`: all rows from x
- `right_join()`: all rows from y
- `full_join()`: all rows from both x and y
- `semi_join()`: all rows from x where there are matching values in y, keeping just columns from x
- `inner_join()`: all rows from x where there are matching values in y, return 
all combination of multiple matches in the case of multiple matches
- `anti_join()`: return all rows from x where there are not matching values in y, never duplicate rows of x
- ...
 
---

## Setup

For the next few slides...

.pull-left[


```r
x
```

```
## # A tibble: 3 √ó 2
##      id value_x
##   &lt;dbl&gt; &lt;chr&gt;  
## 1     1 x1     
## 2     2 x2     
## 3     3 x3
```
]
.pull-right[


```r
y
```

```
## # A tibble: 3 √ó 2
##      id value_y
##   &lt;dbl&gt; &lt;chr&gt;  
## 1     1 y1     
## 2     2 y2     
## 3     4 y4
```
]

---

## `left_join()`

.pull-left[
&lt;img src="img/left-join.gif" width="80%" style="background-color: #FDF6E3" style="display: block; margin: auto;" /&gt;
]
.pull-right[

```r
left_join(x, y)
```

```
## # A tibble: 3 √ó 3
##      id value_x value_y
##   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  
## 1     1 x1      y1     
## 2     2 x2      y2     
## 3     3 x3      &lt;NA&gt;
```
]

---

## `left_join()`


```r
professions %&gt;%
* left_join(dates)
```

```
## # A tibble: 10 √ó 4
##    name               profession            birth_year death_year
##    &lt;chr&gt;              &lt;chr&gt;                      &lt;dbl&gt;      &lt;dbl&gt;
##  1 Ada Lovelace       Mathematician                 NA         NA
##  2 Marie Curie        Physicist and Chemist         NA         NA
##  3 Janaki Ammal       Botanist                    1897       1984
##  4 Chien-Shiung Wu    Physicist                   1912       1997
##  5 Katherine Johnson  Mathematician               1918       2020
##  6 Rosalind Franklin  Chemist                     1920       1958
##  7 Vera Rubin         Astronomer                  1928       2016
##  8 Gladys West        Mathematician               1930         NA
##  9 Flossie Wong-Staal Virologist and Molec‚Ä¶       1947         NA
## 10 Jennifer Doudna    Biochemist                  1964         NA
```

---

## `right_join()`

.pull-left[
&lt;img src="img/right-join.gif" width="80%" style="background-color: #FDF6E3" style="display: block; margin: auto;" /&gt;
]
.pull-right[

```r
right_join(x, y)
```

```
## # A tibble: 3 √ó 3
##      id value_x value_y
##   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  
## 1     1 x1      y1     
## 2     2 x2      y2     
## 3     4 &lt;NA&gt;    y4
```
]

---

## `right_join()`



```r
professions %&gt;%
* right_join(dates)
```

```
## # A tibble: 8 √ó 4
##   name               profession             birth_year death_year
##   &lt;chr&gt;              &lt;chr&gt;                       &lt;dbl&gt;      &lt;dbl&gt;
## 1 Janaki Ammal       Botanist                     1897       1984
## 2 Chien-Shiung Wu    Physicist                    1912       1997
## 3 Katherine Johnson  Mathematician                1918       2020
## 4 Rosalind Franklin  Chemist                      1920       1958
## 5 Vera Rubin         Astronomer                   1928       2016
## 6 Gladys West        Mathematician                1930         NA
## 7 Flossie Wong-Staal Virologist and Molecu‚Ä¶       1947         NA
## 8 Jennifer Doudna    Biochemist                   1964         NA
```

---

## `full_join()`

.pull-left[
&lt;img src="img/full-join.gif" width="80%" style="background-color: #FDF6E3" style="display: block; margin: auto;" /&gt;
]
.pull-right[

```r
full_join(x, y)
```

```
## # A tibble: 4 √ó 3
##      id value_x value_y
##   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  
## 1     1 x1      y1     
## 2     2 x2      y2     
## 3     3 x3      &lt;NA&gt;   
## 4     4 &lt;NA&gt;    y4
```
]

---

## `full_join()`


```r
dates %&gt;%
* full_join(works)
```

```
## # A tibble: 10 √ó 4
##    name               birth_year death_year known_for            
##    &lt;chr&gt;                   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                
##  1 Janaki Ammal             1897       1984 hybrid species, biod‚Ä¶
##  2 Chien-Shiung Wu          1912       1997 confim and refine th‚Ä¶
##  3 Katherine Johnson        1918       2020 calculations of orbi‚Ä¶
##  4 Rosalind Franklin        1920       1958 &lt;NA&gt;                 
##  5 Vera Rubin               1928       2016 existence of dark ma‚Ä¶
##  6 Gladys West              1930         NA mathematical modelin‚Ä¶
##  7 Flossie Wong-Staal       1947         NA first scientist to c‚Ä¶
##  8 Jennifer Doudna          1964         NA one of the primary d‚Ä¶
##  9 Ada Lovelace               NA         NA first computer algor‚Ä¶
## 10 Marie Curie                NA         NA theory of radioactiv‚Ä¶
```

---

## `inner_join()`

.pull-left[
&lt;img src="img/inner-join.gif" width="80%" style="background-color: #FDF6E3" style="display: block; margin: auto;" /&gt;
]
.pull-right[

```r
inner_join(x, y)
```

```
## # A tibble: 2 √ó 3
##      id value_x value_y
##   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;  
## 1     1 x1      y1     
## 2     2 x2      y2
```
]

---

## `inner_join()`


```r
dates %&gt;%
* inner_join(works)
```

```
## # A tibble: 7 √ó 4
##   name               birth_year death_year known_for             
##   &lt;chr&gt;                   &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;                 
## 1 Janaki Ammal             1897       1984 hybrid species, biodi‚Ä¶
## 2 Chien-Shiung Wu          1912       1997 confim and refine the‚Ä¶
## 3 Katherine Johnson        1918       2020 calculations of orbit‚Ä¶
## 4 Vera Rubin               1928       2016 existence of dark mat‚Ä¶
## 5 Gladys West              1930         NA mathematical modeling‚Ä¶
## 6 Flossie Wong-Staal       1947         NA first scientist to cl‚Ä¶
## 7 Jennifer Doudna          1964         NA one of the primary de‚Ä¶
```

---

## `semi_join()`

.pull-left[
&lt;img src="img/semi-join.gif" width="80%" style="background-color: #FDF6E3" style="display: block; margin: auto;" /&gt;
]
.pull-right[

```r
semi_join(x, y)
```

```
## # A tibble: 2 √ó 2
##      id value_x
##   &lt;dbl&gt; &lt;chr&gt;  
## 1     1 x1     
## 2     2 x2
```
]

---

## `semi_join()`


```r
dates %&gt;%
* semi_join(works)
```

```
## # A tibble: 7 √ó 3
##   name               birth_year death_year
##   &lt;chr&gt;                   &lt;dbl&gt;      &lt;dbl&gt;
## 1 Janaki Ammal             1897       1984
## 2 Chien-Shiung Wu          1912       1997
## 3 Katherine Johnson        1918       2020
## 4 Vera Rubin               1928       2016
## 5 Gladys West              1930         NA
## 6 Flossie Wong-Staal       1947         NA
## 7 Jennifer Doudna          1964         NA
```

---

## `anti_join()`

.pull-left[
&lt;img src="img/anti-join.gif" width="80%" style="background-color: #FDF6E3" style="display: block; margin: auto;" /&gt;
]
.pull-right[

```r
anti_join(x, y)
```

```
## # A tibble: 1 √ó 2
##      id value_x
##   &lt;dbl&gt; &lt;chr&gt;  
## 1     3 x3
```
]

---

## `anti_join()`


```r
dates %&gt;%
* anti_join(works)
```

```
## # A tibble: 1 √ó 3
##   name              birth_year death_year
##   &lt;chr&gt;                  &lt;dbl&gt;      &lt;dbl&gt;
## 1 Rosalind Franklin       1920       1958
```

---

## Putting it altogether


```r
professions %&gt;%
  left_join(dates) %&gt;%
  left_join(works)
```

```
## # A tibble: 10 √ó 5
##    name               profession  birth_year death_year known_for
##    &lt;chr&gt;              &lt;chr&gt;            &lt;dbl&gt;      &lt;dbl&gt; &lt;chr&gt;    
##  1 Ada Lovelace       Mathematic‚Ä¶         NA         NA first co‚Ä¶
##  2 Marie Curie        Physicist ‚Ä¶         NA         NA theory o‚Ä¶
##  3 Janaki Ammal       Botanist          1897       1984 hybrid s‚Ä¶
##  4 Chien-Shiung Wu    Physicist         1912       1997 confim a‚Ä¶
##  5 Katherine Johnson  Mathematic‚Ä¶       1918       2020 calculat‚Ä¶
##  6 Rosalind Franklin  Chemist           1920       1958 &lt;NA&gt;     
##  7 Vera Rubin         Astronomer        1928       2016 existenc‚Ä¶
##  8 Gladys West        Mathematic‚Ä¶       1930         NA mathemat‚Ä¶
##  9 Flossie Wong-Staal Virologist‚Ä¶       1947         NA first sc‚Ä¶
## 10 Jennifer Doudna    Biochemist        1964         NA one of t‚Ä¶
```

---
class: middle

# Wrapping Up...

---

class: middle

# Case studies

---

## Case: Student records

- Have:
  - Enrollment: official university enrollment records
  - Survey: Student provided info missing students who never filled it out and including students who filled it out but dropped the class
- Want: Survey info for all enrolled in class 

--



.pull-left[

```r
enrollment
```

```
## # A tibble: 3 √ó 2
##      id name           
##   &lt;dbl&gt; &lt;chr&gt;          
## 1     1 Dave Friday    
## 2     2 Hermine        
## 3     3 Sura Selvarajah
```
]
.pull-right[

```r
survey
```

```
## # A tibble: 4 √ó 3
##      id name    username            
##   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;               
## 1     2 Hermine bakealongwithhermine
## 2     3 Sura    surasbakes          
## 3     4 Peter   peter_bakes         
## 4     5 Mark    thebakingbuddha
```
]

---

## Student records

+ In class

```r
enrollment %&gt;% 
* left_join(survey, by = "id")
```

```
## # A tibble: 3 √ó 4
##      id name.x          name.y  username            
##   &lt;dbl&gt; &lt;chr&gt;           &lt;chr&gt;   &lt;chr&gt;               
## 1     1 Dave Friday     &lt;NA&gt;    &lt;NA&gt;                
## 2     2 Hermine         Hermine bakealongwithhermine
## 3     3 Sura Selvarajah Sura    surasbakes
```
]

---

## Student records

+ Survey missing

```r
enrollment %&gt;% 
* anti_join(survey, by = "id")
```

```
## # A tibble: 1 √ó 2
##      id name       
##   &lt;dbl&gt; &lt;chr&gt;      
## 1     1 Dave Friday
```
---

## Student records

+ Dropped

```r
survey %&gt;% 
* anti_join(enrollment, by = "id")
```

```
## # A tibble: 2 √ó 3
##      id name  username       
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;          
## 1     4 Peter peter_bakes    
## 2     5 Mark  thebakingbuddha
```

---

class: middle

# Case study: Grocery sales

---

## Grocery sales

- Have:
  - Purchases: One row per customer per item, listing purchases they made
  - Prices: One row per item in the store, listing their prices
- Want: Total revenue

--



.pull-left[

```r
purchases
```

```
## # A tibble: 5 √ó 2
##   customer_id item        
##         &lt;dbl&gt; &lt;chr&gt;       
## 1           1 bread       
## 2           1 milk        
## 3           1 banana      
## 4           2 milk        
## 5           2 toilet paper
```
]
.pull-right[

```r
prices
```

```
## # A tibble: 5 √ó 2
##   item         price
##   &lt;chr&gt;        &lt;dbl&gt;
## 1 avocado       0.5 
## 2 banana        0.15
## 3 bread         1   
## 4 milk          0.8 
## 5 toilet paper  3
```
]

---

## Grocery sales

+ Total revenue

.pull-left[

```r
purchases %&gt;% 
* left_join(prices)
```

```
## # A tibble: 5 √ó 3
##   customer_id item         price
##         &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1           1 bread         1   
## 2           1 milk          0.8 
## 3           1 banana        0.15
## 4           2 milk          0.8 
## 5           2 toilet paper  3
```
]

.pull-right[

```r
purchases %&gt;% 
  left_join(prices) %&gt;%
* summarize(total_revenue = sum(price))
```

```
## # A tibble: 1 √ó 1
##   total_revenue
##           &lt;dbl&gt;
## 1          5.75
```
]

---

## Grocery sales

+ Revenue per customer

.pull-left[

```r
purchases %&gt;% 
  left_join(prices)
```

```
## # A tibble: 5 √ó 3
##   customer_id item         price
##         &lt;dbl&gt; &lt;chr&gt;        &lt;dbl&gt;
## 1           1 bread         1   
## 2           1 milk          0.8 
## 3           1 banana        0.15
## 4           2 milk          0.8 
## 5           2 toilet paper  3
```
]
.pull-right[

```r
purchases %&gt;% 
  left_join(prices) %&gt;%
* group_by(customer_id) %&gt;%
  summarize(total_revenue = sum(price))
```

```
## # A tibble: 2 √ó 2
##   customer_id total_revenue
##         &lt;dbl&gt;         &lt;dbl&gt;
## 1           1          1.95
## 2           2          3.8
```
]



---


# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))

---

class: middle

# Wrapping Up...
---

class: center, middle 

# Data types and recoding &lt;br&gt; üíΩ

---




class: middle

# Why should you care about data types?

---

## Example: Cat lovers

A survey asked respondents their name and number of cats. The instructions said to enter the number of cats as a numerical value.
.medi[

```r
cat_lovers &lt;- read_csv("data/cat-lovers.csv")
```
]

```
## # A tibble: 60 √ó 3
##    name           number_of_cats handedness
##    &lt;chr&gt;          &lt;chr&gt;          &lt;chr&gt;     
##  1 Bernice Warren 0              left      
##  2 Woodrow Stone  0              left      
##  3 Willie Bass    1              left      
##  4 Tyrone Estrada 3              left      
##  5 Alex Daniels   3              left      
##  6 Jane Bates     2              left      
##  7 Latoya Simpson 1              left      
##  8 Darin Woods    1              left      
##  9 Agnes Cobb     0              left      
## 10 Tabitha Grant  0              left      
## # ‚Ñπ 50 more rows
```

---

## Oh why won't you work?!


```r
cat_lovers %&gt;%
  summarize(mean_cats = mean(number_of_cats))
```

```
## Warning: There was 1 warning in `summarize()`.
## ‚Ñπ In argument: `mean_cats = mean(number_of_cats)`.
## Caused by warning in `mean.default()`:
## ! argument is not numeric or logical: returning NA
```

```
## # A tibble: 1 √ó 1
##   mean_cats
##       &lt;dbl&gt;
## 1        NA
```

---
.medi[

```r
?mean
```
]
&lt;img src="img/mean-help.png" width="75%" style="display: block; margin: auto;" /&gt;

---

## Oh why won't you still work??!!


```r
cat_lovers %&gt;%
  summarize(mean_cats = mean(number_of_cats, na.rm = TRUE))
```

```
## Warning: There was 1 warning in `summarize()`.
## ‚Ñπ In argument: `mean_cats = mean(number_of_cats, na.rm = TRUE)`.
## Caused by warning in `mean.default()`:
## ! argument is not numeric or logical: returning NA
```

```
## # A tibble: 1 √ó 1
##   mean_cats
##       &lt;dbl&gt;
## 1        NA
```

---

## Take a breath and look at your data

.question[
What is the type of the `number_of_cats` variable?
]


```r
glimpse(cat_lovers)
```

```
## Rows: 60
## Columns: 3
## $ name           &lt;chr&gt; "Bernice Warren", "Woodrow Stone", "Will‚Ä¶
## $ number_of_cats &lt;chr&gt; "0", "0", "1", "3", "3", "2", "1", "1", ‚Ä¶
## $ handedness     &lt;chr&gt; "left", "left", "left", "left", "left", ‚Ä¶
```

---

## Let's take another look



&lt;div id="htmlwidget-4eb53065b7328530dcdf" style="width:100%;height:90%;" class="datatables html-widget"&gt;&lt;/div&gt;
&lt;script type="application/json" data-for="htmlwidget-4eb53065b7328530dcdf"&gt;{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60"],["Bernice Warren","Woodrow Stone","Willie Bass","Tyrone Estrada","Alex Daniels","Jane Bates","Latoya Simpson","Darin Woods","Agnes Cobb","Tabitha Grant","Perry Cross","Wanda Silva","Alicia Sims","Emily Logan","Woodrow Elliott","Brent Copeland","Pedro Carlson","Patsy Luna","Brett Robbins","Oliver George","Calvin Perry","Lora Gutierrez","Charlotte Sparks","Earl Mack","Leslie Wade","Santiago Barker","Jose Bell","Lynda Smith","Bradford Marshall","Irving Miller","Caroline Simpson","Frances Welch","Melba Jenkins","Veronica Morales","Juanita Cunningham","Maurice Howard","Teri Pierce","Phil Franklin","Jan Zimmerman","Leslie Price","Bessie Patterson","Ethel Wolfe","Naomi Wright","Sadie Frank","Lonnie Cannon","Tony Garcia","Darla Newton","Ginger Clark","Lionel Campbell","Florence Klein","Harriet Leonard","Terrence Harrington","Travis Garner","Doug Bass","Pat Norris","Dawn Young","Shari Alvarez","Tamara Robinson","Megan Morgan","Kara Obrien"],["0","0","1","3","3","2","1","1","0","0","0","0","1","3","3","2","1","1","0","0","1","1","0","0","4","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","0","1","3","3","2","1","1.5 - honestly I think one of my cats is half human","0","0","1","0","1","three","1","1","1","0","0","2"],["left","left","left","left","left","left","left","left","left","left","left","left","left","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","right","ambidextrous","ambidextrous","ambidextrous","ambidextrous","ambidextrous"]],"container":"&lt;table class=\"display\"&gt;\n  &lt;thead&gt;\n    &lt;tr&gt;\n      &lt;th&gt; &lt;\/th&gt;\n      &lt;th&gt;name&lt;\/th&gt;\n      &lt;th&gt;number_of_cats&lt;\/th&gt;\n      &lt;th&gt;handedness&lt;\/th&gt;\n    &lt;\/tr&gt;\n  &lt;\/thead&gt;\n&lt;\/table&gt;","options":{"order":[],"autoWidth":false,"orderClasses":false,"columnDefs":[{"orderable":false,"targets":0}]}},"evals":[],"jsHooks":[]}&lt;/script&gt;


---

## You might need to babysit your respondents

.midi[

```r
cat_lovers %&gt;%
  mutate(number_of_cats = case_when(
    name == "Ginger Clark" ~ 2,
    name == "Doug Bass"    ~ 3,
    TRUE                   ~ as.numeric(number_of_cats)
    )) %&gt;%
  summarize(mean_cats = mean(number_of_cats))
```

```
## Warning: There was 1 warning in `mutate()`.
## ‚Ñπ In argument: `number_of_cats = case_when(...)`.
## Caused by warning:
## ! NAs introduced by coercion
```

```
## # A tibble: 1 √ó 1
##   mean_cats
##       &lt;dbl&gt;
## 1     0.833
```
]

---

## Always you need to respect data types


```r
cat_lovers %&gt;%
  mutate(
    number_of_cats = case_when(
      name == "Ginger Clark" ~ "2",
      name == "Doug Bass"    ~ "3",
      TRUE                   ~ number_of_cats
      ),
    number_of_cats = as.numeric(number_of_cats)
    ) %&gt;%
  summarize(mean_cats = mean(number_of_cats))
```

```
## # A tibble: 1 √ó 1
##   mean_cats
##       &lt;dbl&gt;
## 1     0.833
```

---

## Now that we know what we're doing...


```r
*cat_lovers &lt;- cat_lovers %&gt;%
  mutate(
    number_of_cats = case_when(
      name == "Ginger Clark" ~ "2",
      name == "Doug Bass"    ~ "3",
      TRUE                   ~ number_of_cats
      ),
    number_of_cats = as.numeric(number_of_cats)
    )
```

---

## Moral of the story

- If your data does not behave how you expect it to, type coercion upon reading in the data might be the reason.
- Go in and investigate your data, apply the fix, *save your data*, live happily ever after.

---

class: middle

# Wrapping Up...

---



class: middle

.hand-blue[now that we have a good motivation for]  
.hand-blue[learning about data types in R]

&lt;br&gt;

.hand-blue[let's learn about data types in R!]

---

class: middle

# Data types

---

## Data types in R

- **logical**
- **double**
- **integer**
- **character**
- and some more, but we won't be focusing on those

---

## Logical &amp; character

.pull-left[
**logical** - boolean values `TRUE` and `FALSE`


```r
typeof(TRUE)
```

```
## [1] "logical"
```
]
.pull-right[
**character** - character strings


```r
typeof("hello")
```

```
## [1] "character"
```
]

---

## Double &amp; integer

.pull-left[
**double** - floating point numerical values (default numerical type)


```r
typeof(1.335)
```

```
## [1] "double"
```

```r
typeof(7)
```

```
## [1] "double"
```
]
.pull-right[
**integer** - integer numerical values (indicated with an `L`)


```r
typeof(7L)
```

```
## [1] "integer"
```

```r
typeof(1:3)
```

```
## [1] "integer"
```
]

---

## Concatenation

Vectors can be constructed using the `c()` function.


```r
c(1, 2, 3)
```

```
## [1] 1 2 3
```

```r
c("Hello", "World!")
```

```
## [1] "Hello"  "World!"
```

```r
c(c("hi", "hello"), c("bye", "jello"))
```

```
## [1] "hi"    "hello" "bye"   "jello"
```

---

## Converting between types

.hand[with intention...]

.medi.pull-left[

```r
x &lt;- 1:3
x
```

```
## [1] 1 2 3
```

```r
typeof(x)
```

```
## [1] "integer"
```

```r
y &lt;- as.character(x)
y
```

```
## [1] "1" "2" "3"
```

```r
typeof(y)
```

```
## [1] "character"
```
]
--
.medi.pull-right[

```r
x &lt;- c(TRUE, FALSE)
x
```

```
## [1]  TRUE FALSE
```

```r
typeof(x)
```

```
## [1] "logical"
```

```r
y &lt;- as.numeric(x)
y
```

```
## [1] 1 0
```

```r
typeof(y)
```

```
## [1] "double"
```
]

---

## Converting between types

.hand[without intention...]

R will happily convert between various types without complaint when different types of data are concatenated in a vector, and that's not always a great thing!

.pull-left[

```r
c(1, "Hello")
```

```
## [1] "1"     "Hello"
```

```r
c(FALSE, 3L)
```

```
## [1] 0 3
```
]
.pull-right[

```r
c(1.2, 3L)
```

```
## [1] 1.2 3.0
```

```r
c(2L, "two")
```

```
## [1] "2"   "two"
```
]

---

## Explicit vs. implicit coercion

Let's give formal names to what we've seen so far:

- **Explicit coercion** is when you call a function like `as.logical()`, `as.numeric()`, `as.integer()`, `as.double()`, or `as.character()`.
- **Implicit coercion** happens when you use a vector in a specific context that expects a certain type of vector. 

---

.medi.your-turn[
- [class git repo](https://github.com/DataScience4Psych) &gt; `AE 05 - Hotels + Data types` &gt; open `type-coercion.Rmd` and knit.
- What is the type of the given vectors? First, guess. Then, try it out in R. 
If your guess was correct, great! If not, discuss why they have that type.
]


.midi[
**Example:** Suppose we want to know the type of `c(1, "a")`. First, I'd look at: 

.pull-left[

```r
typeof(1)
```

```
## [1] "double"
```
]
.pull-right[

```r
typeof("a")
```

```
## [1] "character"
```
]

and make a guess based on these. Then finally I'd check:
.pull-left[

```r
typeof(c(1, "a"))
```

```
## [1] "character"
```
]
]

---

class: middle

# Wrapping Up...

---

class: middle

# Special values

---

## Special values

- `NA`: Not available
- `NaN`: Not a number
- `Inf`: Positive infinity
- `-Inf`: Negative infinity

--

.pull-left[

```r
pi / 0
```

```
## [1] Inf
```

```r
0 / 0
```

```
## [1] NaN
```
]
.pull-right[

```r
1/0 - 1/0
```

```
## [1] NaN
```

```r
1/0 + 1/0
```

```
## [1] Inf
```
]

---

## `NA`s are special ‚ùÑÔ∏ès


```r
x &lt;- c(1, 2, 3, 4, NA)
```


```r
mean(x)
```

```
## [1] NA
```

```r
mean(x, na.rm = TRUE)
```

```
## [1] 2.5
```

```r
summary(x)
```

```
##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
##    1.00    1.75    2.50    2.50    3.25    4.00       1
```

---

## `NA`s are logical

R uses `NA` to represent missing values in its data structures.


```r
typeof(NA)
```

```
## [1] "logical"
```

---

## Mental model for `NA`s

- Unlike `NaN`, `NA`s are genuinely unknown values
- But that doesn't mean they can't function in a logical way
- Let's think about why `NA`s are logical...

--

.question[
Why do the following give different answers?
]
.pull-left[

```r
# TRUE or NA
TRUE | NA
```

```
## [1] TRUE
```
]
.pull-right[

```r
# FALSE or NA
FALSE | NA
```

```
## [1] NA
```
]

`\(\rightarrow\)` See next slide for answers...

---

- `NA` is unknown, so it could be `TRUE` or `FALSE`

.medi.pull-left[
- `TRUE` or `TRUE` is `TRUE` and `TRUE` or `FALSE` is also `TRUE`, and since both are `TRUE`

```r
TRUE | TRUE
```

```
## [1] TRUE
```

```r
FALSE | TRUE
```

```
## [1] TRUE
```
]


.medi.pull-right[
- `FALSE` or `TRUE` is `TRUE` and `FALSE` or `FALSE` is also `FALSE`, so you you can't tell which should be the right answer

```r
FALSE | TRUE
```

```
## [1] TRUE
```

```r
FALSE | FALSE
```

```
## [1] FALSE
```
]

- Doesn't make sense for mathematical operations but make sense in the context of missing data

---

class: middle

# Wrapping Up...

---

class: middle

# Data classes

---

## Data classes

We talked about *types* so far, next we'll introduce the concept of *classes*

- Vectors are like Lego building blocks
- We stick them together to build more complicated constructs, e.g. *representations of data*
- The **class** attribute relates to the S3 class of an object which determines its behaviour
  - You don't need to worry about what S3 classes really mean, but you can read more about it [here](https://adv-r.hadley.nz/s3.html#s3-classes) if you're curious
- Examples: factors, dates, and data frames
  
---

## Factors

R uses factors to handle categorical variables, variables that have a fixed and known set of possible values


```r
x &lt;- factor(c("BS", "MS", "PhD", "MS"))
x
```

```
## [1] BS  MS  PhD MS 
## Levels: BS MS PhD
```

.pull-left[

```r
typeof(x)
```

```
## [1] "integer"
```
]
.pull-right[

```r
class(x)
```

```
## [1] "factor"
```
]


---

## More on factors

We can think of factors like character (level labels) and an integer (level numbers) glued together


```r
glimpse(x)
```

```
##  Factor w/ 3 levels "BS","MS","PhD": 1 2 3 2
```

```r
as.integer(x)
```

```
## [1] 1 2 3 2
```

---

## Dates


```r
y &lt;- as.Date("2020-01-01")
y
```

```
## [1] "2020-01-01"
```

```r
typeof(y)
```

```
## [1] "double"
```

```r
class(y)
```

```
## [1] "Date"
```

---

## More on dates

We can think of dates like an integer (the number of days since the origin, 1 Jan 1970) and an integer (the origin) glued together


```r
as.integer(y)
```

```
## [1] 18262
```

```r
as.integer(y) / 365 # roughly 50 yrs
```

```
## [1] 50.03288
```

---

## Data frames

We can think of data frames like vectors of equal length glued together


```r
df &lt;- data.frame(x = 1:2, y = 3:4)
df
```

```
##   x y
## 1 1 3
## 2 2 4
```

.pull-left[

```r
typeof(df)
```

```
## [1] "list"
```
]
.pull-right[

```r
class(df)
```

```
## [1] "data.frame"
```
]

---

## Lists

Lists are a generic vector container vectors of any type can go in them


```r
l &lt;- list(
  x = 1:4,
  y = c("hi", "hello", "jello"),
  z = c(TRUE, FALSE)
)
l
```

```
## $x
## [1] 1 2 3 4
## 
## $y
## [1] "hi"    "hello" "jello"
## 
## $z
## [1]  TRUE FALSE
```

---

## Lists and data frames

- A data frame is a special list containing vectors of equal length
- When we use the `pull()` function, we extract a vector from the data frame


```r
df
```

```
##   x y
## 1 1 3
## 2 2 4
```

```r
df %&gt;%
  pull(y)
```

```
## [1] 3 4
```


---

class: middle

# Wrapping Up...

---

class: middle

# Working with factors

---

## Read data in as character strings


```r
glimpse(cat_lovers)
```

```
## Rows: 60
## Columns: 3
## $ name           &lt;chr&gt; "Bernice Warren", "Woodrow Stone", "Will‚Ä¶
## $ number_of_cats &lt;dbl&gt; 0, 0, 1, 3, 3, 2, 1, 1, 0, 0, 0, 0, 1, 3‚Ä¶
## $ handedness     &lt;chr&gt; "left", "left", "left", "left", "left", ‚Ä¶
```

---

## But coerce when plotting
.midi[

```r
ggplot(cat_lovers, mapping = aes(x = handedness)) +
  geom_bar()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-272-1.png" width="65%" style="display: block; margin: auto;" /&gt;
]

---

## Use forcats to manipulate factors
.midi[

```r
cat_lovers %&gt;%
* mutate(handedness = fct_infreq(handedness)) %&gt;%
  ggplot(mapping = aes(x = handedness)) +
  geom_bar()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-273-1.png" width="65%" style="display: block; margin: auto;" /&gt;
]
---

## Come for the functionality

.pull-left[
... stay for the logo
]
.pull-right[
&lt;img src="img/forcats-part-of-tidyverse.png" width="75%" style="display: block; margin: auto;" /&gt;
]

- Factors are useful when you have true categorical data and you want to override the ordering of character vectors to improve display
- They are also useful in modeling scenarios
- The **forcats** package provides a suite of useful tools that solve common problems with factors

---

.small.your-turn[
- [class git repo](https://github.com/DataScience4Psych) &gt; `AE 05 - Hotels + Data types` &gt; `hotels-forcats.Rmd` &gt; knit
- Recreate the following. The x-axis first, then, as a stretch goal, the y-axis.
]


&lt;img src="workshop_files/figure-html/unnamed-chunk-275-1.png" width="95%" style="display: block; margin: auto;" /&gt;

---

class: middle

# Wrapping Up...

---
class: middle

# Working with dates

---

## Make a date

.pull-left[
&lt;img src="img/lubridate-not-part-of-tidyverse.png" width="67%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
- **lubridate** is the tidyverse-friendly package that makes dealing with dates a little easier
- It's not one of the *core* tidyverse packages, hence it's installed with `install.packages("tidyverse)` but it's not loaded with it, and needs to be explicitly loaded with `library(lubridate)`
]

---

class: middle

.hand-blue[
we're just going to scratch the surface of working with dates in R here...
]

---

.question[
Calculate and visualize the number of bookings on any given arrival date.
]


```r
hotels %&gt;%
  select(starts_with("arrival_"))
```

```
## # A tibble: 119,390 √ó 4
##    arrival_date_year arrival_date_month arrival_date_week_number
##                &lt;dbl&gt; &lt;chr&gt;                                 &lt;dbl&gt;
##  1              2015 July                                     27
##  2              2015 July                                     27
##  3              2015 July                                     27
##  4              2015 July                                     27
##  5              2015 July                                     27
##  6              2015 July                                     27
##  7              2015 July                                     27
##  8              2015 July                                     27
##  9              2015 July                                     27
## 10              2015 July                                     27
## # ‚Ñπ 119,380 more rows
## # ‚Ñπ 1 more variable: arrival_date_day_of_month &lt;dbl&gt;
```

---

## Step 1. Put together dates.

.medi[

```r
library(glue)

hotels %&gt;%
  mutate(
*   arrival_date = glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}")
    ) %&gt;% 
  select(starts_with("arrival_"))
```

```
## # A tibble: 119,390 √ó 5
##    arrival_date_year arrival_date_month arrival_date_week_number
##                &lt;dbl&gt; &lt;chr&gt;                                 &lt;dbl&gt;
##  1              2015 July                                     27
##  2              2015 July                                     27
##  3              2015 July                                     27
##  4              2015 July                                     27
##  5              2015 July                                     27
##  6              2015 July                                     27
##  7              2015 July                                     27
##  8              2015 July                                     27
##  9              2015 July                                     27
## 10              2015 July                                     27
## # ‚Ñπ 119,380 more rows
## # ‚Ñπ 2 more variables: arrival_date_day_of_month &lt;dbl&gt;,
## #   arrival_date &lt;glue&gt;
```
]

---

## Step 2. Count number of bookings per date.

.medi[

```r
hotels %&gt;%
  mutate(arrival_date = glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}")) %&gt;%
  count(arrival_date)
```

```
## # A tibble: 793 √ó 2
##    arrival_date       n
##    &lt;glue&gt;         &lt;int&gt;
##  1 2015 August 1    110
##  2 2015 August 10   207
##  3 2015 August 11   117
##  4 2015 August 12   133
##  5 2015 August 13   107
##  6 2015 August 14   329
##  7 2015 August 15   190
##  8 2015 August 16    98
##  9 2015 August 17   188
## 10 2015 August 18    94
## # ‚Ñπ 783 more rows
```
]

---

## Step 3. Visualize number of bookings per date.

.small[

```r
hotels %&gt;%
  mutate(arrival_date =  glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}")) %&gt;%
  count(arrival_date) %&gt;%
  ggplot(aes(x = arrival_date, y = n, group = 1)) +
  geom_line()+
  theme_bw()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-280-1.png" width="55%" style="display: block; margin: auto;" /&gt;
]

---

.hand[zooming in a bit...]

.question[
Why does the plot start with August when we know our data start in July? And why does 10 August come after 1 August?
]

.midi[
&lt;img src="workshop_files/figure-html/unnamed-chunk-281-1.png" width="70%" style="display: block; margin: auto;" /&gt;
]

---

## Step 1. `REVISED` Put together dates `as dates`.

.medi[

```r
library(lubridate)

hotels %&gt;%
  mutate(
*   arrival_date = ymd(glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}"))
    ) %&gt;% 
  select(starts_with("arrival_"))
```

```
## # A tibble: 119,390 √ó 5
##    arrival_date_year arrival_date_month arrival_date_week_number
##                &lt;dbl&gt; &lt;chr&gt;                                 &lt;dbl&gt;
##  1              2015 July                                     27
##  2              2015 July                                     27
##  3              2015 July                                     27
##  4              2015 July                                     27
##  5              2015 July                                     27
##  6              2015 July                                     27
##  7              2015 July                                     27
##  8              2015 July                                     27
##  9              2015 July                                     27
## 10              2015 July                                     27
## # ‚Ñπ 119,380 more rows
## # ‚Ñπ 2 more variables: arrival_date_day_of_month &lt;dbl&gt;,
## #   arrival_date &lt;date&gt;
```
]

---

## Step 2. Count number of bookings per date.

.medi[

```r
hotels %&gt;%
  mutate(arrival_date = ymd(glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}"))) %&gt;% 
  count(arrival_date)
```

```
## # A tibble: 793 √ó 2
##    arrival_date     n
##    &lt;date&gt;       &lt;int&gt;
##  1 2015-07-01     122
##  2 2015-07-02      93
##  3 2015-07-03      56
##  4 2015-07-04      88
##  5 2015-07-05      53
##  6 2015-07-06      75
##  7 2015-07-07      54
##  8 2015-07-08      69
##  9 2015-07-09      80
## 10 2015-07-10      51
## # ‚Ñπ 783 more rows
```
]

---

## Step 3a. Visualize number of bookings per date.

.small[

```r
hotels %&gt;%
  mutate(arrival_date = ymd(glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}"))) %&gt;% 
  count(arrival_date) %&gt;%
  ggplot(aes(x = arrival_date, y = n, group = 1)) +
  geom_line()+theme_bw()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-284-1.png" width="55%" style="display: block; margin: auto;" /&gt;
]

---

## Step 3b. Visualize using a smooth curve.

.small[

```r
hotels %&gt;%
  mutate(arrival_date = ymd(glue("{arrival_date_year} {arrival_date_month} {arrival_date_day_of_month}"))) %&gt;% 
  count(arrival_date) %&gt;%
  ggplot(aes(x = arrival_date, y = n, group = 1)) +
* geom_smooth() +
  theme_bw()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-285-1.png" width="55%" style="display: block; margin: auto;" /&gt;
]


---



# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))
- Julia Fukuyama's EDA ([link](https://jfukuyama.github.io/))


---

class: middle

# Wrapping Up...

---

class: center, middle 

# Importing data &lt;br&gt; ‚¨ÜÔ∏è

---




class: middle

# Reading rectangular data into R

---

class: middle

.pull-left[
&lt;img src="img/readr.png" width="80%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
&lt;img src="img/readxl.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## readr

- `read_csv()` - comma delimited files
- `read_csv2()` - semicolon separated files (common in countries where , is used as the decimal place)
- `read_tsv()` - tab delimited files
- `read_delim()` - reads in files with any delimiter
- `read_fwf()` - fixed width files
- `read_table()` - common variation of fixed width files where columns are separated by white space
- ...

---

## Reading data


```r
nobel &lt;- read_csv(file = "data/nobel.csv")
```

---

.xxsmall[

```
## ‚îÄ‚îÄ Data Summary ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
##                            Values
## Name                       nobel 
## Number of rows             935   
## Number of columns          26    
## _______________________          
## Column type frequency:           
##   character                21    
##   Date                     2     
##   numeric                  3     
## ________________________         
## Group variables            None  
## 
## ‚îÄ‚îÄ Variable type: character ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
##    skim_variable         n_missing complete_rate min max empty n_unique whitespace
##  1 firstname                     0        1        2  59     0      720          0
##  2 surname                      29        0.969    2  26     0      851          0
##  3 category                      0        1        5  10     0        6          0
##  4 affiliation                 250        0.733    4 110     0      303          0
##  5 city                        255        0.727    4  27     0      185          0
##  6 country                     254        0.728    3  14     0       27          0
##  7 gender                        0        1        3   6     0        3          0
##  8 born_city                    28        0.970    3  29     0      613          0
##  9 born_country                 28        0.970    3  28     0       80          0
## 10 born_country_code            28        0.970    2   2     0       77          0
## 11 died_city                   327        0.650    4  29     0      303          0
## 12 died_country                321        0.657    3  16     0       48          0
## 13 died_country_code           321        0.657    2   2     0       46          0
## 14 overall_motivation          918        0.0182  55 114     0        7          0
## 15 motivation                    0        1       24 337     0      656          0
## 16 born_country_original        28        0.970    3  52     0      122          0
## 17 born_city_original           28        0.970    3  36     0      616          0
## 18 died_country_original       321        0.657    3  35     0       52          0
## 19 died_city_original          327        0.650    4  29     0      303          0
## 20 city_original               255        0.727    4  27     0      185          0
## 21 country_original            254        0.728    3  35     0       29          0
## 
## ‚îÄ‚îÄ Variable type: Date ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
##   skim_variable n_missing complete_rate min        max        median     n_unique
## 1 born_date            33         0.965 1817-11-30 1997-07-12 1916-06-28      885
## 2 died_date           308         0.671 1903-11-01 2019-08-07 1983-03-09      616
## 
## ‚îÄ‚îÄ Variable type: numeric ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
##   skim_variable n_missing complete_rate    mean      sd   p0   p25  p50   p75 p100 hist 
## 1 id                    0             1  475.   278.       1  234.  470  716.  969 ‚ñá‚ñá‚ñá‚ñá‚ñá
## 2 year                  0             1 1970.    33.3   1901 1947  1976 1999  2018 ‚ñÉ‚ñÉ‚ñÖ‚ñÜ‚ñá
## 3 share                 0             1    1.99   0.936    1    1     2    3     4 ‚ñá‚ñá‚ñÅ‚ñÖ‚ñÇ
```
]

---

## Writing data

- Write a file


```r
df &lt;- tribble(
  ~x, ~y,
  1,  "a",
  2,  "b",
  3,  "c"
)

write_csv(df, file = "data/df.csv")
```

---

- Check that it got written out


```r
fs::dir_ls("data")
```

```
## data/cat-lovers.csv
## data/df-na.csv
## data/df.csv
## data/edi-airbnb.csv
## data/favorite-food.xlsx
## data/favourite-food.xlsx
## data/highest-points-by-state.csv
## data/hotels.csv
## data/instructional-staff.csv
## data/lattice.RData
## data/minard-cities.csv
## data/minard-temps.csv
## data/minard.csv
## data/nobel.csv
## data/relig-income.xlsx
## data/sales
## data/sales.xlsx
## data/sales_d10
## data/scientists
## data/students
## data/uoe-art-info-1.csv
## data/uoe-art.csv
```

---

.your-turn[
- [class git repo](https://github.com/DataScience4Psych) &gt; `AE 06 - Nobels and sales + Data import` &gt; open `nobels-csv.Rmd` and knit.
- Read in the `nobels.csv` file from the `data-raw/` folder.
- Split into two (STEM and non-STEM): 
  - Create a new data frame, `nobel_stem`, that filters for the STEM fields 
(Physics, Medicine, Chemistry, and Economics).
  - Create another data frame, `nobel_nonstem`, that filters for the remaining 
fields.  
- Write out the two data frames to `nobel-stem.csv` and `nobel-nonstem.csv`, 
respectively, to `data/`.

**Hint:** Use the `%in%` operator when filtering.
]

---

class: middle

# Pausing...

---

class: middle

# Variable names

---


```r
edi_airbnb &lt;- read_csv("data/edi-airbnb.csv")
names(edi_airbnb)
```

```
##  [1] "ID"                   "Price"               
##  [3] "neighbourhood"        "accommodates"        
##  [5] "Number of bathrooms"  "Number of Bedrooms"  
##  [7] "n beds"               "Review Scores Rating"
##  [9] "Number of reviews"    "listing_url"
```

--

... but R doesn't allow spaces in variable names


```r
ggplot(edi_airbnb, aes(x = Number of bathrooms, y = Price)) +
  geom_point()
```

```
## Error: &lt;text&gt;:1:35: unexpected symbol
## 1: ggplot(edi_airbnb, aes(x = Number of
##                                       ^
```

---

## Option 1 - Define column names



```r
edi_airbnb_col_names &lt;- read_csv("data/edi-airbnb.csv",
  col_names = c("id", "price", "neighbourhood", "accommodates",
                "bathroom", "bedroom", "bed", 
                "review_scores_rating", "n_reviews", "url"))

names(edi_airbnb_col_names)
```

```
##  [1] "id"                   "price"               
##  [3] "neighbourhood"        "accommodates"        
##  [5] "bathroom"             "bedroom"             
##  [7] "bed"                  "review_scores_rating"
##  [9] "n_reviews"            "url"
```


---

## Option 2 - Format text to snake_case


```r
edi_airbnb_cleaned_names &lt;- edi_airbnb %&gt;%
  janitor::clean_names()

names(edi_airbnb_cleaned_names)
```

```
##  [1] "id"                   "price"               
##  [3] "neighbourhood"        "accommodates"        
##  [5] "number_of_bathrooms"  "number_of_bedrooms"  
##  [7] "n_beds"               "review_scores_rating"
##  [9] "number_of_reviews"    "listing_url"
```

---

class: middle

# Wrapping Up...


---

class: middle

# Variable types

---

.question[
Which class is `x`? Why?
]

.pull-left[
&lt;br&gt;&lt;br&gt;&lt;br&gt;
&lt;img src="img/df-na.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[

```r
read_csv("data/df-na.csv")
```

```
## # A tibble: 9 √ó 3
##   x     y              z     
##   &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt; 
## 1 1     a              hi    
## 2 &lt;NA&gt;  b              hello 
## 3 3     Not applicable 9999  
## 4 4     d              ola   
## 5 5     e              hola  
## 6 .     f              whatup
## 7 7     g              wassup
## 8 8     h              sup   
## 9 9     i              &lt;NA&gt;
```
]

---

## Option 1. Explicit NAs


```r
read_csv("data/df-na.csv", 
         na = c("", "NA", ".", "9999", "Not applicable"))
```

.pull-left[
&lt;br&gt;
&lt;img src="img/df-na.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[

```
## # A tibble: 9 √ó 3
##       x y     z     
##   &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt; 
## 1     1 a     hi    
## 2    NA b     hello 
## 3     3 &lt;NA&gt;  &lt;NA&gt;  
## 4     4 d     ola   
## 5     5 e     hola  
## 6    NA f     whatup
## 7     7 g     wassup
## 8     8 h     sup   
## 9     9 i     &lt;NA&gt;
```
]

---

## Option 2. Specify column types

.midi[

```r
read_csv("data/df-na.csv", 
  col_types = list(col_double(), col_character(), col_character()))
```

```
## Warning: One or more parsing issues, call `problems()` on your data frame
## for details, e.g.:
##   dat &lt;- vroom(...)
##   problems(dat)
```

```
## # A tibble: 9 √ó 3
##       x y              z     
##   &lt;dbl&gt; &lt;chr&gt;          &lt;chr&gt; 
## 1     1 a              hi    
## 2    NA b              hello 
## 3     3 Not applicable 9999  
## 4     4 d              ola   
## 5     5 e              hola  
## 6    NA f              whatup
## 7     7 g              wassup
## 8     8 h              sup   
## 9     9 i              &lt;NA&gt;
```
]

---

## Column types

.small[
**type function**  | **data type**
------------------ | -------------
`col_character()`  | character
`col_date()`       | date
`col_datetime()`   | POSIXct (date-time)
`col_double()`     | double (numeric)
`col_factor()`     | factor
`col_guess()`      | let readr guess (default)
`col_integer()`    | integer
`col_logical()`    | logical
`col_number()`     | numbers mixed with non-number characters
`col_numeric()`    | double or integer
`col_skip()`       | do not read
`col_time()`       | time
]

---

# Pause the video...

.your-turn[
- [class git repo](https://github.com/DataScience4Psych) &gt; `AE 06 - Nobels and sales + Data import` &gt; open `food-excel.Rmd` and knit. Work on **Exercise 1**.
- Read in the Excel file called `favourite-food.xlsx` from the `data-raw/` folder.
- Clean up `NA`s and make sure you're happy with variable types.
- Convert SES (socio economic status) to a factor variables with levels in the 
following order: `Low`, `Middle`, `High`.
- Write out the resulting data frame to `favourite-food.csv` in the `data/` folder.
- Finally, read `favourite-food.csv` back in from  the `data/` folder and observe the variable types. Are they as you left them?
]

---


class: middle

# Ready to move forward?

---



## `read_rds()` and `write_rds()`

- CSVs can be unreliable for saving interim results if there is specific 
variable type information you want to hold on to.
- An alternative is RDS files, you can read and write them with `read_rds()` and 
`write_rds()`, respectively.


```r
read_rds(path)
write_rds(x, path)
```

---

.your-turn[
- [class git repo](https://github.com/DataScience4Psych) &gt; `AE 06 - Nobels and sales + Data import` &gt; open `food-excel.Rmd` and knit. Work on **Exercise 2**.
- Repeat the first three steps from Exercise 1.
- Write out the resulting data frame to `favourite-food.rds` in the `data/` folder.
- Read `favourite-food.rds` back in from  the `data/` folder and observe the 
variable types.  Are they as you left them?
]

---


class: middle

# Ready to move forward?

---

.pull-left[
.your-turn[
- [class git repo](https://github.com/DataScience4Psych) &gt; `AE 06 - Nobels and sales + Data import` &gt; open `sales-excel.Rmd` and knit. 
- Load the `sales.xlsx` file from the `data-raw/` folder, using appropriate 
arguments for the `read_excel()` function such that it looks like the following.
]
]
.medi[
.pull-right[

```
## # A tibble: 9 √ó 2
##   id      n    
##   &lt;chr&gt;   &lt;chr&gt;
## 1 Brand 1 n    
## 2 1234    8    
## 3 8721    2    
## 4 1822    3    
## 5 Brand 2 n    
## 6 3333    1    
## 7 2156    3    
## 8 3987    6    
## 9 3216    5
```
]
]
---

.pull-left[
.your-turn[
- [class git repo](https://github.com/DataScience4Psych) &gt; `AE 06 - Nobels and sales + Data import` &gt; open `sales-excel.Rmd` and knit. 
- Manipulate the sales data such that it looks like the following.
]
]
.pull-right[

```
## # A tibble: 7 √ó 3
##   brand      id     n
##   &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt;
## 1 Brand 1  1234     8
## 2 Brand 1  8721     2
## 3 Brand 1  1822     3
## 4 Brand 2  3333     1
## 5 Brand 2  2156     3
## 6 Brand 2  3987     6
## 7 Brand 2  3216     5
```
]

---

class: middle

# Wrapping Up...

---

class: middle

# Importing many files

---
.medi[

```r
sales_files &lt;- fs::dir_ls("data/sales")
sales_files
```

```
## data/sales/01-sales.csv data/sales/02-sales.csv 
## data/sales/03-sales.csv
```

```r
#library(vroom)
sales &lt;- vroom::vroom(sales_files, id = "filename")
sales
```

```
## # A tibble: 19 √ó 6
##    filename                month     year brand  item     n
##    &lt;chr&gt;                   &lt;chr&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 data/sales/01-sales.csv January   2019     1  1234     3
##  2 data/sales/01-sales.csv January   2019     1  8721     9
##  3 data/sales/01-sales.csv January   2019     1  1822     2
##  4 data/sales/01-sales.csv January   2019     2  3333     1
##  5 data/sales/01-sales.csv January   2019     2  2156     9
##  6 data/sales/01-sales.csv January   2019     2  3987     6
##  7 data/sales/01-sales.csv January   2019     2  3827     6
##  8 data/sales/02-sales.csv February  2019     1  1234     8
##  9 data/sales/02-sales.csv February  2019     1  8721     2
## 10 data/sales/02-sales.csv February  2019     1  1822     3
## # ‚Ñπ 9 more rows
```
]
---

## vroom vroom!!

.pull-left[
&lt;img src="img/vroom.png" width="80%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
- **vroom** is most useful for reading large amounts of data in, fast!
- and it has nice bells-and-whistles like delimiter guessing, reading many files in at once, etc.
- Learn more at [vroom.r-lib.org](https://vroom.r-lib.org/)
]

---

class: middle

# Other types of data

---

## Other types of data

- **googlesheets4:** Google Sheets
- **haven**: SPSS, Stata, and SAS files
- **DBI**, along with a database specific backend (e.g. RMySQL, RSQLite, RPostgreSQL etc): 
  - allows you to run SQL queries against a database and return a data frame
- **jsonline**: JSON
- **xml2**: xml
- **rvest**: web scraping
- **httr**: web APIs
- **sparklyr**: data loaded into spark



---
# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))

---

class: middle

# Wrapping Up...
---

class: center, middle 

# Deeper Dive into ggplot &lt;br&gt; üåä

---




class: middle

# Deep Diving into Grammar of Graphics

---

## What does "grammar of graphics" mean?

* The analogy with English grammar, 
  * or any language's grammar, 
  * is that it allows you to put together component parts
  
--

+ Better than "grammar of graphics" might be the 
  * "orthogonal components of graphics," 
  * but that doesn't have the same alliterative appeal.


--

+ The power of the grammar of graphics is that it is modular: 
  * different aspects of the plot can be specified independently of each other.



---

## An example

+ As an example, the coordinate system is specified separately 
  * from the geometric object used to represent the points.
+ We have three representations of the same data, where
  * the only difference between them 
  * is the coordinate system used to represent them.

.medi[

```r
bar_plot = ggplot(diamonds) + 
    aes(x ="", fill = clarity)+
    geom_bar(width = 1, position = "stack")
bar_plot
```

```r
bar_plot + coord_polar()
```

```r
bar_plot + coord_polar(theta = "y")
```
]
---


```r
bar_plot
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-308-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---


```r
bar_plot + coord_polar()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-309-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---


```r
bar_plot + coord_polar(theta = "y")
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-310-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Again, the same dataset

Again, the same dataset, three different coordinate systems, very different representations:


```r
dodged_bar_plot = ggplot(diamonds) +
    geom_bar(aes(x = "", fill = clarity), width = 1, position = "dodge")
dodged_bar_plot
```

```r
dodged_bar_plot + coord_polar()
```

```r
dodged_bar_plot + coord_polar(theta = "y")
```
---


```r
dodged_bar_plot
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-312-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---


```r
dodged_bar_plot + coord_polar()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-313-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---


```r
dodged_bar_plot + coord_polar(theta = "y")
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-314-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---

class: middle

# Wrapping Up...

---

class: middle

# What are the components of a plot?

---

## Components of a plot

+ A default dataset and set of mappings from variables to aesthetics.
+ One or more _layers_, each of which contains
--

  + one geometric (`geom_*`) object, 
  + one statistical transformation (`stat_*`), 
  + one position adjustment (`position_*`), 
+ and one dataset and set of aesthetic mappings.
--

+ One scale for each aesthetic mapping.
+ A coordinate system (`coord_*`).
+ A facet specification (`facet_*`).
--

.tip[
Layers are the most important and involved part of the plot.
]


---

## What is a layer?

- data and aesthetic mapping
- statistical transformation (stat)
- geometric object (geom)
- position adjustment

--


```r
p = ggplot(diamonds, aes(x = color, y = clarity)) + geom_point()
p$layers
```

```
## [[1]]
## geom_point: na.rm = FALSE
## stat_identity: na.rm = FALSE
## position_identity
```

---

## Data and aesthetic mapping

+ Data: self evident. For ggplot the data needs to be formatted as a tibble or a data.frame.
+ Aesthetic mapping: Less evident
--

  + Describes how variables in the dataset are mapping 
     + to "aesthetic" attributes of the plot.
  + "Aesthetic" here means perceivable:
     + something you can observe on the plot.
  
---

## Aesthetic/perceivable attributes
+ Examples include
  * position along the `\(x\)`-axis, 
  * color, 
  * shape, 
  * position along the `\(y\)`-axis, 
  * opacity, 
  * linetype

---

## Data and aesthetic mapping go together

* They are not independent of each other:
* the aesthetic mapping takes variables in your data and 
  + maps them to aesthetics/perceivable parts of the plot and 
  + is therefore specific to a dataset.

---

class: middle

# Wrapping Up...

---

class: middle

# Stats, Geoms, and Positions

---

# Statistical transformation

A statistical transformation is some transformation of the data.

![](img/ggplot_stat_table.png)
--
&lt;br&gt;
.footnote[
These stat transformations and position adjustments can overlap. Often there is more than one way to create the same plot.
]


---


## Geometric objects

Geometric objects (`geom_*`) control the type of plot you create. 

Examples are:
- Points, text 
  * (zero-dimensional geometric objects)
- Line, path 
  * (one-dimensional geometric objects)
- Polygon, interval 
  * (two-dimensional geometric objects)
- More complicated: boxplot

---

## Relationship between stats and geoms

- Every statistic has a default geometric object, 
  - and every geometric object has a default statistic.
- Stats and geoms are not completely orthogonal: 
  - not every combination is valid 
  - (although many are).

---

## For example:
- `stat_bin` and `geom_bar` 
  - is valid and 
  - standard for a histogram.
- `stat_bin` and `geom_point` or `stat_bin` + `geom_line` 
  - are valid 
  - but non-standard combinations.
    - They give a plot that is resembles a histogram  
      - (interpretable that same way, too)
- `stat_identity` and  `geom_boxplot`
  - is invalid, because 
  - boxplot needs certain computed quantities from the data.

---

## Position adjustment

Used to avoid "collisions" in the plot objects:

- In bar plots where one of the aesthetics is height, 
  - the bars would often be plotted over each other. 
  - In this case we use the "dodge" or "stack" position adjustments.
- If we have issues with overplotting (multiple points in exactly the same place), 
  - we can use the "jitter" position adjustment 
    - to randomly move the points a small amount.
---
.medi[.pull-right-wide[

```r
(p = ggplot(diamonds, aes(x = color, y = price)) + 
  geom_boxplot())
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-316-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.pull-left-narrow[

```r
p$layers
```

```
## [[1]]
## geom_boxplot: outlier.colour = NULL, outlier.fill = NULL, outlier.shape = 19, outlier.size = 1.5, outlier.stroke = 0.5, outlier.alpha = NULL, notch = FALSE, notchwidth = 0.5, varwidth = FALSE, na.rm = FALSE, orientation = NA
## stat_boxplot: na.rm = FALSE, orientation = NA
## position_dodge2
```
]
]
---


```r
ggplot(diamonds,aes(x = color, y = price, color = clarity)) + 
  geom_boxplot(position = "identity")
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-318-1.png" width="60%" style="display: block; margin: auto;" /&gt;

---


```r
ggplot(diamonds,aes(x = color, y = price, color = clarity)) + 
         geom_boxplot(position = "dodge")
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-319-1.png" width="60%" style="display: block; margin: auto;" /&gt;

.footnote[`position = "dodge"` is the default for boxplots, so you don't need to specify it.]

---


```r
ggplot(diamonds,aes(x = color, y = price, color = clarity)) + 
         geom_boxplot(position = position_dodge(width = 1))
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-320-1.png" width="60%" style="display: block; margin: auto;" /&gt;

.footnote[`position = "dodge"` is the default for boxplots, so you don't need to specify it.]

---

class: middle

# Wrapping Up...

---

class: middle

# Scales and Coordinates

---

## Scales

+ So far, we've defined aesthetic mappings that specify,
  + which perceivable aspects of the plot correspond 
  + to which variables.
--

+ However, perceivable aspects of the plot 
  + can be mapped to variables many other ways.

---

## For example

+ If we have a categorical variable that takes values "A" and "B" to the color aesthetic, 
  + that means that color is going to represent 
  + whether variable took value "A" or "B". 
+ But we could do that in a practically infinite number of ways
--


+ e.g.
  - A maps to "red", B maps to "black"
  - A maps to "green", B maps to "blue"
  - A maps to "purple", B maps to "gold"
--


- ... You probably get the picture

---

## Modernized ggplot

- *Now*, ggplot has good default mappings from values into aesthetic space, 
  - but you will sometimes want to set them by hand.
--

- To do so, you use the `scale_*` functions.
--

- The *old* version of ggplot had poor mappings from continuous values to colors,
  - and the [viridis](https://cran.r-project.org/web/packages/viridis/index.html) color scheme was much better. 
- The most recent version of ggplot uses viridis by default 
  - for both continuous values and ordered factors.

---

## Coordinate system

Another aspect of the plot that can be specified independently of everything else is the coordinate system.

+ `coord_cartesian` is the default, 
  - and is almost always what you want.
--



+ `coord_flip` is sometimes useful:
  - for example, boxplots require the explanatory variable to be mapped to x, 
  - so if you want a horizontal boxplot you need to use `coord_flip`.
--
+ `coord_polar` will often make your plots look cooler 
  * and more difficult to read. 
  * Not usually recommended.
---

## Faceting

Allows you to make small multiples of plots.

+ Other grammars/plotting systems implement faceting with a fancy coordinate system, 
+ but it turns out that it's easier to use if you think about it separately.
--

+ Each facet plots a subset of the data, 
  - and it takes as input
    - what variable(s) to use to make the subsets and 
    - how to lay out the subsets.
---

## Facet options

- `facet_wrap`:
  - Lays out the plots for each subset sequentially.
--

- `facet_grid`: 
  - Subsets the data according to two separate variables. 
  
  
--

+ The facet position along the `\(x\)`-axis represents levels of one variable, 
  - and the facet position along the `\(y\)`-axis represents levels of the other variable.

---

class: middle

# Wrapping Up...

---

class: middle

# How this all works

---

## The long way

- One way to specify a ggplot is to 
  - specify all of the components we've seen.
- If you understand all the parts, 
  - this way is probably the least confusing method to specify a ggplot.
- The problem is that it's verbose.

---

## Verbose

- Suppose we want to make a plot with points and a smoother 
  - from the diamonds dataset. 
- We can specify data, mapping, geom, stat, and positions for each layer, 
  - along with scales and the coordinate system as follows:
  
--

.midi[  

```r
ggplot() +
    layer(
        data = diamonds, mapping = aes(x = carat, y = price),
        geom = "point", stat = "identity", position = "identity") +
    layer(
        data = diamonds, mapping = aes(x = carat, y = price),
        geom = "smooth", position = "identity", stat = "smooth", params = list(method = "lm")) +
    scale_x_log10() + scale_y_log10() + coord_cartesian()
```
]

---

&lt;img src="workshop_files/figure-html/unnamed-chunk-321-1.png" width="85%" style="display: block; margin: auto;" /&gt;

---

## Defaults make the code shorter

The more standard way of writing the same plot would be:
.medi[

```r
p = ggplot(data = diamonds, aes(x = carat, y = price)) +
    geom_point() +
    stat_smooth(method = "lm") +
    scale_x_log10() +
    scale_y_log10()
```
]
--

This code is still fairly long, but we don't have to specify...
- position: Default for both `geom_point` and `stat_smooth` is `position = "identity"`.
- stat, for `geom_point`: The default stat for `geom_point` is `stat = "identity"`.
- geom, for `stat_smooth`: The default geom for `stat_smooth` is `geom_smooth`.
- coordinate system: `coord_cartesian` is always the default.

---

You can check what stat, geom, and position is used for each of the layers:
.medi[

```r
names(p)
```

```
## [1] "data"        "layers"      "scales"      "mapping"    
## [5] "theme"       "coordinates" "facet"       "plot_env"   
## [9] "labels"
```
.medi[

```r
p$layers
```

```
## [[1]]
## geom_point: na.rm = FALSE
## stat_identity: na.rm = FALSE
## position_identity 
## 
## [[2]]
## geom_smooth: se = TRUE, na.rm = FALSE, orientation = NA
## stat_smooth: method = lm, formula = NULL, se = TRUE, n = 80, fullrange = FALSE, level = 0.95, na.rm = FALSE, orientation = NA, method.args = list(), span = 0.75
## position_identity
```
]

---

class: middle

# Wrapping Up...

---

class: middle

# Minard on Napoleon's invasion of Russia

---

## Minard on Napoleon's invasion of Russia

One of [the most famous statistical graphics, created by Charles Minard](https://en.wikipedia.org/wiki/Charles_Joseph_Minard) depicts Napoleon's 1812 invasion of and retreat from Russia.

.center[
&lt;img src="img/Minard.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Minard on Napoleon's invasion of Russia

One of [the most famous statistical graphics, created by Charles Minard](https://en.wikipedia.org/wiki/Charles_Joseph_Minard) depicts Napoleon's 1812 invasion of and retreat from Russia.

.center[
&lt;img src="img/Minard_Update.png" width="81%" style="display: block; margin: auto;" /&gt;
]

---
.medi[

```r
minard = read_csv("data/minard.csv");minard_cities = read_csv("data/minard-cities.csv")
(plot_troops = ggplot(minard) +
                      geom_path(aes(x = long, y = lat,
                                    color = direction,
                                    size = surviv,
                                    group = division)))
```

&lt;img src="workshop_files/figure-html/minardpt1-1.png" width="55%" style="display: block; margin: auto;" /&gt;
]

---

Let's add another layer for the cities:
.medi[

```r
(plot_both = plot_troops +
              geom_text(aes(x = long, y = lat, label = city),
              data = minard_cities, size = 3))
```

&lt;img src="workshop_files/figure-html/minardpt2-1.png" width="55%" style="display: block; margin: auto;" /&gt;
]

.footnote[Notice: we have a new dataset for this layer.]

---

## Next Steps

Some things that are still not great about this plot:

.pull-left[
- We would like the colors 
  - for advance and retreat to be gray and red.
- We want the line widths to be 
  - proportional to the number of survivors.
- We would like the line ends to be
  - round instead of square.
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-327-1.png" width="99%" style="display: block; margin: auto;" /&gt;
]

---

## An improved version of the plot, with better scales:

.small[.pull-left-narrow[

```r
ggplot(minard) +
    geom_path(aes(x = long, 
                  y = lat, 
                  color = direction, 
                  size = surviv^2, 
                  group = division), 
              lineend = "round") +
    geom_text(aes(x = long,
                  y = lat,
                  label = city),
              data = minard_cities, 
              size = 3) + 
    scale_size(range = c(.18, 15), 
               breaks = (1:3 * 10^5)^2, 
               labels = 
                 scales::comma(1:3 * 10^5),
                 "Survivors") +
    scale_color_manual(values = c("grey50",
                                  "red"), 
                       breaks = c("A",
                                  "R"), 
                       labels = c("Advance",
                                  "Retreat"),
                       "") +
    xlab(NULL) + ylab(NULL) +
    theme(axis.text = element_blank(), 
          axis.ticks = element_blank(), 
          panel.grid = element_blank())
```
]]
.pull-right-wide[
&lt;img src="workshop_files/figure-html/unnamed-chunk-328-1.png" width="99%" style="display: block; margin: auto;" /&gt;
]
---

.your-turn[
]

- Try creating a histogram on the diamonds dataset, for example with...



```r
p = ggplot() + geom_histogram(aes(x = carat), data = diamonds)
```


- Re-write this using the `layer` function. 

.tip[
- If you don't know what the default values for some of the aspects of the plot, examine `p$layers`
- Remember that a histogram is a plot with `stat_bin` and `geom_bar`. 
]

---

.your-turn[
]

.pull-left-narrow[
&lt;img src="workshop_files/figure-html/unnamed-chunk-330-1.png" width="99%" style="display: block; margin: auto;" /&gt;
]

- Modify your histogram code so that it uses a different geom, for example `geom_line` or `geom_point`.
- This change should be simple once you have the `layer` specification of a histogram.
- In your histogram, 
      - add an aesthetic mapping from one of the factor variables (maybe color or clarity) to the color aesthetic.

.question[What is the default position adjustment for a histogram? 
]

.tip[- Try changing the position adjustment to something different 
    - (try `position_dodge`).]

---

## Difficult Stretch Goal

- Recreate the Minard map more precisely. 
- Add text for the number of troops surviving on each segment, 
    - and add the time and temperature data to the bottom of the plot.

---

## ggplot and EDA

Remember our passage from Tukey:

&gt; *Exploratory data analysis is detective work*... As all detective stories remind us, many of the circumstances surrounding a crime are accidental or misleading. Equally, many of the indications to be discerned in bodies of data are accidental or misleading. To accept all appearances as conclusive would be destructively foolish, either in crime detection or in data analysis. *To fail to collect all appearances because some -- or even most -- are only accidents would, however, be gross misfeasance deserving (and often receiving) appropriate punishment.*

---

# Concluding Thoughts

- The flexibility in the grammar of graphics allows us to collect many more "appearances" in the data than we would be able to,
    - if we just have access to a handful of named plots.
--

- Many of the plots that we can make with ggplot are not useful, 
    - but the point is to try visualizing the data in many different ways.
- ggplot opens up a very large space of statistical graphics to us for not very much effort.

---

# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))
- Julia Fukuyama's EDA ([link](https://jfukuyama.github.io/))
---

class: middle

# Wrapping Up...
---

class: center, middle 

# Tips for effective data visualization &lt;br&gt; üíÖ


---




class: middle

# Designing effective visualizations

---

## Keep it simple

.pull-left-narrow[
&lt;img src="img/pie-3d.jpg" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right-wide[
&lt;img src="workshop_files/figure-html/pie-to-bar-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]


---

## Use	color	to	draw	attention

&lt;br&gt;

.pull-left[
&lt;img src="workshop_files/figure-html/unnamed-chunk-331-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-332-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]


---

## Tell a story

&lt;img src="img/time-series-story.png" width="95%" style="display: block; margin: auto;" /&gt;

.footnote[
Credit: Angela Zoss and Eric Monson, Duke DVS
]

---

class: middle

# Wrapping Up...

---

class: middle

# Principles for effective visualizations

---

## Principles	for	effective	visualizations

- Order matters
- Put long categories on the y-axis
- Keep	scales consistent
- Select meaningful colors
- Use meaningful and nonredundant labels

---

## Data

In September 2019, YouGov survey asked 1,639 GB adults the following question:

.pull-left[
&gt; In hindsight, do you think Britain was right/wrong to vote to leave EU?
&gt;
&gt;- Right to leave  
&gt;- Wrong to leave  
&gt;- Don't know

]
.pull-right[


&lt;img src="workshop_files/figure-html/unnamed-chunk-335-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]

.footnote[ 
Source: [YouGov Survey Results](https://d25d2506sfb94s.cloudfront.net/cumulus_uploads/document/x0msmggx08/YouGov%20-%20Brexit%20and%202019%20election.pdf), retrieved Oct 7, 2019
]

---

class: middle

# Order matters

---

## Alphabetical order is rarely ideal

.medi.pull-left[

```r
ggplot(brexit, aes(x = opinion)) +
  geom_bar()
```
]
.pull-right-wide[
&lt;img src="workshop_files/figure-html/unnamed-chunk-336-1.png" width="85%" style="display: block; margin: auto;" /&gt;
]
---

## Order by frequency

`fct_infreq`: Reorder factors' levels by frequency

.midi[

```r
ggplot(brexit, aes(x = fct_infreq(opinion))) +
  geom_bar()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-337-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

---

## Clean up labels
.medi.pull-left[

```r
ggplot(brexit, aes(x = opinion)) +
  geom_bar() +
* labs(
*   x = "Opinion",
*   y = "Count"
* )
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-338-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
---

## Alphabetical order is rarely ideal

.midi.pull-left-narrow[

```r
ggplot(brexit, aes(x = region)) +
  geom_bar()
```
]

.pull-right-wide[
&lt;img src="workshop_files/figure-html/unnamed-chunk-339-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]



---



## Use inherent level order

`fct_relevel`: Reorder factor levels using a custom order



```r
brexit &lt;- brexit %&gt;%
  mutate(
*   region = fct_relevel(
      region,
      "london", "rest_of_south", "midlands_wales", "north", "scot"
    )
  )
```

---
.pull-left-wide[
&lt;img src="workshop_files/figure-html/unnamed-chunk-341-1.png" width="120%" style="display: block; margin: auto;" /&gt;
]
---
## Clean up labels

`fct_recode`: Change factor levels by hand


```r
brexit &lt;- brexit %&gt;%
  mutate(
*   region = fct_recode(
      region,
      London = "london",
      `Rest of South` = "rest_of_south",
      `Midlands / Wales` = "midlands_wales",
      North = "north",
      Scotland = "scot"
    )
  )
```

---

## Clean!

&lt;img src="workshop_files/figure-html/unnamed-chunk-343-1.png" width="75%" style="display: block; margin: auto;" /&gt;

---

class: middle

# Put long categories on the y-axis

---

## Long categories can be hard to read

&lt;img src="workshop_files/figure-html/unnamed-chunk-344-1.png" width="75%" style="display: block; margin: auto;" /&gt;

---

## Move them to the y-axis
.medi[

```r
ggplot(brexit, aes(x = region)) +
  geom_bar() +
* coord_flip()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-345-1.png" width="55%" style="display: block; margin: auto;" /&gt;
]
---

## Move them to the y-axis
.medi[

```r
*ggplot(brexit, aes(y = region)) +
  geom_bar()
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-346-1.png" width="55%" style="display: block; margin: auto;" /&gt;
]

---

## And reverse the order of levels
`fct_rev`: Reverse order of factor levels



.medi.pull-left[

```r
*ggplot(brexit, aes(y = fct_rev(region))) +
  geom_bar()
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-347-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]


---

## Clean up labels

.medi.pull-left[

```r
ggplot(brexit, aes(y = fct_rev(region))) +
  geom_bar() +
* labs(
*   x = "Count",
*   y = "Region"
* )
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-348-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]


---

class: middle

# Pick a purpose

---

## Segmented bar plots can be hard to read

.medi.pull-left-wide[

```r
*ggplot(brexit, aes(y = region, fill = opinion)) +
  geom_bar()
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-349-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]


---

&lt;img src="workshop_files/figure-html/unnamed-chunk-350-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Use facets

.medi.pull-left-wide[

```r
ggplot(brexit, aes(y = opinion, fill = region)) +
  geom_bar() +
* facet_wrap(~region, nrow = 1)
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-351-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
---

&lt;img src="workshop_files/figure-html/unnamed-chunk-352-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Avoid redundancy?

.medi.pull-left[

```r
ggplot(brexit, aes(y = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1)
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-353-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
---

&lt;img src="workshop_files/figure-html/unnamed-chunk-354-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---


## Redundancy can help tell a story

.medi.pull-left[

```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1)
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-355-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
---

&lt;img src="workshop_files/figure-html/unnamed-chunk-356-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---


## Be selective with redundancy

.medi.pull-left[

```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1) +
* guides(fill = FALSE)
```

]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-357-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
---

&lt;img src="workshop_files/figure-html/unnamed-chunk-358-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Informative labels

.medi.pull-left[

```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1) +
  guides(fill = FALSE) +
  labs(
*   title = "Was Britain right/wrong to vote to leave EU?",
    x = NULL, y = NULL
  )
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-359-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]


---

&lt;img src="workshop_files/figure-html/unnamed-chunk-360-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## A bit more info

.medi[

```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1) +
  guides(fill = FALSE) +
  labs(
    title = "Was Britain right/wrong to vote to leave EU?",
*   subtitle = "YouGov Survey Results, 2-3 September 2019",
*   caption = "Source: https://d25d2506sfb94s.cloudfront.net/cumulus_uploads/document/x0msmggx08/YouGov%20-%20Brexit%20and%202019%20election.pdf",
    x = NULL, y = NULL
  )
```
]

---

&lt;img src="workshop_files/figure-html/unnamed-chunk-361-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Let's do better

.medi[

```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1) +
  guides(fill = FALSE) +
  labs(
    title = "Was Britain right/wrong to vote to leave EU?",
    subtitle = "YouGov Survey Results, 2-3 September 2019",
*   caption = "Source: bit.ly/2lCJZVg",
    x = NULL, y = NULL
  )
```

]

---

&lt;img src="workshop_files/figure-html/unnamed-chunk-362-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Fix up facet labels

.medi[

```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region,
    nrow = 1,
*   labeller = label_wrap_gen(width = 12)
  ) + 
  guides(fill = FALSE) +
  labs(
    title = "Was Britain right/wrong to vote to leave EU?",
    subtitle = "YouGov Survey Results, 2-3 September 2019",
    caption = "Source: bit.ly/2lCJZVg",
    x = NULL, y = NULL
  )
```
]

---



---
class: middle

# Select meaningful colors

---

## Rainbow colors are not always the right choice

.medi.pull-left[

```r
ggplot(brexit, aes(y= region, fill = opinion)) +
  geom_bar(position = "fill") 
```
]

.pull-right[

&lt;img src="workshop_files/figure-html/unnamed-chunk-364-1.png" width="100%" style="display: block; margin: auto;" /&gt;

]

---

&lt;img src="workshop_files/figure-html/unnamed-chunk-365-1.png" width="80%" style="display: block; margin: auto;" /&gt;

---

## Manually choose colors when needed

.midi.pull-left-wide[

```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1, labeller = label_wrap_gen(width = 12)) +
  guides(fill = FALSE) +
  labs(title = "Was Britain right/wrong to vote to leave EU?",
       subtitle = "YouGov Survey Results, 2-3 September 2019",
       caption = "Source: bit.ly/2lCJZVg",
       x = NULL, y = NULL) +
* scale_fill_manual(values = c(
*   "Wrong" = "red",
*   "Right" = "green",
*   "Don't know" = "gray"
* ))
```
]

.pull-right-narrow[

&lt;img src="workshop_files/figure-html/unnamed-chunk-366-1.png" width="100%" style="display: block; margin: auto;" /&gt;

]

---
.center[
&lt;img src="workshop_files/figure-html/unnamed-chunk-367-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Choosing better colors

.center.large[
[colorbrewer2.org](https://colorbrewer2.org/)
]

&lt;img src="img/color-brewer.png" width="60%" style="display: block; margin: auto;" /&gt;

---

## Use better colors
.midi.pull-left-wide[

```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1, labeller = label_wrap_gen(width = 12)) +
  guides(fill = FALSE) +
  labs(title = "Was Britain right/wrong to vote to leave EU?",
       subtitle = "YouGov Survey Results, 2-3 September 2019",
       caption = "Source: bit.ly/2lCJZVg",
       x = NULL, y = NULL) +
  scale_fill_manual(values = c(
*   "Wrong" = "#ef8a62",
*   "Right" = "#67a9cf",
*   "Don't know" = "gray"
  ))
```
]

.pull-right-narrow[

&lt;img src="workshop_files/figure-html/unnamed-chunk-369-1.png" width="100%" style="display: block; margin: auto;" /&gt;

]

---

.center[
&lt;img src="workshop_files/figure-html/unnamed-chunk-370-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

## Select theme


```r
ggplot(brexit, aes(y = opinion, fill = opinion)) +
  geom_bar() +
  facet_wrap(~region, nrow = 1, labeller = label_wrap_gen(width = 12)) +
  guides(fill = FALSE) +
  labs(title = "Was Britain right/wrong to vote to leave EU?",
       subtitle = "YouGov Survey Results, 2-3 September 2019",
       caption = "Source: bit.ly/2lCJZVg",
       x = NULL, y = NULL) +
  scale_fill_manual(values = c("Wrong" = "#ef8a62",
                               "Right" = "#67a9cf",
                               "Don't know" = "gray")) +
* theme_minimal()
```


---

.center[
&lt;img src="workshop_files/figure-html/unnamed-chunk-371-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---


## Spot the Difference

.pull-right-narrow[
&lt;img src="workshop_files/figure-html/unnamed-chunk-372-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

.pull-left-narrow[
&lt;img src="workshop_files/figure-html/unnamed-chunk-373-1.png" width="60%" style="display: block; margin: auto;" /&gt;
]

---

.your-turn[
### .hand[Your turn!]
.midi[
- `AE 07 - Brexit + Telling stories with dataviz` &gt; `brexit.Rmd`. 
- Change the visualization in three different ways to tell slightly different stories with it each time.
]
]



---

## Viridis scale works well with ordinal data 
.medi.pull-left-wide[

```r
ggplot(brexit, aes(y = region, fill = opinion)) +
  geom_bar(position = "fill") +
  scale_fill_viridis_d()
```
]
.pull-right[
&lt;img src="workshop_files/figure-html/unnamed-chunk-374-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]


---
.center[
&lt;img src="workshop_files/figure-html/unnamed-chunk-375-1.png" width="80%" style="display: block; margin: auto;" /&gt;
]

---

### Clean up labels (Again)

&lt;img src="workshop_files/figure-html/unnamed-chunk-376-1.png" width="75%" style="display: block; margin: auto;" /&gt;


---

# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))

---

class: middle

# Wrapping Up...
---

class: center, middle 

#  "Communicating data science results effectively &lt;br&gt; üóû

---



class: middle

# Communicating data science results effectively

---

# Five core activities of data science

1. Stating and refining the question
1. Exploring the data
1. Building formal statistical models
1. Interpreting the results
1. Communicating the results

.center[
&lt;img src="img/data-science.png" width="60%" height="100%" style="display: block; margin: auto;" /&gt;
]
.footnote[
Roger D. Peng and Elizabeth Matsui. "The Art of Data Science." A Guide for Anyone Who Works with Data. Skybrude Consulting, LLC (2015).
]

---

class: middle

# Stating and refining the question

---

## Six types of questions

1. **Descriptive:** summarize a characteristic of a set of data
1. **Exploratory:** analyze to see if there are patterns, trends, or relationships between variables (hypothesis generating)
1. **Inferential:** analyze patterns, trends, or relationships in representative data from a population
1. **Predictive:** make predictions for individuals or groups of individuals
1. **Causal:** whether changing one factor will change another factor, on average, in a population
1. **Mechanistic:** explore "how" as opposed to whether

.footnote[
Jeffery T. Leek and Roger D. Peng. "What is the question?." Science 347.6228 (2015): 1314-1315.
]

---

## Ex: COVID-19 and Vitamin D

1. **Descriptive:** frequency of hospitalizations due to COVID-19 in a set of data collected from a group of individuals
--

1. **Exploratory:** examine relationships between a range of dietary factors and COVID-19 hospitalizations
--

1. **Inferential:** examine whether any relationship between taking Vitamin D supplements and COVID-19 hospitalizations found in the sample hold for the population at large

--
1. **Predictive:** what types of people will take Vitamin D supplements during the next year

--
1. **Causal:** whether people with COVID-19 who were randomly assigned to take Vitamin D supplements or those who were not are hospitalized

--
1. **Mechanistic:** how increased vitamin D intake leads to a reduction in the number of viral illnesses

---

## Questions to data science problems

- Do you have appropriate data to answer your question?
- Do you have information on confounding variables?
- Was the data you're working with collected in a way that introduces bias?

--
.pull-left[
.question[
- Suppose I want to estimate the average number of children in households in Winston-Salem. 
- I conduct a survey at an elementary school in Winston-Salem and ask those students: 
  - how many children, including themselves, live in their house.
- Then, I take the average of the responses. 
]
]

--
.pull-right[
.question[
- Is this a biased or an unbiased estimate of the number of children in households in Winston-Salem? 
- If biased, will the value be an overestimate or underestimate?
]
]
---

class: middle

# Exploratory data analysis

---

## Checklist

- Formulate your question
- Read in your data
- Check the dimensions
- Look at the top and the bottom of your data
- Validate with at least one external data source
- Make a plot
- Try the easy solution first

---

## Formulate your question

- Consider scope:
  - Are air pollution levels higher on the east coast than on the west coast?
  - Are hourly ozone levels on average higher in New York City than they are in Los Angeles?
  - Do counties in the eastern United States have higher ozone levels than counties in the western United States?
- Most importantly: "Do I have the right data to answer this question?"

---

## Read in your data

- Place your data in a folder called `data`
- Read it into R with `read_csv()` or friends (`read_delim()`, `read_excel()`, etc.)


```r
library(readxl)
fav_food &lt;- read_excel("data/favorite-food.xlsx")
fav_food
```

```
## # A tibble: 5 √ó 4
##   `Student ID` `Full Name`      favorite.food      mealPlan      
##          &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;              &lt;chr&gt;         
## 1            1 Sunil Huffmann   Strawberry yoghurt Lunch only    
## 2            2 Barclay Lynn     French fries       Lunch only    
## 3            3 Jayendra Lyne    Peaches            Breakfast and‚Ä¶
## 4            4 Leon Rossini     Anchovies          Lunch only    
## 5            5 Chidiegwu Dunkel Pizza              Breakfast and‚Ä¶
```

---

## `clean_names()`

If the variable names are malformatted, use `janitor::clean_names()`

.small[

```r
library(janitor)
fav_food %&gt;% clean_names()  
```

```
## # A tibble: 5 √ó 4
##   student_id full_name        favorite_food      meal_plan       
##        &lt;dbl&gt; &lt;chr&gt;            &lt;chr&gt;              &lt;chr&gt;           
## 1          1 Sunil Huffmann   Strawberry yoghurt Lunch only      
## 2          2 Barclay Lynn     French fries       Lunch only      
## 3          3 Jayendra Lyne    Peaches            Breakfast and l‚Ä¶
## 4          4 Leon Rossini     Anchovies          Lunch only      
## 5          5 Chidiegwu Dunkel Pizza              Breakfast and l‚Ä¶
```
]

---

class: middle

# Wrapping Up...
---


class: middle

# Case study: NYC Squirrels!

---

## NYC Squirrels!

- [The Squirrel Census](https://www.thesquirrelcensus.com/) is a multimedia science, design, and storytelling project focusing on the Eastern gray (*Sciurus carolinensis*). They count squirrels and present their findings to the public.
- This table contains squirrel data for each of the 3,023 sightings, including location coordinates, age, primary and secondary fur color, elevation, activities, communications, and interactions between squirrels and with humans.


```r
#install_github("mine-cetinkaya-rundel/nycsquirrels18")
library(nycsquirrels18)
```

---

## Locate the codebook

[mine-cetinkaya-rundel.github.io/nycsquirrels18/reference/squirrels.html](https://mine-cetinkaya-rundel.github.io/nycsquirrels18/reference/squirrels.html)

&lt;br&gt;&lt;br&gt;

--

## Check the dimensions


```r
dim(squirrels)
```

```
## [1] 3023   38
```

---

## Look at the top...

.midi[

```r
squirrels %&gt;% head()
```

```
## # A tibble: 6 √ó 38
##    long   lat unique_squirrel_id hectare NS    EW    shift
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 -74.0  40.8 13A-PM-1014-04     13A     13    A     PM   
## 2 -74.0  40.8 15F-PM-1010-06     15F     15    F     PM   
## 3 -74.0  40.8 19C-PM-1018-02     19C     19    C     PM   
## 4 -74.0  40.8 21B-AM-1019-04     21B     21    B     AM   
## 5 -74.0  40.8 23A-AM-1018-02     23A     23    A     AM   
## 6 -74.0  40.8 38H-PM-1012-01     38H     38    H     PM   
## # ‚Ñπ 31 more variables: date &lt;date&gt;,
## #   hectare_squirrel_number &lt;dbl&gt;, age &lt;chr&gt;,
## #   primary_fur_color &lt;chr&gt;, highlight_fur_color &lt;chr&gt;,
## #   combination_of_primary_and_highlight_color &lt;chr&gt;,
## #   color_notes &lt;chr&gt;, location &lt;chr&gt;,
## #   above_ground_sighter_measurement &lt;chr&gt;,
## #   specific_location &lt;chr&gt;, running &lt;lgl&gt;, chasing &lt;lgl&gt;, ‚Ä¶
```
]

---

## ...and the bottom

.midi[

```r
squirrels %&gt;% tail()
```

```
## # A tibble: 6 √ó 38
##    long   lat unique_squirrel_id hectare NS    EW    shift
##   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;              &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;
## 1 -74.0  40.8 6D-PM-1020-01      06D     06    D     PM   
## 2 -74.0  40.8 21H-PM-1018-01     21H     21    H     PM   
## 3 -74.0  40.8 31D-PM-1006-02     31D     31    D     PM   
## 4 -74.0  40.8 37B-AM-1018-04     37B     37    B     AM   
## 5 -74.0  40.8 21C-PM-1006-01     21C     21    C     PM   
## 6 -74.0  40.8 7G-PM-1018-04      07G     07    G     PM   
## # ‚Ñπ 31 more variables: date &lt;date&gt;,
## #   hectare_squirrel_number &lt;dbl&gt;, age &lt;chr&gt;,
## #   primary_fur_color &lt;chr&gt;, highlight_fur_color &lt;chr&gt;,
## #   combination_of_primary_and_highlight_color &lt;chr&gt;,
## #   color_notes &lt;chr&gt;, location &lt;chr&gt;,
## #   above_ground_sighter_measurement &lt;chr&gt;,
## #   specific_location &lt;chr&gt;, running &lt;lgl&gt;, chasing &lt;lgl&gt;, ‚Ä¶
```
]

---

## Validate with at least one external data source

.medi[.pull-left-narrow[

```
## # A tibble: 3,023 √ó 2
##     long   lat
##    &lt;dbl&gt; &lt;dbl&gt;
##  1 -74.0  40.8
##  2 -74.0  40.8
##  3 -74.0  40.8
##  4 -74.0  40.8
##  5 -74.0  40.8
##  6 -74.0  40.8
##  7 -74.0  40.8
##  8 -74.0  40.8
##  9 -74.0  40.8
## 10 -74.0  40.8
## 11 -74.0  40.8
## 12 -74.0  40.8
## 13 -74.0  40.8
## 14 -74.0  40.8
## 15 -74.0  40.8
## # ‚Ñπ 3,008 more rows
```
]
]
.pull-right-wide[
&lt;img src="img/central-park-coords.png" width="100%" style="display: block; margin: auto;" /&gt;
]

---

## Make a plot

.medi[.pull-right[

```r
ggplot(squirrels, aes(x = long, y = lat)) +
  geom_point(alpha = 0.2)
```
]
]
.pull-left-wide[
&lt;img src="workshop_files/figure-html/unnamed-chunk-386-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]


--

.pull-left-narrow[
**Hypothesis:** Squirrel sightings will have a higher density on the perimeter than inside the park.
]
---

## Try the easy solution first

.small[
.pull-right-narrow[

```r
squirrels &lt;- squirrels %&gt;%
  separate(hectare, 
           into = c("NS", "EW"), 
           sep = 2, remove = FALSE) %&gt;%
  mutate(where = 
        if_else(NS %in% c("01", "42") | 
                 EW %in% c("A", "I"),
                      "perimeter",
                      "inside")) 

ggplot(squirrels, aes(x = long, y = lat,
                      color = where)) +
  geom_point(alpha = 0.2)
```
]
]
.pull-left-wide[
&lt;img src="workshop_files/figure-html/unnamed-chunk-387-1.png" width="90%" style="display: block; margin: auto;" /&gt;
]
					   
---

## Then go deeper...

.medi[.pull-left[

```r
hectare_counts &lt;- squirrels %&gt;%
  group_by(hectare) %&gt;%
  summarize(n = n()) 

hectare_centroids &lt;- squirrels %&gt;%
  group_by(hectare) %&gt;%
  summarize(
    centroid_x = mean(long),
    centroid_y = mean(lat))

squirrels %&gt;%
  left_join(hectare_counts,
            by = "hectare") %&gt;%
  left_join(hectare_centroids,
            by = "hectare") %&gt;%
  ggplot(aes(x = centroid_x, 
             y = centroid_y, 
             color = n)) +
  geom_hex()
```

```
## Warning: Computation failed in `stat_binhex()`
## Caused by error in `compute_group()`:
## ! The package "hexbin" is required for `stat_binhex()`
```
]		
]
.pull-right[

```
## Warning: Computation failed in `stat_binhex()`
## Caused by error in `compute_group()`:
## ! The package "hexbin" is required for `stat_binhex()`
```

&lt;img src="workshop_files/figure-html/unnamed-chunk-388-1.png" width="100%" style="display: block; margin: auto;" /&gt;
]
---


```r
hectare_counts &lt;- squirrels %&gt;%
  group_by(hectare) %&gt;%
  summarize(n = n()) 

hectare_centroids &lt;- squirrels %&gt;%
  group_by(hectare) %&gt;%
  summarize(
    centroid_x = mean(long),
    centroid_y = mean(lat)
  )

squirrels %&gt;%
  left_join(hectare_counts, by = "hectare") %&gt;%
  left_join(hectare_centroids, by = "hectare") %&gt;%
  ggplot(aes(x = centroid_x, y = centroid_y, color = n)) +
  geom_hex()
```

---

## The squirrel is staring at me!

.medi[

```r
squirrels %&gt;%
  filter(str_detect(other_interactions, "star")) %&gt;%
  select(shift, age, other_interactions)
```

```
## # A tibble: 11 √ó 3
##    shift age   other_interactions                                
##    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;                                             
##  1 AM    Adult staring at us                                     
##  2 PM    Adult he took 2 steps then turned and stared at me      
##  3 PM    Adult stared                                            
##  4 PM    Adult stared                                            
##  5 PM    Adult stared                                            
##  6 PM    Adult stared &amp; then went back up tree‚Äîthen ran to diffe‚Ä¶
##  7 PM    Adult stared at me                                      
##  8 AM    Adult approaches (saw me &amp; came forward),runs from (sta‚Ä¶
##  9 AM    Adult started climbing down to me                       
## 10 PM    Adult stared at me                                      
## # ‚Ñπ 1 more row
```
]

---

## Communicating for your audience
.pull-left-narrow[
- Avoid: 
  - jargon, 
  - uninterpreted results, 
  - lengthy output
- Pay attention to: 
  - organization, 
  - presentation, 
  - flow
]

.pull-right-wide[
- Don't forget about: 
  - code style, 
  - coding best practices, 
  - meaningful commits
- Be open to: 
  - suggestions, 
    - feedback, 
    - taking (calculated) risks
]

---
# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))
- Jeffery T. Leek and Roger D. Peng. "What is the question?." Science 347.6228 (2015): 1314-1315.
- Roger D. Peng and Elizabeth Matsui. "The Art of Data Science." A Guide for Anyone Who Works with Data. Skybrude Consulting, LLC (2015).
---

class: middle

# Wrapping Up...


---
class: center, middle 

# Functions and iteration &lt;br&gt; ü§ñ

---



class: middle


# Functions

---

## When should you write a function?
&lt;br&gt;
--
.pull-left[
&lt;img src="img/funct-all-things.png" width="100%" style="display: block; margin: auto;" /&gt;
]
--
.pull-right[

- When you've copied and pasted a block of code more than twice.
]

--

&lt;br&gt;
.question[
How many times will we need to copy and paste the code we developed to scrape data on all of the art??
]

---

## Why functions?

- Automate common tasks in a more powerful and general way than copy-and-pasting:
  - Give your function an evocative name that makes your code easier to understand
  - As requirements change, only need to update code in one place, instead of many
  - Eliminate chance of making incidental mistakes when you copy and paste
      - (for example... updating a variable name in one place, but not in another)
      
--

- Long-term
  - Improve your reach as a data scientist by writing functions (and packages!) that others use
  - Useful for internal lab management as well...


---

## Inputs

.question[
How many inputs does the following code have?
]

.midi[

```r
## set url ----
first_info_url &lt;- "https://collections.ed.ac.uk/art/record/22024?highlight=*:*"

## read page at url ----
page &lt;- read_html(first_info_url)

## scrape headers ----
headers &lt;- page %&gt;%
  html_nodes("th") %&gt;%
  html_text()

## scrape values ----
values &lt;- page %&gt;%
  html_nodes("td") %&gt;%
  html_text() %&gt;%
  str_squish()

## put together in a tibble and add link to help keep track ----
tibble(headers, values) %&gt;%
  pivot_wider(names_from = headers, values_from = values) %&gt;%
  add_column(link = first_info_url)
```
]

---

## Inputs

.question[
How many inputs does the following code have?
]

.midi[

```r
## set url ----
*first_info_url &lt;- "https://collections.ed.ac.uk/art/record/22024?highlight=*:*"

## read page at url ----
*page &lt;- read_html(first_info_url)

## scrape headers ----
headers &lt;- page %&gt;%
  html_nodes("th") %&gt;%
  html_text()

## scrape values ----
values &lt;- page %&gt;%
  html_nodes("td") %&gt;%
  html_text() %&gt;%
  str_squish()

## put together in a tibble and add link to help keep track ----
tibble(headers, values) %&gt;%
  pivot_wider(names_from = headers, values_from = values) %&gt;%
* add_column(link = first_info_url)
```
]

---

## Turn your code into a function
.pull-left[
- Pick a short but informative **name**, preferably a verb.
]

.pull-right[

```r
scrape_art_info &lt;- 
```
]
---

## Turn your code into a function

.pull-left[
- Pick a short but informative **name**, preferably a verb.
- List inputs, or **arguments**, to the function inside `function`. If we had more arguments the call would look like `function(x, y, z)`.

]

.pull-right[


```r
scrape_art_info &lt;- function(x){
  
  
  
  
  
}  
```
]
---

## Turn your code into a function
.pull-left[
- Pick a short but informative **name**, preferably a verb.
- List inputs, or **arguments**, to the function inside `function`. If we had more the call would look like `function(x, y, z)`.
- Place the **code** you have developed in body of the function, a `{}` block that immediately follows `function(...)`.
]
.pull-right[

```r
scrape_art_info &lt;- function(x){

  # code we developed earlier 
  # to scrape info 
  # on single art piece goes here
  
}
```
]
---

.your-turn[
- [class git repo](https://github.com/DataScience4Psych) &gt; `AE 09 - UoE Art + Functions`.
- Open `02-functionalize.R`
- Follow along, and fill in the blanks if you like
]

---

.midi[

```r
scrape_art_info &lt;- function(x){
  
  # read page at url ----
  page &lt;- read_html(x)
  
  # scrape headers ----
  headers &lt;- page %&gt;%
    html_nodes("th") %&gt;%
    html_text()
  
  # scrape values ----
  values &lt;- page %&gt;%
    html_nodes("td") %&gt;%
    html_text() %&gt;%
    str_squish()

  # put together in a tibble and add link to help keep track ----
  tibble(headers, values) %&gt;%
    pivot_wider(names_from = headers, values_from = values) %&gt;%
    add_column(link = x)
  
}
```
]

---

class: middle

# Writing functions

---

## What goes in / what comes out?

- They take input(s) defined in the function definition

.medi[

```r
function([inputs separated by commas]){
  # what to do with those inputs
}
```
]

- By default they return the last value computed in the function

.medi[

```r
scrape_page &lt;- function(x){
  # do bunch of stuff with the input...
  # return a tibble
  tibble(...)
}
```
]

 - You can define more outputs to be returned in a list as well as nice print methods 
   - (but we won't go there for now...)


---

.question[
What is going on here?
]


```r
add_2 &lt;- function(x){
  x + 2
  1000
}
```


```r
add_2(3)
```

```
## [1] 1000
```

```r
add_2(10)
```

```
## [1] 1000
```

---


## Naming functions

&gt; "There are only two hard things in Computer Science: cache invalidation and naming things." 

&gt;  -- Phil Karlton

---

## Naming functions

- Names should be short but clearly evoke what the function does

--
- Names should be verbs, not nouns

--
- Multi-word names should be separated by underscores (`snake_case` as opposed to `camelCase`)

--
- A family of functions should be named similarly (`scrape_page()`, `scrape_speech()` OR `str_remove()`, `str_replace()` etc.)

--
- Avoid overwriting existing (especially widely used) functions


```r
# JUST DON'T
mean &lt;- function(x){ 
  x * 3 
  }
```


---

class: middle

# Wrapping Up



---

class: middle

# Automation

---

## Define the task

- Goal: Scrape info on all 2909 art pieces in the collection
- So far:
.small[

```r
scrape_art_info(uoe_art$link[1])
scrape_art_info(uoe_art$link[2])
scrape_art_info(uoe_art$link[3])
```
]
- What else do we need to do?
  - Run the `scrape_art_info()` function on all 2909 links
  - Combine the resulting data frames from each run into one giant data frame with 2909 rows
  
---

## Inputs

.question[
You now have a function that will scrape the relevant info on art pieces given the URL of its individual info page. Where can we get a list of URLs of each of the art pieces in the collection?
]

--

From the data frame you constructed previously: `uoe_art$link`

---

## Iteration

.question[
How can we tell R to apply the `scrape_art_info()` function to each link in `uoe_art$link`?
]

--

- Option 1: Write a **for loop**, i.e. explicitly tell R to visit a link, apply the function, store the result, then visit the next link, apply the function, append the result to the stored result from the previous link, and so on and so forth.
--

- Option 2: **Map** the function to each element in the list of links, and let R take care of the storing and appending of results.
--

- We'll go with Option 2!

---

## How does mapping work?

Suppose we have exam 1 and exam 2 scores of 4 students stored in a list...


```r
exam_scores &lt;- list(
  exam1 &lt;- c(80, 90, 70, 50),
  exam2 &lt;- c(85, 83, 45, 60)
)
```

--

...and we find the mean score in each exam


```r
map(exam_scores, mean)
```

```
## [[1]]
## [1] 72.5
## 
## [[2]]
## [1] 68.25
```

---

...and suppose we want the results as a numeric (double) vector


```r
map_dbl(exam_scores, mean)
```

```
## [1] 72.50 68.25
```

...or as a character string


```r
map_chr(exam_scores, mean)
```

```
## Warning: Automatic coercion from double to character was deprecated in
## purrr 1.0.0.
## ‚Ñπ Please use an explicit call to `as.character()` within
##   `map_chr()` instead.
## Call `lifecycle::last_lifecycle_warnings()` to see where this
## warning was generated.
```

```
## [1] "72.500000" "68.250000"
```

---

## `map_something`

Functions for looping over an object and returning a value (of a specific type):

* `map()` - returns a list
* `map_lgl()` - returns a logical vector
* `map_int()` - returns an integer vector
* `map_dbl()` - returns a double vector
* `map_chr()` - returns a character vector
* `map_df()` / `map_dfr()` - returns a data frame by row binding
* `map_dfc()` - returns a data frame by column binding
* ...

---


class: middle

# Deeper Dive into Functions...

---

## Writing and calling functions

- Why?
--

  - Make your code more readable.
--
  - Allows you to re-use related lines of code for slightly different tasks.

--

  - Makes testing your code easier.

---

## What is a function?

- A way of turning some inputs into some outputs.

- A way of tying together related pieces of code.

- An object.

---

## Function creation

Syntax for function creation:

```
f = function(arguments) {
	body
}
```

- `arguments` are assignments of values to variables.

- `body` is the code you want to execute.

---

So for example, if we return to our steak-cooking example from the first week, we might define the following function:


```r
steak_directions = function(temp, steak_type) {
    if(steak_type == "rare" &amp; temp &gt; 115) {
        return("take your steak off!")
    } else if(steak_type == "med_rare" &amp; temp &gt; 125) {
        return("take your steak off!")        
    } 
    "you can keep cooking"
}
```

--

We can see the arguments and body of the function using `formals` and `body`, respectively.


```r
formals(steak_directions)
```

```
## $temp
## 
## 
## $steak_type
```

```r
body(steak_directions)
```

```
## {
##     if (steak_type == "rare" &amp; temp &gt; 115) {
##         return("take your steak off!")
##     }
##     else if (steak_type == "med_rare" &amp; temp &gt; 125) {
##         return("take your steak off!")
##     }
##     "you can keep cooking"
## }
```
---

## Function arguments

Once you have a function, you call it by specifying the values for all of the arguments.

The values can be specified in two ways:

- By position: first argument is assigned to the first variable in the function definition, second argument to the second variable in the function definition, and so on

- By name: arguments are specified by name instead of being inferred based on position.

The two can be combined.
---

So for example, the following are all the same:


```r
steak_directions(temp = 120, steak_type = "rare")
```

```
## [1] "take your steak off!"
```

```r
steak_directions(steak_type = "rare", temp = 120)
```

```
## [1] "take your steak off!"
```

```r
steak_directions(120, "rare")
```

```
## [1] "take your steak off!"
```

But this is of course different and will not work:

```r
simulate_birthdays("rare", 120)
```

```
## Error in simulate_birthdays("rare", 120): could not find function "simulate_birthdays"
```

---

## Default arguments

When you define a function, you can set default values for any/all of the arguments.

When you call such a function, if you don't specify a value for that argument, it will automatically go to the default value.

--

For example, in the following function the default argument for `steak_type` is `"rare"`.


```r
steak_directions = function(temp, steak_type = "rare") {
    if(steak_type == "rare" &amp; temp &gt; 115) {
        return("take your steak off!")
    } else if(steak_type == "med_rare" &amp; temp &gt; 125) {
        return("take your steak off!")        
    } 
    "you can keep cooking"
}
```
--
If we don't specify `steak_type`, we will get results as if we had specified it to be `"rare"`, but we can also over-ride that argument if we set it explicitly:



```r
steak_directions(120, "rare")
```

```
## [1] "take your steak off!"
```

```r
steak_directions(120)
```

```
## [1] "take your steak off!"
```

```r
steak_directions(120, steak_type = "med_rare")
```

```
## [1] "you can keep cooking"
```


---

## Return values

When a function is called, the commands in the body of the function are executed, and a value is returned.

The return value is either:

- The value of last command executed, or

- A value set explicitly using the `return` syntax.

The commands in the body of the function are executed until a `return` statement is encountered or the the end of the body is reached, whichever comes first.

---


Let's think through what happens when we call the function these two ways:


```r
steak_directions = function(temp, steak_type = "rare") {
    if(steak_type == "rare" &amp; temp &gt; 115) {
        return("take your steak off!")
    } else if(steak_type == "med_rare" &amp; temp &gt; 125) {
        return("take your steak off!")        
    } 
    "you can keep cooking"
}
steak_directions(steak_type = "rare", temp = 120)
```

```
## [1] "take your steak off!"
```

```r
steak_directions(steak_type = "med_rare", temp = 120)
```

```
## [1] "you can keep cooking"
```
---
## Invisible return

Invisible return is a bit R-specific:

- If you use `invisible` instead of `return` in a function definition, the result will be discarded unless it is assigned.

- Although return is not usually something that you will use, some of the built-in functions use them.

--




```r
square_invisible = function(x) invisible(x^2)
square = function(x) x^2
```

--

If we call `square(4)` we get output: 16


```r
square(4)
```

```
## [1] 16
```

--
But if we call `square_invisible(4)`, we don't see any output!

```r
square_invisible(4)
```

--

The square was computed though, and we can see this if we assign the output:


```r
xsquared = square_invisible(4)
xsquared
```

```
## [1] 16
```

---

Another example: compare the two versions of oddcount:


```r
oddcount = function(x) {
    k = 0
    for(n in x) {
        if (n %% 2 == 1) k = k + 1
    }
    return(k)
}
oddcount(c(0, 5))
```

```
## [1] 1
```

--



```r
oddcount = function(x) {
    k = 0
    for(n in x) {
        if (n %% 2 == 1) k = k + 1
    }
}
oddcount(c(0, 5))
oddcount_output = oddcount(c(0, 5))
oddcount_output
```

```
## NULL
```

We get `NULL` for the value of `oddcount_output` because the last function to be evaluated in `oddcount` was technically the `for` function.

`for` returns `NULL` invisibly, so the second version of `oddcount` also returns `NULL` invisibly.

## Return values can be anything

- If you want to return multiple related pieces of information, you can put them in a list or other type of object.

--

- Your return value can even be another function!


```r
g = function() {
    t = function(x) x^2
    return(t)
}
g
```

```
## function() {
##     t = function(x) x^2
##     return(t)
## }
```

```r
g()
```

```
## function(x) x^2
## &lt;environment: 0x000001f84cc42a10&gt;
```

```r
formals(g)
```

```
## NULL
```

```r
formals(g())
```

```
## $x
```

```r
body(g)
```

```
## {
##     t = function(x) x^2
##     return(t)
## }
```

```r
body(g())
```

```
## x^2
```

---

## Environments and scope

When you call a function, the commands in the function body are executed, but not in exactly the same way they would be if you simply ran them one at a time in an interactive R session.

The commands are executed in the function's _environment_.

## Environments

Ok, so what is an environment?

- An environment binds names to values.

--

- Every environment has a parent (except for the empty environment).

--

What are they good for?

- The purpose of environments is to describe where to look for variables.

- When you refer to any object, R first looks in the current environment for an object with that name.

- If it doesn't find an object with that name in the current environment, it looks in the parent environment, and continues until it runs out of parents or finds an object with the right name.

---

For example, have you ever wondered how R finds functions?

The function `lm` is not in the global environment, as we can see if we just call `ls`:


```r
ls()
```

```
##  [1] "add_2"                    "bar_plot"                
##  [3] "brexit"                   "cat_lovers"              
##  [5] "d"                        "dates"                   
##  [7] "dev.off"                  "df"                      
##  [9] "dodged_bar_plot"          "edi_airbnb"              
## [11] "edi_airbnb_cleaned_names" "edi_airbnb_col_names"    
## [13] "enrollment"               "exam_scores"             
## [15] "exam1"                    "exam2"                   
## [17] "f"                        "fav_food"                
## [19] "fig"                      "g"                       
## [21] "h"                        "hectare_centroids"       
## [23] "hectare_counts"           "heights"                 
## [25] "hook_output"              "hotels"                  
## [27] "jabba"                    "l"                       
## [29] "last_row"                 "loans"                   
## [31] "loans_full_schema"        "minard"                  
## [33] "minard_cities"            "nobel"                   
## [35] "oddcount"                 "oddcount_output"         
## [37] "out"                      "p"                       
## [39] "plot_both"                "plot_troops"             
## [41] "prices"                   "professions"             
## [43] "purchases"                "sales"                   
## [45] "sales_files"              "scrape_art_info"         
## [47] "square"                   "square_invisible"        
## [49] "squirrels"                "starwars"                
## [51] "steak_directions"         "survey"                  
## [53] "t"                        "ti"                      
## [55] "w"                        "width"                   
## [57] "works"                    "x"                       
## [59] "xsquared"                 "y"
```

---

But we are able to access it and, for instance, ask what its arguments are:


```r
head(formals(lm))
```

```
## $formula
## 
## 
## $data
## 
## 
## $subset
## 
## 
## $weights
## 
## 
## $na.action
## 
## 
## $method
## [1] "qr"
```

---

Functions live in environments corresponding to the package they are defined in. For `lm`, this is `stats`.


```r
environment(lm)
```

```
## &lt;environment: namespace:stats&gt;
```

Package environments are all ancestral to the global environment, so when R found that lm wasn't defined in the global environment, it looked through the packages until it found lm defined in stats.


---

## Function environments

. . .

When a function is called, its body is evaluated in an execution environment whose parent is the function's environment.


```r
w = 12
f = function(y) {
    d = 8
    h = function() {
        return(d * (w + y))
    }
    cat("h's environment: ", "\n")
    print(environment(h))
    cat("h's parent environment:", "\n")
    print(parent.env(environment(h)))
    return(h())
}
f(1)
```

```
## h's environment:  
## &lt;environment: 0x000001f84fa993d8&gt;
## h's parent environment: 
## &lt;environment: R_GlobalEnv&gt;
```

```
## [1] 104
```

```r
environment(f)
```

```
## &lt;environment: R_GlobalEnv&gt;
```

---
Compare with:


```r
f = function(y) {
    d = 8
    return(h())
}

h = function() {
    cat("h's environment:", "\n")
    print(environment(h))
    cat("h's parent environment:", "\n")
    print(parent.env(environment(h)))
    return(d * (w + y))
}
f(5)
```

```
## h's environment: 
## &lt;environment: R_GlobalEnv&gt;
## h's parent environment: 
## &lt;environment: 0x000001f84bd15cb0&gt;
## attr(,"name")
## [1] ".conflicts"
```

```
## Warning in h(): Incompatible methods ("Ops.data.frame",
## "Ops.Date") for "*"
```

```
## Error in d * (w + y): non-numeric argument to binary operator
```


---

This perhaps seems overly baroque, but the take-home points about environments (and the reason why they are set up the way they are) are:

- Commands called in the body of the function usually have access to values of the variables in that function plus variables at higher levels.

- Variables defined in the body of a function go away after the function exits.

---

## Side effects

A function has a _side effect_ if it does anything other than compute a return value, for instance, if it changes the values of other variables in the environment it is defined in, or adds variables to the environment.

We generally don't want functions to have side effects, because they make code more confusing and more difficult to test.

In R, functions _can_ have side effects, but it is discouraged by both the language itself and by programming norms.


---

. . .

Remember that functions can see variables defined in the parent environments.

What they can't do is change the values of those variables (except with a special operator).

For example:



```r
w = 12
f = function(y) {
   d = 8
   w = w + 1
   y = y - 2
   cat(sprintf("Value of w: %i", w))
   h = function() {
      return(d*(w+y))
   }
   return(h())
}
t = 4
f(t)
```

```
## Value of w: 13
```

```
## [1] 120
```

```r
w
```

```
## [1] 12
```

It looks like the value of `w` changed inside the function, but the value in the global environment was not actually changed.


---
# Sources

- Mine √É‚Ä°etinkaya-Rundel's Data Science in a Box ([link](https://datasciencebox.org/))
- Julia Fukuyama's EDA ([link](https://jfukuyama.github.io/))



---

class: middle

# Wrapping Up...


---
    </textarea>
<style data-target="print-only">@media screen {.remark-slide-container{display:block;}.remark-slide-scaler{box-shadow:none;}}</style>
<script src="https://remarkjs.com/downloads/remark-latest.min.js"></script>
<script>var slideshow = remark.create({
"ratio": "16:9",
"highlightLines": true,
"highlightStyle": "solarized-light",
"countIncrementalSlides": false,
"slideNumberFormat": ""
});
if (window.HTMLWidgets) slideshow.on('afterShowSlide', function (slide) {
  window.dispatchEvent(new Event('resize'));
});
(function(d) {
  var s = d.createElement("style"), r = d.querySelector(".remark-slide-scaler");
  if (!r) return;
  s.type = "text/css"; s.innerHTML = "@page {size: " + r.style.width + " " + r.style.height +"; }";
  d.head.appendChild(s);
})(document);

(function(d) {
  var el = d.getElementsByClassName("remark-slides-area");
  if (!el) return;
  var slide, slides = slideshow.getSlides(), els = el[0].children;
  for (var i = 1; i < slides.length; i++) {
    slide = slides[i];
    if (slide.properties.continued === "true" || slide.properties.count === "false") {
      els[i - 1].className += ' has-continuation';
    }
  }
  var s = d.createElement("style");
  s.type = "text/css"; s.innerHTML = "@media print { .has-continuation { display: none; } }";
  d.head.appendChild(s);
})(document);
// delete the temporary CSS (for displaying all slides initially) when the user
// starts to view slides
(function() {
  var deleted = false;
  slideshow.on('beforeShowSlide', function(slide) {
    if (deleted) return;
    var sheets = document.styleSheets, node;
    for (var i = 0; i < sheets.length; i++) {
      node = sheets[i].ownerNode;
      if (node.dataset["target"] !== "print-only") continue;
      node.parentNode.removeChild(node);
    }
    deleted = true;
  });
})();
// add `data-at-shortcutkeys` attribute to <body> to resolve conflicts with JAWS
// screen reader (see PR #262)
(function(d) {
  let res = {};
  d.querySelectorAll('.remark-help-content table tr').forEach(tr => {
    const t = tr.querySelector('td:nth-child(2)').innerText;
    tr.querySelectorAll('td:first-child .key').forEach(key => {
      const k = key.innerText;
      if (/^[a-z]$/.test(k)) res[k] = t;  // must be a single letter (key)
    });
  });
  d.body.setAttribute('data-at-shortcutkeys', JSON.stringify(res));
})(document);
(function() {
  "use strict"
  // Replace <script> tags in slides area to make them executable
  var scripts = document.querySelectorAll(
    '.remark-slides-area .remark-slide-container script'
  );
  if (!scripts.length) return;
  for (var i = 0; i < scripts.length; i++) {
    var s = document.createElement('script');
    var code = document.createTextNode(scripts[i].textContent);
    s.appendChild(code);
    var scriptAttrs = scripts[i].attributes;
    for (var j = 0; j < scriptAttrs.length; j++) {
      s.setAttribute(scriptAttrs[j].name, scriptAttrs[j].value);
    }
    scripts[i].parentElement.replaceChild(s, scripts[i]);
  }
})();
(function() {
  var links = document.getElementsByTagName('a');
  for (var i = 0; i < links.length; i++) {
    if (/^(https?:)?\/\//.test(links[i].getAttribute('href'))) {
      links[i].target = '_blank';
    }
  }
})();
// adds .remark-code-has-line-highlighted class to <pre> parent elements
// of code chunks containing highlighted lines with class .remark-code-line-highlighted
(function(d) {
  const hlines = d.querySelectorAll('.remark-code-line-highlighted');
  const preParents = [];
  const findPreParent = function(line, p = 0) {
    if (p > 1) return null; // traverse up no further than grandparent
    const el = line.parentElement;
    return el.tagName === "PRE" ? el : findPreParent(el, ++p);
  };

  for (let line of hlines) {
    let pre = findPreParent(line);
    if (pre && !preParents.includes(pre)) preParents.push(pre);
  }
  preParents.forEach(p => p.classList.add("remark-code-has-line-highlighted"));
})(document);</script>

<script>
slideshow._releaseMath = function(el) {
  var i, text, code, codes = el.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$\$(.|\s)+\$\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  // remove <code></code>
        continue;
      }
    }
    i++;
  }
};
slideshow._releaseMath(document);
</script>
<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
(function () {
  var script = document.createElement('script');
  script.type = 'text/javascript';
  script.src  = 'https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML';
  if (location.protocol !== 'file:' && /^https?:/.test(script.src))
    script.src  = script.src.replace(/^https?:/, '');
  document.getElementsByTagName('head')[0].appendChild(script);
})();
</script>
  </body>
</html>
